<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-1.8.0 docs-doc-page docs-doc-id-design/quota_change_enforcement_through_preemption" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Quota Enforcement through Preemption | Apache YuniKorn</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://yunikorn.apache.org/img/logo/yunikorn-logo-main.png"><meta data-rh="true" name="twitter:image" content="https://yunikorn.apache.org/img/logo/yunikorn-logo-main.png"><meta data-rh="true" property="og:url" content="https://yunikorn.apache.org/docs/design/quota_change_enforcement_through_preemption"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="1.8.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-1.8.0"><meta data-rh="true" name="docsearch:version" content="1.8.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-1.8.0"><meta data-rh="true" property="og:title" content="Quota Enforcement through Preemption | Apache YuniKorn"><meta data-rh="true" name="description" content="&lt;!--"><meta data-rh="true" property="og:description" content="&lt;!--"><link data-rh="true" rel="icon" href="/img/yunikorn.ico"><link data-rh="true" rel="canonical" href="https://yunikorn.apache.org/docs/design/quota_change_enforcement_through_preemption"><link data-rh="true" rel="alternate" href="https://yunikorn.apache.org/docs/design/quota_change_enforcement_through_preemption" hreflang="en"><link data-rh="true" rel="alternate" href="https://yunikorn.apache.org/docs/design/quota_change_enforcement_through_preemption" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Quota Enforcement through Preemption","item":"https://yunikorn.apache.org/docs/design/quota_change_enforcement_through_preemption"}]}</script><link rel="stylesheet" href="/assets/css/styles.50d2f32a.css">
<script src="/assets/js/runtime~main.e5d28f2f.js" defer="defer"></script>
<script src="/assets/js/main.d00b1497.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo/yunikorn_blue_logo.png"><link rel="preload" as="image" href="/img/logo/yunikorn_white_logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_bUxM" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_ZSxe" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarPlaceholder_syEH"></div><div class="content_cwdc announcementBarContent_NZAW">1.8.0 has been released, check the <a href="/community/download">DOWNLOADS</a>.</div><button type="button" aria-label="Close" class="clean-btn close closeButton_siAu announcementBarClose_TFeS"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo/yunikorn_blue_logo.png" alt="YuniKorn Site Logo" class="themedComponent_hQO6 themedComponent--light_qjFQ"><img src="/img/logo/yunikorn_white_logo.png" alt="YuniKorn Site Logo" class="themedComponent_hQO6 themedComponent--dark_MmAp"></div><b class="navbar__title text--truncate">Apache YuniKorn</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/community/roadmap">Roadmap</a><a class="navbar__item navbar__link" href="/community/download">Download</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community/get_involved">Get Involved</a></li><li><a class="dropdown__link" href="/community/how_to_contribute">How to Contribute</a></li><li><a class="dropdown__link" href="/community/coding_guidelines">Coding Guidelines</a></li><li><a class="dropdown__link" href="/community/reporting_issues">Reporting Issues</a></li><li><a class="dropdown__link" href="/community/release_procedure">Release Procedure</a></li><li><a class="dropdown__link" href="/community/events">Events</a></li><li><a class="dropdown__link" href="/community/people">People</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Apache</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Apache Software Foundation<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_QQla"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_QQla"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_QQla"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsors<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_QQla"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_QQla"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy Policy<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_QQla"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security<svg width="12" height="12" aria-label="(opens in new tab)" class="iconExternalLink_QQla"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/design/quota_change_enforcement_through_preemption">1.8.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/design/quota_change_enforcement_through_preemption">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/design/quota_change_enforcement_through_preemption">1.8.0</a></li><li><a class="dropdown__link" href="/docs/1.7.0/">1.7.0</a></li><li><a class="dropdown__link" href="/docs/1.6.3/">1.6.3</a></li><li><a class="dropdown__link" href="/docs/1.5.2/">1.5.2</a></li><li><a class="dropdown__link" href="/docs/1.4.0/">1.4.0</a></li><li><a class="dropdown__link" href="/docs/1.3.0/">1.3.0</a></li><li><a class="dropdown__link" href="/docs/1.2.0/">1.2.0</a></li><li><a class="dropdown__link" href="/docs/1.1.0/">1.1.0</a></li><li><a class="dropdown__link" href="/docs/1.0.0/">1.0.0</a></li></ul></div><a href="https://github.com/apache/yunikorn-core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_l52t colorModeToggle_MiJt"><button class="clean-btn toggleButton_SX21 toggleButtonDisabled_tPRZ" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_MXTQ lightToggleIcon_DR1M"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_MXTQ darkToggleIcon_bHj6"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_MXTQ systemToggleIcon_EGDU"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_al1k"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-1.8.0"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_Gmhi"><div class="docsWrapper_S6VL"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_UXUW" type="button"></button><div class="docRoot_iOAr"><aside class="theme-doc-sidebar-container docSidebarContainer_AiPh"><div class="sidebarViewport_jxBC"><div class="sidebar_E2BN"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_ONSo menuWithAnnouncementBar_smlw"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_dgX7 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/"><span title="Get Started" class="categoryLinkLabel_N6Hw">Get Started</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_dgX7 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_guide/deployment_modes"><span title="User Guide" class="categoryLinkLabel_N6Hw">User Guide</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_dgX7 menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/developer_guide/env_setup"><span title="Developer Guide" class="categoryLinkLabel_N6Hw">Developer Guide</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer_guide/env_setup"><span title="Dev Environment Setup" class="linkLabel_OCV4">Dev Environment Setup</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer_guide/build"><span title="Build and Run" class="linkLabel_OCV4">Build and Run</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer_guide/dependencies"><span title="Go module updates" class="linkLabel_OCV4">Go module updates</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer_guide/deployment"><span title="Deploy to Kubernetes" class="linkLabel_OCV4">Deploy to Kubernetes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer_guide/openshift_development"><span title="Development in CodeReady Containers" class="linkLabel_OCV4">Development in CodeReady Containers</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer_guide/scheduler_object_states"><span title="Scheduler Object States" class="linkLabel_OCV4">Scheduler Object States</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer_guide/e2e_test"><span title="End-to-End Testing" class="linkLabel_OCV4">End-to-End Testing</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_dgX7 menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/design/architecture"><span title="Designs" class="categoryLinkLabel_N6Hw">Designs</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/architecture"><span title="Architecture" class="linkLabel_OCV4">Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/scheduler_plugin"><span title="K8s Scheduler Plugin" class="linkLabel_OCV4">K8s Scheduler Plugin</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/gang_scheduling"><span title="Gang scheduling design" class="linkLabel_OCV4">Gang scheduling design</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/user_group"><span title="User/Group handling and lookup design" class="linkLabel_OCV4">User/Group handling and lookup design</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/user_based_resource_usage_tracking"><span title="User Based Resource Usage Tracking" class="linkLabel_OCV4">User Based Resource Usage Tracking</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/user_group_resource_usage_enforcement"><span title="User Based Quota Enforcement" class="linkLabel_OCV4">User Based Quota Enforcement</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/historical_usage_tracking"><span title="Historical Usage Tracking" class="linkLabel_OCV4">Historical Usage Tracking</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/interface_message_simplification"><span title="Simplifying Interface Messages" class="linkLabel_OCV4">Simplifying Interface Messages</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/cache_removal"><span title="Scheduler cache removal design" class="linkLabel_OCV4">Scheduler cache removal design</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/preemption"><span title="Preemption" class="linkLabel_OCV4">Preemption</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/simple_preemptor"><span title="DaemonSet Scheduling using Simple Preemptor" class="linkLabel_OCV4">DaemonSet Scheduling using Simple Preemptor</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/design/quota_change_enforcement_through_preemption"><span title="Quota Enforcement through Preemption" class="linkLabel_OCV4">Quota Enforcement through Preemption</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/generic_resource"><span title="Generic Resource Types in Namespace Quota" class="linkLabel_OCV4">Generic Resource Types in Namespace Quota</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/priority_scheduling"><span title="Priority Scheduling" class="linkLabel_OCV4">Priority Scheduling</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/resilience"><span title="Resilience" class="linkLabel_OCV4">Resilience</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/config_v2"><span title="Configuration V2" class="linkLabel_OCV4">Configuration V2</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/scheduler_configuration"><span title="Scheduler Configuration" class="linkLabel_OCV4">Scheduler Configuration</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/foreign_pod_tracking"><span title="Tracking non-Yunikorn pods" class="linkLabel_OCV4">Tracking non-Yunikorn pods</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_dgX7 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/archived_design/k8shim"><span title="Archived Designs" class="categoryLinkLabel_N6Hw">Archived Designs</span></a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_dgX7 menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/performance/evaluate_perf_function_with_kubemark"><span title="Performance" class="categoryLinkLabel_N6Hw">Performance</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_zvwN"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_YoTg"><div class="docItemContainer_zlrM"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_B9KZ" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_qwk8"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Developer Guide</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Designs</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Quota Enforcement through Preemption</span></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 1.8.0</span><div class="tocCollapsible_o62Z theme-doc-toc-mobile tocMobile_iZtv"><button type="button" class="clean-btn tocCollapsibleButton_xOcw">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Quota Enforcement through Preemption</h1></header><h2 class="anchor anchorTargetStickyNavbar_lNGC" id="motivation">Motivation<a href="#motivation" class="hash-link" aria-label="Direct link to Motivation" title="Direct link to Motivation" translate="no">​</a></h2>
<p>Queue quota can be increased or decreased based on the need. In case of an increase, the scheduler works as normal and no change in behavior. As usual, it keeps permitting both the new and existing apps to run based on the newly configured quota. In case of an decrease, the scheduler stops accepting new workloads and waits for the running applications&#x27; natural exit so that newly configured quota comes into effect eventually. This behavior of natural exit is acceptable as long all the running applications are short lived. Whereas, for longer running applications, taking more time and that too in an unpredictable way to bring quota change into effect is not acceptable and it requires a surgical approach to preempt running containers based on well defined criteria so that newly configured quota would come into immediate effect.</p>
<h2 class="anchor anchorTargetStickyNavbar_lNGC" id="goals">Goals<a href="#goals" class="hash-link" aria-label="Direct link to Goals" title="Direct link to Goals" translate="no">​</a></h2>
<ul>
<li class="">Implement Preemption only for quota decrease.</li>
<li class="">Honour Queue Guaranteed Resources</li>
<li class="">Inter-Queue Preemption configuration should not be used in conjunction</li>
<li class="">Queue Priority related configurations should not be used in conjunction</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_lNGC" id="non-goals">Non-Goals<a href="#non-goals" class="hash-link" aria-label="Direct link to Non-Goals" title="Direct link to Non-Goals" translate="no">​</a></h2>
<ul>
<li class="">Intra-Queue Preemption</li>
<li class="">Cross Node Preemption</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_lNGC" id="quota-preemption-configuration">Quota Preemption Configuration<a href="#quota-preemption-configuration" class="hash-link" aria-label="Direct link to Quota Preemption Configuration" title="Direct link to Quota Preemption Configuration" translate="no">​</a></h2>
<p>Quota Enforcement through Preemption feature can be turned off globally by setting the<br>
<!-- -->appropriate property at partition level. It is configurable as follows:</p>
<div class="language-yaml codeBlockContainer_QSR3 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_yMqb"><pre tabindex="0" class="prism-code language-yaml codeBlock_iqSE thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_ktIc"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">partitions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &lt;name of the partition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">preemption</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   	 </span><span class="token key atrule">quotapreemptionenabled</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &lt;boolean value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">queues</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &lt;name of the queue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">max</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &lt;maximum resources allowed for this queue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><br></span></code></pre></div></div>
<p>Default is false (disabled). It means, the whole feature is turned OFF globally and preemption won’t be triggered when lowering the quota which is nothing but the situation exists today. So, having default as false is to retain the existing behavior as is.</p>
<p>Setting it to true would turn ON the feature globally and preemption would be triggered whenever any queue quota decreases.</p>
<h2 class="anchor anchorTargetStickyNavbar_lNGC" id="quota-preemption-delay">Quota Preemption Delay<a href="#quota-preemption-delay" class="hash-link" aria-label="Direct link to Quota Preemption Delay" title="Direct link to Quota Preemption Delay" translate="no">​</a></h2>
<p>Quota Preemption Delay is the time duration after which the preemption should get triggered for quota changes. Otherwise, triggering preemption immediately has a profound impact especially on the queues where long live applications run. It is applicable only for quota decrease, nothing to do with increase. It is configurable.Unit is seconds.</p>
<p>It is configurable as follows:</p>
<div class="language-yaml codeBlockContainer_QSR3 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_yMqb"><pre tabindex="0" class="prism-code language-yaml codeBlock_iqSE thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_ktIc"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">partitions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &lt;name of the partition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">queues</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &lt;name of the queue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">max</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &lt;maximum resources allowed for this queue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">quota.preemption.delay</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &lt;quota preemption delay in seconds</span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><br></span></code></pre></div></div>
<p>It could be any value between 0 and maxint.</p>
<p>The default is 0. It means, preemption won’t be triggered when lowering the quota which is nothing but the situation exists today. As of now, In case of quota decrease, new quota would be applied and brought into effect only for the new requests during the next scheduling cycle but existing applications continue to run as is. So, having default as 0 is to retain the existing behavior as is.</p>
<p>Setting any value between 60 seconds and 5 hours is preferable for most of the cases.</p>
<p>Examples are</p>
<p>1) To trigger preemption after 2 hours</p>
<div class="language-yaml codeBlockContainer_QSR3 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_yMqb"><pre tabindex="0" class="prism-code language-yaml codeBlock_iqSE thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_ktIc"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">partitions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> default  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">queues</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> queueA  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">max</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 10G</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">quota.preemption.delay</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7200</span><br></span></code></pre></div></div>
<p>2) To trigger preemption immediately after 5 minutes</p>
<div class="language-yaml codeBlockContainer_QSR3 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_yMqb"><pre tabindex="0" class="prism-code language-yaml codeBlock_iqSE thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_ktIc"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">partitions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> default  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">queues</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> queueA  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">max</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 10G</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">quota.preemption.delay</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><br></span></code></pre></div></div>
<p>The delay timer clocks in once the config map has been saved. Config map could be modified for multiple scenarios, but the timer clocks in only when either Queue max resources or quota preemption delay property changes. Once the timer started, changes could happen to either one of these two properties. In case of any such changes, timers reset and start again from the beginning, not on top of the current timer value to avoid unnecessary confusions. Manipulation based on the current timer value which has already started a while back could cause a lot of confusion and make it difficult to reason about the net effect of the change. So, timers reset and starting again from 0 is easy to interpret in all scenarios. In short, any quota preemption delay or max resources configured either through initial setup or change applied later is applicable from the moment the config map has been saved. Only values being used currently and newer values coming from config map are combined together to decide the next steps at any given moment even though the delay timer has not yet passed the current time or actual preemption process has not yet started. So, in case of decrease from Q to Q/3 at T1 with delay of ‘x’ seconds and again increase from Q/3 to Q/2 at T2 before T1 + x seconds has passed doesn’t trigger preemption as recent change is purely an increase. But, If T1 + x seconds had just passed and preemption had just triggered around the same time as T2 then the triggered process cannot be reverted and/or interrupted in the middle of it. At any given time, only one preemption process should be running for the specific queue even though quota has been decreased with delay of ‘0’ seconds (immediately) around the same time preemption started for the same queue based on earlier changes. No action should be taken when preemption is already running for the same queue and skipped as allowing it to continue would create havoc.<br>
<!-- -->In addition, changes could be made to more than one queue at the same time but with different delay values. In case of the same delay for leaf queue and other parent queue in the whole queue hierarchy, leaf queue could be prioritized over the parent as it might help the <a href="#queue-selection-and-ordering" class="">Queue selection process</a> for the parent as described later. Need not to go through further on this in detail here as these cases would be sorted out appropriately during the implementation.</p>
<h3 class="anchor anchorTargetStickyNavbar_lNGC" id="impact-of-restart">Impact of Restart<a href="#impact-of-restart" class="hash-link" aria-label="Direct link to Impact of Restart" title="Direct link to Impact of Restart" translate="no">​</a></h3>
<p>How does Quota Preemption Delay work after the quota changes followed up by restart? As explained earlier, the clock kicks in once the config map has been saved, say T1. Yunikorn restarted at T2. When service starts again after T2, Quota Preemption Delay would start again from the beginning and lead to postponing this activity due to lost time (T2-T1) as opposed to earlier schedule.</p>
<h2 class="anchor anchorTargetStickyNavbar_lNGC" id="meaningful-quota-decrease">Meaningful Quota Decrease<a href="#meaningful-quota-decrease" class="hash-link" aria-label="Direct link to Meaningful Quota Decrease" title="Direct link to Meaningful Quota Decrease" translate="no">​</a></h2>
<p>When Queue has both max resources and guaranteed resources set, decreasing quota to lower value should always be greater than guaranteed resources. Otherwise, it would violate the <a href="#goals" class="">goal</a> of considering guaranteed resources also into account and making sure usage doesn&#x27;t fall below guaranteed resources as part of the preemption process. Preemption should not make usage fall below guaranteed resources at any cost. Config validation is required to ensure max resource is always greater than guaranteed resource only when <a href="#quota-preemption-delay" class="">delay</a> has been configured with value greater than ‘0’.</p>
<h2 class="anchor anchorTargetStickyNavbar_lNGC" id="preemptable-resource-calculation">Preemptable Resource calculation<a href="#preemptable-resource-calculation" class="hash-link" aria-label="Direct link to Preemptable Resource calculation" title="Direct link to Preemptable Resource calculation" translate="no">​</a></h2>
<p>Whenever any queue quota changes, the first thing would be to understand the usage. If the usage is below or equal to the new quota, no need to trigger preemption. Otherwise, preemption would be triggered. We need to calculate the resources that need to be preemptable in order to bring newer quotas into effect. So, a preemptable resource is the amount of resources that needs to be preempted in order to bring the new quota into effect immediately.</p>
<p>Preemptable resource “preemptable resource” would be derived by subtracting the current usage from newly defined “max resources” quota using subtract method</p>
<p>resources.subOnlyExisting(existing, newer)</p>
<p>as resource types might differ. Different possible scenarios are lowering all resource types, lowering specific resource types, complete elimination of specific resource types from its earlier configurations, brand new resource types not present in its earlier configurations etc. Using the above said resource subtraction method would guarantee the reliable delta calculation.</p>
<p>Results could contain all positive values or negative values or combinations of both. Results derived containing negative value for any resource type are the only ones that need to be preempted. Nothing needs to be done for all other resource types as usage should be either equal or below the corresponding resource types in ““max resources” value. So, “preemptable resource” contains only resource types which need to be preempted.</p>
<p>Below table covers the various possible scenarios for the queue <code>root.a.b</code> with examples:</p>
<table><thead><tr><th>Queue</th><th>Current Max</th><th>New Max</th><th>Usage</th><th>Preemptable Resources</th></tr></thead><tbody><tr><td><code>root.a.b</code></td><td>{M: 100G}</td><td>{M: 50G}</td><td>{M: 80G}</td><td>{M: 30G}</td></tr><tr><td></td><td>Nil</td><td>{M: 50G}</td><td>{M: 80G}</td><td>{M: 30G}</td></tr><tr><td></td><td>{M: 100G, CPU: 100}</td><td>{M: 50G, CPU: 50}</td><td>{M: 80G, CPU: 80}</td><td>{M: 30G, CPU: 30}</td></tr><tr><td></td><td>{M: 100G, CPU: 100}</td><td>{M:200G, CPU: 50}</td><td>{M: 100G, CPU: 80}</td><td>{CPU: 30}</td></tr><tr><td></td><td>{M: 100G}</td><td>{M: 100G, CPU: 100}</td><td>{M: 50G, CPU: 500}</td><td>{CPU: 400}</td></tr><tr><td></td><td>{M: 100G, CPU: 100}</td><td>{M: 50G}</td><td>{M: 80G, CPU: 100}</td><td>{M: 30G}</td></tr><tr><td></td><td>{M: 100G}</td><td>{CPU: 100}</td><td>{M: 100G, CPU: 500}</td><td>{CPU: 400}</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_lNGC" id="lowering-leaf-queue-quota">Lowering Leaf Queue Quota<a href="#lowering-leaf-queue-quota" class="hash-link" aria-label="Direct link to Lowering Leaf Queue Quota" title="Direct link to Lowering Leaf Queue Quota" translate="no">​</a></h2>
<p>Whenever any leaf queue quota changes, the above described preemptable resource should be used as the target. Once we know the target, the next step is to go over the tasks running in the queue being worked upon to choose the potential victims.</p>
<h3 class="anchor anchorTargetStickyNavbar_lNGC" id="how-are-victims-selected-and-processed">How are victims selected and processed?<a href="#how-are-victims-selected-and-processed" class="hash-link" aria-label="Direct link to How are victims selected and processed?" title="Direct link to How are victims selected and processed?" translate="no">​</a></h3>
<p>Collect all running tasks based on below described criteria:</p>
<ol>
<li class="">Ignore Daemon set pods</li>
<li class="">Choose pods which have “at least one” match with preemptable resources.</li>
</ol>
<p>Once the set of tasks been collected, same has to be sorted based on the below described preference rules:</p>
<ol>
<li class="">Prefer Non originator pods over originator</li>
<li class="">In case of tie in rule #1, prefer pods based on priority. Lower priority picked up first followed by high priority pods.</li>
<li class="">In case of tie in rule #2, Prefer pods for which the “allowPreemption” flag has been set to true over other pods.</li>
<li class="">In case of tie in rule #3, prefer “young” pods based on the age</li>
</ol>
<p>Once the tasks are sorted, tasks can be traversed one by one and preempted to free up resources until we reach the target.</p>
<h2 class="anchor anchorTargetStickyNavbar_lNGC" id="lowering-parent-queue-quota">Lowering Parent Queue Quota<a href="#lowering-parent-queue-quota" class="hash-link" aria-label="Direct link to Lowering Parent Queue Quota" title="Direct link to Lowering Parent Queue Quota" translate="no">​</a></h2>
<p>Whenever any leaf queue quota changes, we know the specific queue to work on. Whereas, in case of lowering parent queue quota, we need to traverse all the way down to collect the end leaf queues because it is the place where actual tasks need to be preempted. But how do we select the queue(s) among different queue paths located under the parent queue for which quota has been decreased?</p>
<h3 class="anchor anchorTargetStickyNavbar_lNGC" id="queue-selection-and-ordering">Queue selection and ordering<a href="#queue-selection-and-ordering" class="hash-link" aria-label="Direct link to Queue selection and ordering" title="Direct link to Queue selection and ordering" translate="no">​</a></h3>
<p>Child Queues with nil usage and queues for which <a href="#quota-preemption-delay" class="">preemption is already in progress</a>  would be eliminated in the beginning itself to avoid participation in below described steps. Once elimination is over, an above calculated preemptable resource could be distributed fairly among the remaining child queues as described below.</p>
<p>Usage above the guaranteed resources only is allowed to be preempted to ensure that this preemption doesn’t end up in taking usage below the guaranteed resources. So, Usage above Guaranteed resources is calculated and curved out from each child queue and termed as “releasable resources”. It is nothing but subtracting the usage from the configured guaranteed resources. Guaranteed resources might have been configured only for a few types but not for all. So, all different combinations are possible. For child queues that don&#x27;t have guaranteed resources set completely, all used resources can be considered as “releasable”. Since resource types could differ between guaranteed and used resources, results could contain positive and negative values. Only negative values are the resources that can be released as part of the preemption process.</p>
<p>Once “releasable resources” is derived, calculate “total releasable resources” by adding all child queues “releasable resources”. After that “releasable resources %” for each child queue could be derived by dividing its “releasable resources” by “total releasable resources”. “releasable resources %” might have different values for each resource type as it all depends on the guaranteed resources configuration and usages. Now, applying “releasable resources %” on above calculated preemptable resources would yield preemptable resources  for each child queue. We might need to introduce “round off” adjustments based on the results which can be sorted out during the implementation.</p>
<p>Honoring Guaranteed resources on one specific queue would increase or decrease the preemption rate on other siblings is a side effect caused by the above shift which is something admin should take into account while doing quota readjustments. We can introduce a configuration to decide the percentage of distribution among queues or queue based individual preemption property to permit the maximum preemptable resource later.</p>
<p>Since we know the preemptable resource target for each leaf queue located under the current parent queue being worked upon, the next step is to repeat the same process for all levels until we reach the leaf queues branched from different queues at different levels. As always, a recursive approach would be followed here too. After reaching the end leaf queues, next step is to follow the steps described in <a href="#how-are-victims-selected-and-processed?" class="">victims selection process</a></p>
<p>Queue selection process prior to doing <a href="#how-are-victims-selected-and-processed?" class="">victims selection process</a> has a disadvantage of not doing sorting based on pod significance across all queues. However, given the advantage as described above, Queue selection ensures fairness in the preemption process triggered through lowering of parent queue quota.</p>
<h2 class="anchor anchorTargetStickyNavbar_lNGC" id="preemption-does-not-help-situations">“Preemption does not help” situations<a href="#preemption-does-not-help-situations" class="hash-link" aria-label="Direct link to “Preemption does not help” situations" title="Direct link to “Preemption does not help” situations" translate="no">​</a></h2>
<p>Resources used by each victim may or may not differ. Selecting victims from potential victims involves necessary checks, one among them is to ensure usage doesn’t go below the guaranteed resources. So, there could be chances that there are no viable options to proceed further. For example, Preemptable resources is {memory: 40 GB}, Guaranteed resources: {memory: 50 GB} and Usage is {memory: 100 GB}. 5 victims. Each victim is using {memory: 20  GB}. Preempting 2 victims is not a problem and attempting 3rd one would make use fall below the guaranteed resources. One could come up with ‘N’ number of different scenarios by applying different possible combinations using the above example as reference.<br>
<!-- -->Unlike Intra queue preemption, where in asks (preemptor) goes through preemption process every scheduling cycle with an interval of  `X` seconds and probability of preemption yielding positive outcome after multiple attempts is higher, this preemption process doesn’t have a such inherent retry capabilities to increase the probability of successful preemption. Even if it is available, it is not going to help much as running victims are long lived workloads and not going to change immediately. We don’t have any option other than trying “best effort” solutions as there is no retryable possibility. In order to achieve a successful preemption outcome, a new configuration option called “miss” could be introduced as a  “best effort”  approach to define a smaller % of resources that could be ignored by preempting the victims as much as we can depending on the situations to alleviate the above problem smoothly. Not only does it address the above problem, it helps in making a serious attempt to bring down the usage to the nearest expected level and thereby making an effort to march towards the objective of this whole quota enforcement through preemption.</p>
<p>However, there could be situations where the above explained “best effort” might not be applied to get best out of the process as it depends on the no. of potential victims available at any moment. If there are not enough victims available, maybe only 1 victim, preemption does not help at any cost as attempting further would make usage go below the guaranteed resources.</p>
<p>Administrators should be informed about all these kinds of situations to avoid surprises through well defined mechanisms.</p>
<p><img decoding="async" loading="lazy" alt="quota_preemption_successful_preemption_case" src="/assets/images/quota_preemption_successful_preemption_case-d41d1e6c89dd3ce3271ab8802779db00.png" width="1024" height="768" class="img_Jyx7"></p>
<p><img decoding="async" loading="lazy" alt="quota_preemption_successful_best_effort_preemption_case" src="/assets/images/quota_preemption_successful_best_effort_preemption_case-30060bdd2a4bf2e567905a589714defe.png" width="1024" height="768" class="img_Jyx7"></p>
<p><img decoding="async" loading="lazy" alt="quota_preemption_unsuccessful_preemption_case" src="/assets/images/quota_preemption_unsuccessful_preemption_case-dee5f51889d5cacd4d9c2e1a78927897.png" width="1024" height="768" class="img_Jyx7"></p>
<h2 class="anchor anchorTargetStickyNavbar_lNGC" id="relevance-of-existing-intra-queue-preemption-configurations-and-queue-setups">Relevance of existing Intra Queue Preemption Configurations and Queue Setups<a href="#relevance-of-existing-intra-queue-preemption-configurations-and-queue-setups" class="hash-link" aria-label="Direct link to Relevance of existing Intra Queue Preemption Configurations and Queue Setups" title="Direct link to Relevance of existing Intra Queue Preemption Configurations and Queue Setups" translate="no">​</a></h2>
<p>In short, all existing Intra Queue Preemption Configurations have no relevance from this design point of view and should not be used in conjunction with newly added configurations.</p>
<h3 class="anchor anchorTargetStickyNavbar_lNGC" id="preemption-fence--preemption-delay">Preemption Fence &amp; Preemption Delay<a href="#preemption-fence--preemption-delay" class="hash-link" aria-label="Direct link to Preemption Fence &amp; Preemption Delay" title="Direct link to Preemption Fence &amp; Preemption Delay" translate="no">​</a></h3>
<p>Existing Preemption related properties like preemption.policy, preemption.delay should not be considered or used in conjunction with this <a href="#motivation" class="">preemption</a> as the objective is completely different from the other one. In addition, the reason for not considering preemption.policy (fence) into account especially for the child queues underneath the current parent queue being worked upon is to avoid unbiased and incorrect decisions. A fence is a unidirectional way of traversing down the hierarchy and preventing going upwards to look for victims. Quota change also traverses down the hierarchy to apply the change. So, there is no reason to bring the fence into account. In addition, Choosing Victims only from Non fenced child queues doesn’t seem to be a fair way of running the selection process. In case of having Fenced child queues fenced underneath the current parent queue doesn’t allow us to complete the quota enforcement through preemption at all. Hence, preemption.policy should not be considered.</p>
<p>Queue=&gt;properties=&gt;preemption.delay should not be confused with above discussed Quota Change Preemption delay <a href="#quota-preemption-configuration" class="">Queue=&gt;resources=&gt;preemption.delay</a> and treated differently as earlier has been introduced to compensate for the scheduling cycle interval and used only in the scheduling cycle core path.</p>
<h3 class="anchor anchorTargetStickyNavbar_lNGC" id="priority-fence--offset">Priority Fence &amp; Offset<a href="#priority-fence--offset" class="hash-link" aria-label="Direct link to Priority Fence &amp; Offset" title="Direct link to Priority Fence &amp; Offset" translate="no">​</a></h3>
<p>priority.policy (fence) &amp; priority.offset makes an impact while working across different queues. These two properties have been used in Inter queue preemption before choosing the victims from queues located under different queue paths. Whereas, this preemption looks inside the queue or queues located underneath the parent queue being worked upon to apply quota change. So, above said priority related properties need not to be considered.</p>
<h3 class="anchor anchorTargetStickyNavbar_lNGC" id="dynamic-queues">Dynamic Queues<a href="#dynamic-queues" class="hash-link" aria-label="Direct link to Dynamic Queues" title="Direct link to Dynamic Queues" translate="no">​</a></h3>
<p>When a Dynamic queue is created, it uses the child template defined on its immediate queue or any ancestor queue in the whole queue hierarchy. When any lowering quota happens on existing child templates, the currently used dynamic queue can be left as is as the queue itself has a shorter life span, and would be deleted anyway once the application completes. For the newly created dynamic queue, resource configuration is going to be based on the newly defined quota and works as expected.</p>
<p>Quota could be lowered through annotations as well. In such cases, default behavior would be applied as there is no way to set preemption.delay through annotations as of now. It means, a new lowered quota would be applied immediately only for new requests and existing applications should continue to run as is and go through natural exit.</p>
<h2 class="anchor anchorTargetStickyNavbar_lNGC" id="future-plans">Future Plans<a href="#future-plans" class="hash-link" aria-label="Direct link to Future Plans" title="Direct link to Future Plans" translate="no">​</a></h2>
<ol>
<li class="">Victims could be further segregated based on the nodes. Once node wise victims are available, node fulfillment processes like bin packing etc could be brought into picture.</li>
<li class="">Introduce a “closest match” algorithm to choose the victims which is less intrusive from a general perspective. Prefer “closest match” victim by starting with choosing victims whose resource types exactly match with “preemptable resources”, then ordered (ascending) by count of non matching resource types.</li>
</ol></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/design/simple_preemptor"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">DaemonSet Scheduling using Simple Preemptor</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/design/generic_resource"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Generic Resource Types in Namespace Quota</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_ydpk thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#motivation" class="table-of-contents__link toc-highlight">Motivation</a></li><li><a href="#goals" class="table-of-contents__link toc-highlight">Goals</a></li><li><a href="#non-goals" class="table-of-contents__link toc-highlight">Non-Goals</a></li><li><a href="#quota-preemption-configuration" class="table-of-contents__link toc-highlight">Quota Preemption Configuration</a></li><li><a href="#quota-preemption-delay" class="table-of-contents__link toc-highlight">Quota Preemption Delay</a><ul><li><a href="#impact-of-restart" class="table-of-contents__link toc-highlight">Impact of Restart</a></li></ul></li><li><a href="#meaningful-quota-decrease" class="table-of-contents__link toc-highlight">Meaningful Quota Decrease</a></li><li><a href="#preemptable-resource-calculation" class="table-of-contents__link toc-highlight">Preemptable Resource calculation</a></li><li><a href="#lowering-leaf-queue-quota" class="table-of-contents__link toc-highlight">Lowering Leaf Queue Quota</a><ul><li><a href="#how-are-victims-selected-and-processed" class="table-of-contents__link toc-highlight">How are victims selected and processed?</a></li></ul></li><li><a href="#lowering-parent-queue-quota" class="table-of-contents__link toc-highlight">Lowering Parent Queue Quota</a><ul><li><a href="#queue-selection-and-ordering" class="table-of-contents__link toc-highlight">Queue selection and ordering</a></li></ul></li><li><a href="#preemption-does-not-help-situations" class="table-of-contents__link toc-highlight">“Preemption does not help” situations</a></li><li><a href="#relevance-of-existing-intra-queue-preemption-configurations-and-queue-setups" class="table-of-contents__link toc-highlight">Relevance of existing Intra Queue Preemption Configurations and Queue Setups</a><ul><li><a href="#preemption-fence--preemption-delay" class="table-of-contents__link toc-highlight">Preemption Fence &amp; Preemption Delay</a></li><li><a href="#priority-fence--offset" class="table-of-contents__link toc-highlight">Priority Fence &amp; Offset</a></li><li><a href="#dynamic-queues" class="table-of-contents__link toc-highlight">Dynamic Queues</a></li></ul></li><li><a href="#future-plans" class="table-of-contents__link toc-highlight">Future Plans</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Blog</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://blog.cloudera.com/yunikorn-a-universal-resources-scheduler/" target="_blank" rel="noopener noreferrer" class="footer__link-item">What&#x27;s YuniKorn?<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_QQla"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://blog.cloudera.com/spark-on-kubernetes-gang-scheduling-with-yunikorn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Spark on Kubernetes – Gang Scheduling with YuniKorn<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_QQla"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Code Repositories</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/apache/yunikorn-core/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Core scheduler<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_QQla"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/apache/yunikorn-k8shim" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kubernetes shim<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_QQla"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/apache/yunikorn-scheduler-interface" target="_blank" rel="noopener noreferrer" class="footer__link-item">Scheduler Interface<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_QQla"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/apache/yunikorn-web" target="_blank" rel="noopener noreferrer" class="footer__link-item">WEB application<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_QQla"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/apache/yunikorn-site" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_QQla"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/community/get_involved">Get Involved</a></li><li class="footer__item"><a class="footer__link-item" href="/community/people">People</a></li><li class="footer__item"><a href="https://issues.apache.org/jira/projects/YUNIKORN/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issues<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_QQla"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
<div style="font-size: 70%">
Copyright © 2020-2026 <a href="https://www.apache.org/">The Apache Software Foundation</a>. Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>. <br>
<div style="padding:20px; margin: 10px; color: #4d4d4d;">
<p>The Apache Software Foundation Apache YuniKorn, YuniKorn, Apache, the Apache feather, and the Apache YuniKorn project logo are either registered trademarks or trademarks of the Apache Software Foundation.</p>
</div>
</div></div></div></div></footer></div>
</body>
</html>