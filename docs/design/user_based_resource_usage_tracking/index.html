<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-1.5.1 docs-doc-page docs-doc-id-design/user_based_resource_usage_tracking" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">User Based Resource Usage Tracking | Apache YuniKorn</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://yunikorn.apache.org/img/logo/yunikorn-logo-main.png"><meta data-rh="true" name="twitter:image" content="https://yunikorn.apache.org/img/logo/yunikorn-logo-main.png"><meta data-rh="true" property="og:url" content="https://yunikorn.apache.org/docs/design/user_based_resource_usage_tracking"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="1.5.1"><meta data-rh="true" name="docusaurus_tag" content="docs-default-1.5.1"><meta data-rh="true" name="docsearch:version" content="1.5.1"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-1.5.1"><meta data-rh="true" property="og:title" content="User Based Resource Usage Tracking | Apache YuniKorn"><meta data-rh="true" name="description" content="&lt;!--"><meta data-rh="true" property="og:description" content="&lt;!--"><link data-rh="true" rel="icon" href="/img/yunikorn.ico"><link data-rh="true" rel="canonical" href="https://yunikorn.apache.org/docs/design/user_based_resource_usage_tracking"><link data-rh="true" rel="alternate" href="https://yunikorn.apache.org/docs/design/user_based_resource_usage_tracking" hreflang="en"><link data-rh="true" rel="alternate" href="https://yunikorn.apache.org/docs/design/user_based_resource_usage_tracking" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://Q1V951BG2V-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Apache YuniKorn" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.57f4caef.css">
<script src="/assets/js/runtime~main.377003fc.js" defer="defer"></script>
<script src="/assets/js/main.1ba8fec7.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fIH8" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar__FTF" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarPlaceholder_wDNR"></div><div class="content_DgxC announcementBarContent_HmXy">1.5.1 has been released, check the <a href="/community/download">DOWNLOADS</a>.</div><button type="button" aria-label="Close" class="clean-btn close closeButton_KmNL announcementBarClose_BG67"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo/yunikorn_blue_logo.png" alt="YuniKorn Site Logo" class="themedComponent_yzub themedComponent--light_pOwb"><img src="/img/logo/yunikorn_white_logo.png" alt="YuniKorn Site Logo" class="themedComponent_yzub themedComponent--dark_xdnF"></div><b class="navbar__title text--truncate">Apache YuniKorn</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/community/roadmap">Roadmap</a><a class="navbar__item navbar__link" href="/community/download">Download</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community/get_involved">Get Involved</a></li><li><a class="dropdown__link" href="/community/how_to_contribute">How to Contribute</a></li><li><a class="dropdown__link" href="/community/coding_guidelines">Coding Guidelines</a></li><li><a class="dropdown__link" href="/community/reporting_issues">Reporting Issues</a></li><li><a class="dropdown__link" href="/community/release_procedure">Release Procedure</a></li><li><a class="dropdown__link" href="/community/events">Events</a></li><li><a class="dropdown__link" href="/community/people">People</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Apache</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Apache Software Foundation<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsors<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy Policy<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/">1.5.1</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/design/user_based_resource_usage_tracking">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/design/user_based_resource_usage_tracking">1.5.1</a></li><li><a class="dropdown__link" href="/docs/1.5.0/design/user_based_resource_usage_tracking">1.5.0</a></li><li><a class="dropdown__link" href="/docs/1.4.0/design/user_based_resource_usage_tracking">1.4.0</a></li><li><a class="dropdown__link" href="/docs/1.3.0/design/user_based_resource_usage_tracking">1.3.0</a></li><li><a class="dropdown__link" href="/docs/1.2.0/design/user_based_resource_usage_tracking">1.2.0</a></li><li><a class="dropdown__link" href="/docs/1.1.0/">1.1.0</a></li><li><a class="dropdown__link" href="/docs/1.0.0/">1.0.0</a></li><li><a class="dropdown__link" href="/docs/0.12.2/">0.12.2</a></li><li><a class="dropdown__link" href="/docs/0.12.1/">0.12.1</a></li><li><a class="dropdown__link" href="/docs/0.11.0/">0.11.0</a></li><li><a class="dropdown__link" href="/docs/0.10.0/">0.10.0</a></li><li><a class="dropdown__link" href="/docs/0.9.0/">0.9.0</a></li><li><a class="dropdown__link" href="/docs/0.8.0/">0.8.0</a></li></ul></div><a href="https://github.com/apache/yunikorn-core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_CXxL colorModeToggle_r3Ku"><button class="clean-btn toggleButton_A2Gq toggleButtonDisabled_MBgh" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_ZNXA"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon__KEK"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_eonw"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_txSM"><div class="docsWrapper_aujV"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_fDTy" type="button"></button><div class="docRoot_ITF8"><aside class="theme-doc-sidebar-container docSidebarContainer_coE9"><div class="sidebarViewport_XDus"><div class="sidebar_duME"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_d40_ menuWithAnnouncementBar_QXd6"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/">Get Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/user_guide/deployment_modes">User Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/developer_guide/env_setup">Developer Guide</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer_guide/env_setup">Dev Environment Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer_guide/build">Build and Run</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer_guide/dependencies">Go module updates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer_guide/deployment">Deploy to Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer_guide/openshift_development">Development in CodeReady Containers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer_guide/scheduler_object_states">Scheduler Object States</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer_guide/e2e_test">End-to-End Testing</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/design/architecture">Designs</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/scheduler_plugin">K8s Scheduler Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/gang_scheduling">Gang scheduling design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/user_group">User/Group handling and lookup design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/design/user_based_resource_usage_tracking">User Based Resource Usage Tracking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/user_group_resource_usage_enforcement">User Based Quota Enforcement</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/historical_usage_tracking">Historical Usage Tracking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/interface_message_simplification">Simplifying Interface Messages</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/cache_removal">Scheduler cache removal design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/preemption">Preemption</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/simple_preemptor">DaemonSet Scheduling using Simple Preemptor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/generic_resource">Generic Resource Types in Namespace Quota</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/priority_scheduling">Priority Scheduling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/resilience">Resilience</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/config_v2">Configuration V2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/scheduler_configuration">Scheduler Configuration</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/archived_design/k8shim">Archived Designs</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/performance/evaluate_perf_function_with_kubemark">Performance</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_fQ9A"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_L8rf"><div class="docItemContainer_J6oa"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer__4Nk" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_lw5W"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Developer Guide</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Designs</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">User Based Resource Usage Tracking</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 1.5.1</span><div class="tocCollapsible_hejs theme-doc-toc-mobile tocMobile_K3aG"><button type="button" class="clean-btn tocCollapsibleButton_a3TS">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>User Based Resource Usage Tracking</h1></header><h2 class="anchor anchorWithStickyNavbar_NlAN" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2>
<p>Tracking resource allocation usage is currently limited to a queue. An application, which owns the allocation, is the source of that resource usage. All applications that are part of the queue will count towards the resource usage of the queue. A queue could also have a resource usage quota set. The queue’s resource quota is enforced during the scheduling cycle.</p>
<p>An application is always owned by a user/group. One user/group could own applications in one or more queues. Like a queue a user/group could have a limit set. A limit can specify a resource usage quota, and an application usage limit. Tracking these usages per user/group is currently not implemented and is covered as part of this design.</p>
<h2 class="anchor anchorWithStickyNavbar_NlAN" id="goals">Goals<a href="#goals" class="hash-link" aria-label="Direct link to Goals" title="Direct link to Goals">​</a></h2>
<ul>
<li>
<p>Specify tracking usage in relation to the following objects:</p>
<ul>
<li>users</li>
<li>applications</li>
<li>queues</li>
</ul>
</li>
<li>
<p>An interface to define how to track running applications:</p>
<ul>
<li>Read a user/group running applications</li>
<li>Increase a user/group running applications *)</li>
<li>Decrease a user/group running applications</li>
</ul>
</li>
<li>
<p>An interface to define how to track usage:</p>
<ul>
<li>Read a user/group resource usage</li>
<li>Increase a user/group resource usage *)</li>
<li>Decrease a user/group resource usage</li>
</ul>
<p>*) This call could be extended for enforcement later.</p>
</li>
<li>
<p>Expose user/group tracked information through REST API</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_NlAN" id="non-goals">Non Goals<a href="#non-goals" class="hash-link" aria-label="Direct link to Non Goals" title="Direct link to Non Goals">​</a></h2>
<ul>
<li>User and group retrieval is part of the k8shim which is out of scope</li>
<li>Exposing usage as a metric into prometheus</li>
<li>Specify enforcement rules</li>
<li>Implementation of enforcement</li>
<li>Interface definition to allow enforcement</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_NlAN" id="tracking-definitions">Tracking definitions<a href="#tracking-definitions" class="hash-link" aria-label="Direct link to Tracking definitions" title="Direct link to Tracking definitions">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_NlAN" id="user-vs-group-tracking">User vs Group tracking<a href="#user-vs-group-tracking" class="hash-link" aria-label="Direct link to User vs Group tracking" title="Direct link to User vs Group tracking">​</a></h3>
<p>Tracking is based on the <em>security.UserGroup</em> object defined in the core scheduler. User and group information is retrieved by the shim and communicated via the <em>UserGroupInformation</em> object as defined in the scheduler interface. A <em>security.UserGroup</em> object contains:</p>
<ul>
<li>user (exactly 1)</li>
<li>groups (0 or more)</li>
</ul>
<p>Limits can be configured for both users and groups at the same time in the same queue. So, in the case of users for which no limit has been configured explicitly but group (to which the user belongs to) limits have configured works based on the group limits configuration. In case of users for which a limit has been configured explicitly works based on its own configured limits irrespective of whether configuration has been set for the corresponding group (to which the user belongs to)  or not. In other words, user limit settings always have the higher precedence when group limit settings have been configured too.</p>
<p>&quot;*&quot; is also allowed for both users and groups limit configuration. In this case, any user or group needs to go through enforcement checks to ensure limit settings are being honoured properly. However, the tracker does not need to track the wildcard user as a specific user or group is already being tracked during their activities.</p>
<h3 class="anchor anchorWithStickyNavbar_NlAN" id="group-limitations">Group limitations<a href="#group-limitations" class="hash-link" aria-label="Direct link to Group limitations" title="Direct link to Group limitations">​</a></h3>
<p>Users can belong to zero, one or multiple groups. In some systems, like unix, a concept of a primary group exists. This concept is not universal and there is no consistent definition of a primary group either. If the system does not define a primary group how would we distinguish between the groups?</p>
<p>In the case the user is a member of multiple groups the assignment of usage to a group also becomes problematic. The decision which group to assign the usage to becomes arbitrary. As an example consider a user with multiple groups assigned. Joe has groups dev and test assigned. When an application is started does that application count towards the limits for the dev group or against the limits for the test group or both?</p>
<p>The <em>UserGroup</em> object contains a slice, list or array, of groups which has a fixed order from the moment of creation. The group resolution configured might not guarantee an ordering which means we cannot rely on the order in the <em>UserGroup</em> to be stable. A stable and pre-defined way of choosing a group to track usage against must be defined.</p>
<p>The first point to define is that tracking can only occur against zero (0) or one (1) group. Usage can never be tracked against multiple groups. If a user is a member of multiple groups, a group is selected when the first usage is registered for the application. The group selected out of the list of groups in the <em>UserGroup</em> object to track against is based on the hierarchical queue limit configuration. The hierarchy is considered bottom up, starting from the leaf up to the root. The first group that is specified in the queue hierarchy for limiting usage that matches a group in the <em>UserGroup</em> object is selected for that application.</p>
<p>If no group limits are defined, in the hierarchy, usage is not tracked for a group. If no groups are defined in the <em>UserGroup</em> object no usage will be tracked against a group.</p>
<p>The tracker considers only the group received as part of the <em>UserGroup</em> object at the time of first usage registration for the application in the tracker. In case of group changes while the user’s application is actively being tracked, the tracker does not consider the group change. However, If the user submits a new application, the most current group information at that point in time will be used.</p>
<p>Until there is full support for groups in the k8shim, group tracking will be limited. No groups are passed by the k8shim to the core. This results in the <em>UserGroup</em> object in the current implementation to always have only one group. The group name will be the same as the username. We also have excluded configuration processing for the tracking. For the current tracking implementation as described in the document these limitations will result in the user and group linked to the user to track the same usage.</p>
<h3 class="anchor anchorWithStickyNavbar_NlAN" id="cluster-or-queue-based-tracking">Cluster or queue based tracking<a href="#cluster-or-queue-based-tracking" class="hash-link" aria-label="Direct link to Cluster or queue based tracking" title="Direct link to Cluster or queue based tracking">​</a></h3>
<p>Tracking user usage will be based on the usage per queue. The full hierarchy of the queue will be tracked. We should not just track the leaf or root of the hierarchy. The overall cluster usage is the same as the usage of the root queue. Cluster level usage does not need separate tracking.</p>
<p>The overhead of tracking per queue should be really limited. In most cases a user will run their workloads in a specific queue. Deeply nested queues do also add overhead to the tracking. During testing the impact of workload spread and or deep nesting needs to be assessed. If needed this can be called out in the documentation.</p>
<p>We also need to take into account that multiple members of a group could be using different queues in the hierarchy. If tracking usage would be limited to the leaf level, aggregating group usage becomes more difficult and loses transparency.</p>
<p>The documentation around limits, part of the enforcement, reference different limits at different levels for users or groups. Tracking at just the leaf or root level could break that functionality. The design should support the current documented features. If during enforcement design a different decision is made then the tracking is not the deciding factor.</p>
<h2 class="anchor anchorWithStickyNavbar_NlAN" id="application-tracking">Application tracking<a href="#application-tracking" class="hash-link" aria-label="Direct link to Application tracking" title="Direct link to Application tracking">​</a></h2>
<p>Applications go through a number of states within the core scheduler. Allocations linked to applications are the triggers for application state changes. From a tracking perspective we need to define what is considered a running application.</p>
<p>Since placeholders and placeholder timeout can play a role in state changes the implementation of the running application tracking must take into account these cases:</p>
<ul>
<li>no gang defined</li>
<li>gang defined, all or some placeholders replaced</li>
<li>gang style &quot;soft&quot; defined, all placeholders time out</li>
<li>gang style &quot;hard&quot; defined, all placeholders time out</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_NlAN" id="running-state-entry">Running state entry<a href="#running-state-entry" class="hash-link" aria-label="Direct link to Running state entry" title="Direct link to Running state entry">​</a></h3>
<p>The application when submitted and placed into a queue is in the <em>New</em> state. At this point there is no allocation or pending request present on the application. After one or more requests, <em>AllocationAsks</em>, are added the application moves into an <em>Accepted</em> state. The <em>Accepted</em> state is exited when the first <em>Allocation</em> is added to the application. The application then transitions into the Running state.</p>
<p>At this point a resource quota would be used by the application and the application should be considered as running from a tracking perspective. This means that the addition of the first <em>Allocation</em> onto the application also must be the trigger point for the increase of the running applications. This trigger point for tracking is when the application is in the <em>Accepted</em> state. This is also the point at which the group for the usage tracking needs to be set as described in the <a href="#group-limitations">group limitations</a>.</p>
<p>Note that currently, the application state transition code block in application_state.go updates the application running queue metrics when the application enters <em>Running</em> state. The metric must be updated to be consistent with the above definition of a running application. Linking this back to a state transition the entry into the Running state should be used.</p>
<h3 class="anchor anchorWithStickyNavbar_NlAN" id="running-state-exit">Running state exit<a href="#running-state-exit" class="hash-link" aria-label="Direct link to Running state exit" title="Direct link to Running state exit">​</a></h3>
<p>An application should be considered running as long as at least one allocation is assigned to the application. The removal of the last allocation should decrease the number of running applications. However, we also need to consider the pending requests.</p>
<p>As part of the application states the application enters into a <em>Completing</em> state when the last allocation is removed and there are no pending requests. This automatically progresses into the <em>Completed</em> state if nothing changes for the application. Applications going into the <em>Completing</em> state all have no allocations left and pending requests are considered. The entry of the <em>Completing</em> state thus could be used as a point for triggering the decrease of the running application count.</p>
<p>However there are circumstances that the application goes from the <em>Completing</em> state back into a <em>Running</em> state. This is linked to auto restart of a pod by Kubernetes. This case must be handled.</p>
<p>A last case that needs to be considered is an application that fails. If an application fails it moves into the Failing state. The application does not enter <em>Completing</em> but could have incremented the running applications. A failure could be triggered by the gang scheduling style &quot;hard&quot; or the removal of a partition.</p>
<h2 class="anchor anchorWithStickyNavbar_NlAN" id="resource-usage-tracking">Resource usage tracking<a href="#resource-usage-tracking" class="hash-link" aria-label="Direct link to Resource usage tracking" title="Direct link to Resource usage tracking">​</a></h2>
<p>Resource usage is tracked simply based on the addition or removal of an allocation.</p>
<p>Removal of an allocation is an out-of-band action. The shim notifies the core scheduler that an allocation no longer exists and the core updates the tracking based on that removal. If an allocation is preempted the core initiates the removal but still gets notified by the shim that the removal has occurred. Until the confirmation of the shim is received no tracking updates must be created.</p>
<p>The replacement of a placeholder by the real allocation for gang scheduling follows a similar concept. However, in that case there is a possibility that there is a discrepancy between the placeholder size and the real allocation. See <a href="https://issues.apache.org/jira/browse/YUNIKORN-982" target="_blank" rel="noopener noreferrer">YUNIKORN-982</a> for more detailed information on this issue. The changes that fixed the accounting for the queues and nodes also need to be taken into account for user based resource tracking.</p>
<p>Adding a new allocation to an application triggers the update of the tracked resources for the user and or group as described in the <a href="#group-limitations">group limitations</a>. Enforcement is not a goal of the design document but the enforcement implementation needs to be taken into account. The point to add the resource usage must line up with the point that the queue structure is currently updated and the queue quotas are enforced.</p>
<p>The order of the updates: queue structure first then user or user first then queue structure is debatable. The current proposal is to implement the following:</p>
<ul>
<li>Update user and group based usage</li>
<li>Queue quota enforcement and update</li>
<li>If the queue enforcement fails, roll back the user and group based update.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_NlAN" id="scheduler-transparency">Scheduler transparency<a href="#scheduler-transparency" class="hash-link" aria-label="Direct link to Scheduler transparency" title="Direct link to Scheduler transparency">​</a></h2>
<p>Resource usage tracking is based on the allocated resource, and linked to the application’s queue path and the application’s <em>user</em> field. Application tracking is a simple count of the applications, and is linked to the application’s queue path and the application’s user field.
As an extension on this we could consider adding the <em>applicationID</em> into the tracking of the running applications to help with troubleshooting. This is part of the current proposal. The proposal is to not link the running application tracking to the applicationID.</p>
<p>The user field of an application is the earlier mentioned <em>security.UserGroup</em> object and has all the identifying details needed to track the usage.</p>
<p>From the schedulers perspective there should be no special setup needed. The tracking should always work without the need to pre-create a user, group or queue based entry. This means that the tracking cannot fail even if the user or group has no enforcement linked to it and does not exist in the tracker.</p>
<p>In summary the tracker must implement:</p>
<ul>
<li>User and or group creation on the fly.</li>
<li>Auto cleanup of tracking information no longer needed.</li>
<li>Configuration processing needed for enforcement.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_NlAN" id="user-group-manager-ugm">User Group Manager (UGM)<a href="#user-group-manager-ugm" class="hash-link" aria-label="Direct link to User Group Manager (UGM)" title="Direct link to User Group Manager (UGM)">​</a></h2>
<p>Tracking all the resources will be part of a new self-contained module in the scheduler. This means that there must be no imports from the <code>scheduler.objects</code> package. This will allow us to run the tracker separately and push updates, if needed, into a background processing queue.</p>
<p>There will be one user group manager created per partition as part of the partition creation process. There will be no tracking of user quotas over a partition boundary.</p>
<p>The new self-contained module, user group manager contains all specifications and code for tracking and can be extended in the future to include enforcement code.</p>
<p>Tracking the resources and application count for all users occurs from startup. This happens irrespective of whether enforcement is configured for the user or group. By starting tracking independently of the enforcement changes in enforcement will always have a consistent view of the resources tracked at least at a user level. Recovery must be tested in combination with the tracking code.</p>
<p>Storing data in the user group manager is based on the <em>security.UserGroup</em> structure content. The built-in <em>UserGroupCache</em> resolution cannot guarantee that the same object is returned for the same user each time.</p>
<h3 class="anchor anchorWithStickyNavbar_NlAN" id="usergroup-cache-impact">UserGroup cache impact<a href="#usergroup-cache-impact" class="hash-link" aria-label="Direct link to UserGroup cache impact" title="Direct link to UserGroup cache impact">​</a></h3>
<p>The concept of a stable user entry in the cache is not currently present in the <em>UserGroupCache</em>. This concept will most likely also not be possible based on the fact that group resolution does not guarantee ordering. Based on the assumption that we cannot guarantee group ordering for all group resolutions that are possible the tracking will not rely on it.</p>
<p>Currently, <em>UserGroupCache</em> holds the <em>UserGroup</em> object entry only for the cache period. This is either 300 seconds for a positive resolution or 30 seconds for a negative resolution. After this cache time the entry will be deleted as part of the cache cleanup/expiration process. If the same user submits a second application after the expiry, a new <em>UserGroup</em> object will be created and stored in the cache. The <em>UserGroup</em> object has a property &quot;resolved&quot;, which holds a timestamp at which the user group resolution has been executed for the first time. The cache cleaner wakes up after every 60 seconds and deletes all entries whose &quot;resolved&quot;  timestamp is older than the cache timeout.</p>
<p>Other internal changes might be needed to make sure all <em>UserGroup</em> objects are cached correctly and returned as expected internally in the cache. These are left as implementation details for the cache changes.</p>
<h3 class="anchor anchorWithStickyNavbar_NlAN" id="tracking-structure">Tracking structure<a href="#tracking-structure" class="hash-link" aria-label="Direct link to Tracking structure" title="Direct link to Tracking structure">​</a></h3>
<p>The user group Manager must be able to track usage for users and groups. Users are the primary access point for all tracking. The user group Manager structure will implement the <a href="#tracker-interface">tracker interface</a>.</p>
<div class="codeBlockContainer_l7z8 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_N19i"><pre tabindex="0" class="prism-code language-text codeBlock_adB6 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_fSw7"><span class="token-line" style="color:#bfc7d5"><span class="token plain">package user_group_manager</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type Manager struct {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  users  map[string]*userTracker</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  groups map[string]*groupTracker</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sync.RWMutex</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(m *Manager) checkAppGroup(queuePath, applicationID string, user *security.UserGroup)</span><br></span></code></pre><div class="buttonGroup_ZiWg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Gl1a" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mJ2i"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_rLlY"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>All objects in the user group manager will be managed internally. Creation of user and or group tracker objects is based on the request to track usage. The objects are added to one of the two structures in the user group manager. Adding user or group objects can only be triggered by an increase of tracked resources. The creation of the user and or group tracker objects is handled by the user group manager. The user group manager is also responsible for setting the usage information for the queue hierarchy directly after creation.</p>
<p>The resolution of the group that the usage is tracked against for an application is handled by the user group Manager via the checkAppGroup. As part of an increase of resource usage the Manager will check if the application is already tracked for the user. If the application is already tracked nothing changes. If the application is not tracked the manager will resolve the group to track against and update the userTracker object. If there is no active tracker registered for the group a new groupTracker object will be created and initialised as required.</p>
<p>Removal of user or group objects can only be triggered after a decrease of tracked resources has removed the last usage. Usage tracked for a user must be zero. For group tracker objects the application reference count must be zero.
Removal of the user and or group tracker objects is done periodically. This cleanup must be <code>go routine</code> safe. Updates to either map could be triggered from different routines, scheduler allocation processing or a release of an allocation by a shim.</p>
<h3 class="anchor anchorWithStickyNavbar_NlAN" id="tracker-interface">Tracker interface<a href="#tracker-interface" class="hash-link" aria-label="Direct link to Tracker interface" title="Direct link to Tracker interface">​</a></h3>
<p>The interface describes the functions that will be exposed by the user group manager. The other scheduler components can rely on the functions defined in the interface to be available to increase, decrease applications and or resource usage and get the tracked resources.</p>
<div class="codeBlockContainer_l7z8 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_N19i"><pre tabindex="0" class="prism-code language-text codeBlock_adB6 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_fSw7"><span class="token-line" style="color:#bfc7d5"><span class="token plain">package user_group_manager</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type Tracker interface {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  GetUserResources(user *security.UserGroup) *Resource</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  GetGroupResources(group string) *Resource</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  GetUsersResources() []*userTracker</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  GetGroupsResources() []*groupTracker</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  IncreaseTrackedResource(queuePath, applicationID string, usage *Resource, user *security.UserGroup) error</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  DecreaseTrackedResource(queuePath, applicationID string, usage *Resource, removeApp bool, user *security.UserGroup) error</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_ZiWg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Gl1a" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mJ2i"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_rLlY"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <em>IncreaseTrackedResource()</em> and <em>DecreaseTrackedResource()</em> calls will implement the tracking data updates. The Get* calls are providing safe access to the tracked data to be used as part of exposing the data in the REST interface. See <a href="#exposure-of-usage-tracking">exposure of usage tracking</a> for more detail.</p>
<p>Applications are added automatically during the call to increase the tracked resources. The first time the applicationID is encountered the structures are updated accordingly and tracking starts. The removal of the application is triggered by leaving the <a href="#running-state-exit">running state</a>, this is equivalent to the removal of the last usage and must also set the removeApp flag to true.</p>
<p>Calling <em>IncreaseTrackedResource()</em> and <em>DecreaseTrackedResource()</em> with empty or nil parameters is not allowed and will return an error to be handled by the caller. The <em>GetUserResource</em> and <em>GetGroupResource</em> calls can return a <em>nil</em> Resource value. The <em>GetUsersResource</em> and <em>GetGroupsResource</em> calls can return an empty slice.</p>
<h3 class="anchor anchorWithStickyNavbar_NlAN" id="user-tracking">User tracking<a href="#user-tracking" class="hash-link" aria-label="Direct link to User tracking" title="Direct link to User tracking">​</a></h3>
<p>The userTracker contains all tracked usage information for a user. Changes for all usage, even the group usage, are part of the change that gets triggered on the user object.</p>
<p>The userTracker object contains a reference map to the usage for each application that is tracked linking it to the groupTracker object for the specific application. Multiple applications can be tracked against the same groupTracker object.</p>
<p>The group references will be set for each application when usage is added for an application and is not mutable. The existence of a groupTracker for the application can be checked by calling <em>hasGroupForApp</em> on the userTracker object. It returns true in case the application ID exists in the group mapping, false if it does not. The return value is only based on the existence of the applicationID as the key, not on the value it references.</p>
<p>The groupTracker can be set in the userTracker object by calling <em>setGroupForApp</em>. If the applicationID already exists, the call to set the groupTracker reference is a noop, nothing will change. The reference cannot be changed after it is set. The groupTracker reference can be nil. In the case of a nil reference, no tracking for that application against a group is performed. Even a nil reference cannot be replaced.</p>
<p>An increase or decrease of the resources tracked for the user requires the applicationID to be set to a non-empty value. On removal of the last allocation for the application the group reference will be removed from the userTracker object. To remove a running application from the userTracker the applicationID must be set in the <em>decreaseResource</em> call and the flag removeApp must be set to true. Removal of the groupTracker reference can only occur as part of a <em>decreaseResource</em> call.</p>
<p>If there are no applications left in the group references the object will be removed by the cleanup run from the user group manager. This will also mean that there is no usage tracked anymore by the referenced queueTracker object.</p>
<p>The usage per queue is stored in a queue structure specific for this user. The queueTracker object provides a hierarchical structure. This structure starts at the root of the queue hierarchy and only contains child queues for which a usage is being tracked. The hierarchy must be updated, add or delete of child entries, as part of the updates that are processed.</p>
<p>The creation of the root queueTracker is part of the creating a new userTracker object.</p>
<div class="codeBlockContainer_l7z8 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_N19i"><pre tabindex="0" class="prism-code language-text codeBlock_adB6 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_fSw7"><span class="token-line" style="color:#bfc7d5"><span class="token plain">package user_group_manager</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type userTracker struct {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  userName  string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  group     map[string]*groupTracker</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  queue     *queueTracker</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sync.RWMutex</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">newUserTracker(queuePath string, user *security.UserGroup) *userTracker</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(ut *userTracker) increaseResource(queuePath, applicationID string, usage *Resource)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(ut *userTracker) decreaseResource(queuePath, applicationID string, usage *Resource, removeApp bool)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(ut *userTracker) hasGroupForApp(applicationID string) bool</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(ut *userTracker) setGroupForApp(applicationID string, groupTrack *groupTracker)</span><br></span></code></pre><div class="buttonGroup_ZiWg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Gl1a" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mJ2i"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_rLlY"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_NlAN" id="group-tracking">Group tracking<a href="#group-tracking" class="hash-link" aria-label="Direct link to Group tracking" title="Direct link to Group tracking">​</a></h3>
<p>The groupTracker contains all tracked usage information for a group. This object can be shared by multiple users for one or more applications. It adds the applications that are tracked for this specific group automatically to the list. For this it expects an applicationID to be set to a non-empty value for each <em>increaseResource</em> call.</p>
<p>To simply decrease the resources tracked for the group the applicationID could be empty. On removal of the last allocation for the application the application will be removed from the groupTracker object. To remove a running application from the groupTracker the applicationID must be set in the <em>decreaseResource</em> call and the flag removeApp must be set to true.</p>
<p>If there are no entries left in the applications tracked in the groupTracker the object will be removed by the cleanup run from the user group manager. This will also mean that there is no usage tracked any more by the referenced queueTracker object.</p>
<p>The usage per queue is stored in a queue structure specific for this group. The queueTracker object provides a hierarchical structure. This structure starts at the root of the queue hierarchy and only contains child queues for which a usage is being tracked. The hierarchy must be updated, add or delete of child entries, as part of the updates that are processed.</p>
<p>The creation of the root queueTracker is part of the creating a new groupTracker object.</p>
<div class="codeBlockContainer_l7z8 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_N19i"><pre tabindex="0" class="prism-code language-text codeBlock_adB6 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_fSw7"><span class="token-line" style="color:#bfc7d5"><span class="token plain">package user_group_manager</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type groupTracker struct {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  groupName    string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  applications map[string]bool</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  queue        *queueTracker</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sync.RWMutex</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">newGroupTracker(queuePath string, group string) *groupTracker</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(gt *groupTracker) increaseResource(queuePath, applicationID string, usage *Resource)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(gt *groupTracker) decreaseResource(queuePath, applicationID string, usage *Resource, removeApp bool)</span><br></span></code></pre><div class="buttonGroup_ZiWg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Gl1a" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mJ2i"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_rLlY"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_NlAN" id="queue-tracking">Queue tracking<a href="#queue-tracking" class="hash-link" aria-label="Direct link to Queue tracking" title="Direct link to Queue tracking">​</a></h3>
<p>The queueTracker acts as a base for both user and group tracking. It provides the actual location for the tracked usage.The top of the structure, which is referenced from the userTracker or groupTracker objects, contains the root queue usage. The queueTracker is only referenced by one userTracker or one groupTracker object and must not be shared. This means that we should not require any locking within the queueTracker object.</p>
<p>The queue hierarchy below the root, for which a usage is registered, is part of the childQueues. Each part of the full queue path creates a new level of objects. This structure shows a sparse hierarchical queue structure. It may not represent the full queue structure as known in the scheduler.</p>
<p>The creation of the root queueTracker returns a plain object without usage set and a fixed queueName of &quot;root&quot;. The usage should then be updated by a call to <em>increaseResource</em>. The call must handle the recursive creation of the queue path as given. It expects an applicationID to be set to a non-empty value for each call.</p>
<p>To simply decrease the resources tracked for the queue the applicationID can be empty. On removal of the last allocation for the application the application will be removed from the queueTracker. To remove a running application from the queueTracker the applicationID must be set in the <em>decreaseResource</em> call and the flag removeApp must be set to true.</p>
<div class="codeBlockContainer_l7z8 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_N19i"><pre tabindex="0" class="prism-code language-text codeBlock_adB6 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_fSw7"><span class="token-line" style="color:#bfc7d5"><span class="token plain">package user_group_manager</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">type queueTracker struct {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  queueName           string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  resourceUsage       *Resource</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  runningApplications map[string]boolean</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  childQueues   map[string]*queueTracker</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">newQueueTracker() *queueTracker</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(qt *queueTracker) increaseResource(queuePath, applicationID string, usage *Resource)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(qt *queueTracker) decreaseResource(queuePath, applicationID string, usage *Resource, removeApp bool)</span><br></span></code></pre><div class="buttonGroup_ZiWg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Gl1a" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mJ2i"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_rLlY"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_NlAN" id="update-consistency">Update consistency<a href="#update-consistency" class="hash-link" aria-label="Direct link to Update consistency" title="Direct link to Update consistency">​</a></h3>
<p>All changes are triggered against a userTracker object. Since enforcement of a quota is out of scope of this design we can ignore update failures due to quota exhaustion. There is no requirement or possibility that updates need to be rolled back.</p>
<p>Usage updates can be triggered from two points: allocation by the scheduler and releases by a shim. Allocations as well as releases need to update both user and group usage information. We must guarantee that for both the full hierarchy is changed or neither are changed.</p>
<p>The releases are also processed asynchronously from the scheduling cycle. This means that we have to be able to guarantee that the increases and decreases are applied consistently to both objects also. Locking of the objects to serialise changes must be in place to support this.</p>
<p>The other point is the update ordering and locking. The increase and decrease processing must follow the same order. Both must update the userTracker and related groupTracker objects in the same order. This is a requirement to prevent the processing of being able to deadlock while updating the same user for a simultaneous increase and decrease.</p>
<p>For groupTracker updates that originate from two different users the locking of the groupTracker object is required. One of the two updates will be able to proceed while the other waits for the update to finalise.</p>
<p>A final consideration is the consistency of two updates on the same object that follow each other closely. If the first update removes all existing usage the userTracker or groupTracker object is cleared for removal. While the update is in progress a second update comes in to add a new usage to the same object. The resolution of the userTracker in the user group manager has finished. The code has a reference to the object. Processing is waiting to lock the userTracker object. This point could cause the object to become unlinked and usage tracking information to be lost. The implementation needs to prevent this race condition.</p>
<h3 class="anchor anchorWithStickyNavbar_NlAN" id="exposure-of-usage-tracking">Exposure of usage tracking<a href="#exposure-of-usage-tracking" class="hash-link" aria-label="Direct link to Exposure of usage tracking" title="Direct link to Exposure of usage tracking">​</a></h3>
<p>The usage tracking information that is part of the user group manager must be exposed for external consumption. All our current information is exposed via a REST call.</p>
<p>Based on the current REST api definition for other object the proposal is to expose the following new endpoints:</p>
<ul>
<li>/ws/v1/partition/{partitionName}/usage/users</li>
<li>/ws/v1/partition/{partitionName}/usage/groups</li>
</ul>
<p>For both endpoints we expose the full queue hierarchy. As an example below the approximate output for the user&#x27;s endpoint for one user:</p>
<div class="language-json codeBlockContainer_l7z8 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_N19i"><pre tabindex="0" class="prism-code language-json codeBlock_adB6 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_fSw7"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;userName&quot;: &quot;user1&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;groups&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;app2&quot;: &quot;tester&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;queues&quot;:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;queuename&quot;: &quot;root&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;resourceUsage&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;memory&quot;: 12000000000,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;vcore&quot;: 12000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;runningApplications&quot;: [&quot;app1&quot;, &quot;app2&quot;],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;children&quot;: [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;queuename&quot;: &quot;root.default&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;resourceUsage&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;memory&quot;: 6000000000,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;vcore&quot;: 6000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;runningApplications&quot;: [&quot;app1&quot;],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;children&quot;: []</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;queuename&quot;: &quot;root.test&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;resourceUsage&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;memory&quot;: 6000000000,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;vcore&quot;: 6000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;runningApplications&quot;: [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;app2&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          ],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;children&quot;: []</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup_ZiWg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Gl1a" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mJ2i"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_rLlY"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>An example below the approximate output for the groups endpoint for one group:</p>
<div class="language-json codeBlockContainer_l7z8 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_N19i"><pre tabindex="0" class="prism-code language-json codeBlock_adB6 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_fSw7"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;groupName&quot; : &quot;tester&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;applications&quot;: [&quot;app2&quot;],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;queues&quot;:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;queuename&quot;: &quot;root&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;resourceUsage&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;memory&quot;: 6000000000,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;vcore&quot;: 6000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;runningApplications&quot;: [&quot;app2&quot;],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;children&quot;: [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;queuename&quot;: &quot;root.test&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;resourceUsage&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;memory&quot;: 6000000000,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;vcore&quot;: 6000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;runningApplications&quot;: [&quot;app2&quot;],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;children&quot;: []</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup_ZiWg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Gl1a" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mJ2i"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_rLlY"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/design/user_group"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">User/Group handling and lookup design</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/design/user_group_resource_usage_enforcement"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">User Based Quota Enforcement</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_odww thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#goals" class="table-of-contents__link toc-highlight">Goals</a></li><li><a href="#non-goals" class="table-of-contents__link toc-highlight">Non Goals</a></li><li><a href="#tracking-definitions" class="table-of-contents__link toc-highlight">Tracking definitions</a><ul><li><a href="#user-vs-group-tracking" class="table-of-contents__link toc-highlight">User vs Group tracking</a></li><li><a href="#group-limitations" class="table-of-contents__link toc-highlight">Group limitations</a></li><li><a href="#cluster-or-queue-based-tracking" class="table-of-contents__link toc-highlight">Cluster or queue based tracking</a></li></ul></li><li><a href="#application-tracking" class="table-of-contents__link toc-highlight">Application tracking</a><ul><li><a href="#running-state-entry" class="table-of-contents__link toc-highlight">Running state entry</a></li><li><a href="#running-state-exit" class="table-of-contents__link toc-highlight">Running state exit</a></li></ul></li><li><a href="#resource-usage-tracking" class="table-of-contents__link toc-highlight">Resource usage tracking</a></li><li><a href="#scheduler-transparency" class="table-of-contents__link toc-highlight">Scheduler transparency</a></li><li><a href="#user-group-manager-ugm" class="table-of-contents__link toc-highlight">User Group Manager (UGM)</a><ul><li><a href="#usergroup-cache-impact" class="table-of-contents__link toc-highlight">UserGroup cache impact</a></li><li><a href="#tracking-structure" class="table-of-contents__link toc-highlight">Tracking structure</a></li><li><a href="#tracker-interface" class="table-of-contents__link toc-highlight">Tracker interface</a></li><li><a href="#user-tracking" class="table-of-contents__link toc-highlight">User tracking</a></li><li><a href="#group-tracking" class="table-of-contents__link toc-highlight">Group tracking</a></li><li><a href="#queue-tracking" class="table-of-contents__link toc-highlight">Queue tracking</a></li><li><a href="#update-consistency" class="table-of-contents__link toc-highlight">Update consistency</a></li><li><a href="#exposure-of-usage-tracking" class="table-of-contents__link toc-highlight">Exposure of usage tracking</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Blog</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://blog.cloudera.com/yunikorn-a-universal-resources-scheduler/" target="_blank" rel="noopener noreferrer" class="footer__link-item">What&#x27;s YuniKorn?<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://blog.cloudera.com/spark-on-kubernetes-gang-scheduling-with-yunikorn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Spark on Kubernetes – Gang Scheduling with YuniKorn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Code Repositories</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/apache/yunikorn-core/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Core scheduler<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/yunikorn-k8shim" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kubernetes shim<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/yunikorn-scheduler-interface" target="_blank" rel="noopener noreferrer" class="footer__link-item">Scheduler Interface<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/yunikorn-web" target="_blank" rel="noopener noreferrer" class="footer__link-item">WEB application<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/yunikorn-site" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/community/get_involved">Get Involved</a></li><li class="footer__item"><a class="footer__link-item" href="/community/people">People</a></li><li class="footer__item"><a href="https://issues.apache.org/jira/projects/YUNIKORN/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
<div style="font-size: 70%">
Copyright © 2020-2024 <a href="https://www.apache.org/">The Apache Software Foundation</a>. Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>. <br>
<div style="padding:20px; margin: 10px; color: #4d4d4d;">
<p>The Apache Software Foundation Apache YuniKorn, YuniKorn, Apache, the Apache feather, and the Apache YuniKorn project logo are either registered trademarks or trademarks of the Apache Software Foundation.</p>
</div>
</div></div></div></div></footer></div>
</body>
</html>