<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-1.0.0 docs-doc-page docs-doc-id-design/scheduler_core_design" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">Scheduler Core Design | Apache YuniKorn</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://yunikorn.apache.org/img/logo/yunikorn-logo-main.png"><meta data-rh="true" name="twitter:image" content="https://yunikorn.apache.org/img/logo/yunikorn-logo-main.png"><meta data-rh="true" property="og:url" content="https://yunikorn.apache.org/docs/1.0.0/design/scheduler_core_design"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="1.0.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-1.0.0"><meta data-rh="true" name="docsearch:version" content="1.0.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-1.0.0"><meta data-rh="true" property="og:title" content="Scheduler Core Design | Apache YuniKorn"><meta data-rh="true" name="description" content="&lt;!--"><meta data-rh="true" property="og:description" content="&lt;!--"><link data-rh="true" rel="icon" href="/img/yunikorn.ico"><link data-rh="true" rel="canonical" href="https://yunikorn.apache.org/docs/1.0.0/design/scheduler_core_design"><link data-rh="true" rel="alternate" href="https://yunikorn.apache.org/docs/1.0.0/design/scheduler_core_design" hreflang="en"><link data-rh="true" rel="alternate" href="https://yunikorn.apache.org/docs/1.0.0/design/scheduler_core_design" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://Q1V951BG2V-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Apache YuniKorn" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.57f4caef.css">
<script src="/assets/js/runtime~main.dd672f16.js" defer="defer"></script>
<script src="/assets/js/main.1ba8fec7.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fIH8" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar__FTF" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarPlaceholder_wDNR"></div><div class="content_DgxC announcementBarContent_HmXy">1.5.1 has been released, check the <a href="/community/download">DOWNLOADS</a>.</div><button type="button" aria-label="Close" class="clean-btn close closeButton_KmNL announcementBarClose_BG67"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo/yunikorn_blue_logo.png" alt="YuniKorn Site Logo" class="themedComponent_yzub themedComponent--light_pOwb"><img src="/img/logo/yunikorn_white_logo.png" alt="YuniKorn Site Logo" class="themedComponent_yzub themedComponent--dark_xdnF"></div><b class="navbar__title text--truncate">Apache YuniKorn</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/community/roadmap">Roadmap</a><a class="navbar__item navbar__link" href="/community/download">Download</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community/get_involved">Get Involved</a></li><li><a class="dropdown__link" href="/community/how_to_contribute">How to Contribute</a></li><li><a class="dropdown__link" href="/community/coding_guidelines">Coding Guidelines</a></li><li><a class="dropdown__link" href="/community/reporting_issues">Reporting Issues</a></li><li><a class="dropdown__link" href="/community/release_procedure">Release Procedure</a></li><li><a class="dropdown__link" href="/community/events">Events</a></li><li><a class="dropdown__link" href="/community/people">People</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Apache</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Apache Software Foundation<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsors<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy Policy<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/1.0.0/">1.0.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/">Next</a></li><li><a class="dropdown__link" href="/docs/">1.5.1</a></li><li><a class="dropdown__link" href="/docs/1.5.0/">1.5.0</a></li><li><a class="dropdown__link" href="/docs/1.4.0/">1.4.0</a></li><li><a class="dropdown__link" href="/docs/1.3.0/">1.3.0</a></li><li><a class="dropdown__link" href="/docs/1.2.0/design/scheduler_core_design">1.2.0</a></li><li><a class="dropdown__link" href="/docs/1.1.0/design/scheduler_core_design">1.1.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/1.0.0/design/scheduler_core_design">1.0.0</a></li><li><a class="dropdown__link" href="/docs/0.12.2/design/scheduler_core_design">0.12.2</a></li><li><a class="dropdown__link" href="/docs/0.12.1/design/scheduler_core_design">0.12.1</a></li><li><a class="dropdown__link" href="/docs/0.11.0/design/scheduler_core_design">0.11.0</a></li><li><a class="dropdown__link" href="/docs/0.10.0/design/scheduler_core_design">0.10.0</a></li><li><a class="dropdown__link" href="/docs/0.9.0/design/scheduler_core_design">0.9.0</a></li><li><a class="dropdown__link" href="/docs/0.8.0/">0.8.0</a></li></ul></div><a href="https://github.com/apache/yunikorn-core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_CXxL colorModeToggle_r3Ku"><button class="clean-btn toggleButton_A2Gq toggleButtonDisabled_MBgh" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_ZNXA"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon__KEK"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_eonw"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_txSM"><div class="docsWrapper_aujV"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_fDTy" type="button"></button><div class="docRoot_ITF8"><aside class="theme-doc-sidebar-container docSidebarContainer_coE9"><div class="sidebarViewport_XDus"><div class="sidebar_duME"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_d40_ menuWithAnnouncementBar_QXd6"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/1.0.0/">Get Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/1.0.0/user_guide/deployment_modes">User Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/1.0.0/developer_guide/env_setup">Developer Guide</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/developer_guide/env_setup">Dev Environment Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/developer_guide/build">Build and Run</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/developer_guide/dependencies">Go module updates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/developer_guide/deployment">Deploy to Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/developer_guide/openshift_development">Development in CodeReady Containers</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/1.0.0/design/architecture">Designs</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/design/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/1.0.0/design/scheduler_core_design">Scheduler Core Design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/design/cache_removal">Scheduler cache removal design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/design/k8shim">Kubernetes Shim Design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/design/cross_queue_preemption">Cross Queue Preemption</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/design/namespace_resource_quota">Namespace Resource Quota</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/design/pluggable_app_management">Pluggable App Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/design/resilience">Resilience</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/design/predicates">Support K8s Predicates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/design/scheduler_configuration">Scheduler Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/design/state_aware_scheduling">Batch Workloads Ordering with StateAware Policy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/design/scheduler_object_states">Scheduler Object States</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/design/gang_scheduling">Gang scheduling design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/1.0.0/design/scheduler_plugin">K8s Scheduler Plugin</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/1.0.0/performance/evaluate_perf_function_with_kubemark">Performance</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_fQ9A"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_L8rf"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Apache YuniKorn<!-- --> <b>1.0.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/">latest version</a></b> (<!-- -->1.5.1<!-- -->).</div></div><div class="docItemContainer_J6oa"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer__4Nk" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_lw5W"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Developer Guide</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Designs</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Scheduler Core Design</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 1.0.0</span><div class="tocCollapsible_hejs theme-doc-toc-mobile tocMobile_K3aG"><button type="button" class="clean-btn tocCollapsibleButton_a3TS">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Scheduler Core Design</h1></header><div class="theme-admonition theme-admonition-caution admonition_pqkm alert alert--warning"><div class="admonitionHeading_r0oI"><span class="admonitionIcon_Oz24"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_usWX"><p>The scheduler core design has changed. <a href="https://issues.apache.org/jira/browse/YUNIKORN-317" target="_blank" rel="noopener noreferrer">YUNIKORN-317</a> was committed and has removed the scheduler cache.
This document will not be maintained and is just for historical reference.
See <a href="/docs/1.0.0/design/cache_removal">scheduler cache removal design</a></p></div></div>
<p>Github repo: <a href="https://github.com/apache/yunikorn-core" target="_blank" rel="noopener noreferrer">https://github.com/apache/yunikorn-core</a></p>
<p>Scheduler core encapsulates all scheduling algorithms, it collects resources from underneath resource management
platforms (like YARN/K8s), and is responsible for container allocation requests. It makes the decision where is the
best spot for each request and then sends response allocations to the resource management platform.
Scheduler core is agnostic about underneath platforms, all the communications are through the <a href="https://github.com/apache/yunikorn-scheduler-interface" target="_blank" rel="noopener noreferrer">scheduler interface</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_NlAN" id="components">Components:<a href="#components" class="hash-link" aria-label="Direct link to Components:" title="Direct link to Components:">​</a></h2>
<div class="codeBlockContainer_l7z8 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_N19i"><pre tabindex="0" class="prism-code language-text codeBlock_adB6 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_fSw7"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                     +---------------+  +--------------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                     |K8s Shim       |  |YARN Shim     |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                     +---------------+  +--------------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                +--------------+   +------------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                Scheduler-      | GRPC Protocol|   |Go API      |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                Interface:      +--------------+   +------------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">+---------------------------------------------------------------------------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                     +--------------------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                     |Scheduler API Server|</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> +-------------+     +---------+----------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> |AdminService |               |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> +-------------+               |Write Ops                    +----------------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> +-------------+               V                            ++Scheduler       |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> |Configurator |      +-------------------+  Allocate       ||   And          |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> +-------------+      |Cache Event Handler+&lt;-----------------|                |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         +----------&gt; +-------------------+  Preempt        ++Preemptor       |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          Update Cfg   Handled by policies                   +----------------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                               +  (Stateless)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        +------v--------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        |Scheduler Cache|</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        +---------------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                +---------------------------------------------+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                |--------+ +------+ +----------+ +----------+ |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                ||Node   | |Queue | |Allocation| |Requests  | |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                |--------+ +------+ +----------+ +----------+ |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                +---------------------------------------------+</span><br></span></code></pre><div class="buttonGroup_ZiWg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Gl1a" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mJ2i"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_rLlY"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_NlAN" id="scheduler-api-server-rmproxy">Scheduler API Server (RMProxy)<a href="#scheduler-api-server-rmproxy" class="hash-link" aria-label="Direct link to Scheduler API Server (RMProxy)" title="Direct link to Scheduler API Server (RMProxy)">​</a></h3>
<p>Responsible for communication between RM and Scheduler, which implements scheduler-interface GRPC protocol,
or just APIs. (For intra-process communication w/o Serde).</p>
<h3 class="anchor anchorWithStickyNavbar_NlAN" id="scheduler-cache">Scheduler Cache<a href="#scheduler-cache" class="hash-link" aria-label="Direct link to Scheduler Cache" title="Direct link to Scheduler Cache">​</a></h3>
<p>Caches all data related to scheduler state, such as used resources of each queues, nodes, allocations.
Relationship between allocations and nodes, etc. Should not include in-flight data for resource allocation.
For example to-be-preempted allocation candidates. Fair share resource of queues, etc.</p>
<h3 class="anchor anchorWithStickyNavbar_NlAN" id="scheduler-cache-event-handler">Scheduler Cache Event Handler<a href="#scheduler-cache-event-handler" class="hash-link" aria-label="Direct link to Scheduler Cache Event Handler" title="Direct link to Scheduler Cache Event Handler">​</a></h3>
<p>Handles all events which needs to update scheduler internal state. So all the write operations will be carefully handled.</p>
<h3 class="anchor anchorWithStickyNavbar_NlAN" id="admin-service">Admin Service<a href="#admin-service" class="hash-link" aria-label="Direct link to Admin Service" title="Direct link to Admin Service">​</a></h3>
<p>Handles request from Admin, which can also load configurations from storage and update scheduler policies.</p>
<h3 class="anchor anchorWithStickyNavbar_NlAN" id="scheduler-and-preemptor">Scheduler and Preemptor<a href="#scheduler-and-preemptor" class="hash-link" aria-label="Direct link to Scheduler and Preemptor" title="Direct link to Scheduler and Preemptor">​</a></h3>
<p>Handles Scheduler&#x27;s internal state. (Which is not belong to scheduelr cache), such as internal reservations, etc.
Scheduler and preemptor will work together, make scheduling or preemption decisions. All allocate/preempt request
will be handled by event handler.</p>
<h2 class="anchor anchorWithStickyNavbar_NlAN" id="schedulers-responsibility">Scheduler&#x27;s responsibility<a href="#schedulers-responsibility" class="hash-link" aria-label="Direct link to Scheduler&#x27;s responsibility" title="Direct link to Scheduler&#x27;s responsibility">​</a></h2>
<ul>
<li>According to resource usages between queues, sort queues, applications, and figure out order of application allocation. (This will be used by preemption as well).</li>
<li>It is possible that we cannot satisfy some of the allocation request, we need to skip them and find next request.</li>
<li>It is possible that some allocation request cannot be satisfied because of resource fragmentation. We need to reserve room for such requests.</li>
<li>Different nodes may belong to different disjoint partitions, we can make independent scheduler runs</li>
<li>Be able to config and change ordering policies for apps, queues.</li>
<li>Application can choose their own way to manage sort of nodes.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_NlAN" id="preemption">Preemption<a href="#preemption" class="hash-link" aria-label="Direct link to Preemption" title="Direct link to Preemption">​</a></h2>
<ul>
<li>It is important to know &quot;who wants the resource&quot;, so we can do preemption based on allocation orders.</li>
<li>When do preemption, it is also efficient to trigger allocation op. Think about how to do it.</li>
<li>Preemption needs to take care about queue resource balancing.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_NlAN" id="communication-between-shim-and-core">Communication between Shim and Core<a href="#communication-between-shim-and-core" class="hash-link" aria-label="Direct link to Communication between Shim and Core" title="Direct link to Communication between Shim and Core">​</a></h2>
<p>YuniKorn-Shim (like <a href="https://github.com/apache/yunikorn-k8shim" target="_blank" rel="noopener noreferrer">https://github.com/apache/yunikorn-k8shim</a>) communicates with core by
using scheduler-interface (<a href="https://github.com/apache/yunikorn-scheduler-interface" target="_blank" rel="noopener noreferrer">https://github.com/apache/yunikorn-scheduler-interface</a>).
Scheduler interface has Go API or GRPC. Currently, yunikorn-k8shim is using Go API to communicate with yunikorn-core
to avoid extra overhead introduced by GRPC.</p>
<p><strong>Shim (like K8shim) first need to register with core:</strong></p>
<div class="language-go codeBlockContainer_l7z8 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_N19i"><pre tabindex="0" class="prism-code language-go codeBlock_adB6 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_fSw7"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">m </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">RMProxy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">RegisterResourceManager</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">request </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">si</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">RegisterResourceManagerRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> callback api</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ResourceManagerCallback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">si</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">RegisterResourceManagerResponse</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_ZiWg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Gl1a" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mJ2i"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_rLlY"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Which indicate ResourceManager&#x27;s name, a callback function for updateResponse. The design of core is be able to do scheduling for multiple clusters (such as multiple K8s cluster) just with one core instance.</p>
<p><strong>Shim interacts with core by invoking RMProxy&#x27;s Update API frequently, which updates new allocation request, allocation to kill, node updates, etc.</strong></p>
<div class="language-go codeBlockContainer_l7z8 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_N19i"><pre tabindex="0" class="prism-code language-go codeBlock_adB6 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_fSw7"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">m </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">RMProxy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">Update</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">request </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">si</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">UpdateRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><br></span></code></pre><div class="buttonGroup_ZiWg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Gl1a" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mJ2i"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_rLlY"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Response of update (such as new allocated container) will be received by registered callback.</p>
<h2 class="anchor anchorWithStickyNavbar_NlAN" id="configurations--semantics">Configurations &amp; Semantics<a href="#configurations--semantics" class="hash-link" aria-label="Direct link to Configurations &amp; Semantics" title="Direct link to Configurations &amp; Semantics">​</a></h2>
<p>Example of configuration:</p>
<ul>
<li>
<p>Partition is name space.</p>
</li>
<li>
<p>Same queues can under different partitions, but enforced to have same hierarchy.</p>
<p>Good:</p>
<div class="codeBlockContainer_l7z8 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_N19i"><pre tabindex="0" class="prism-code language-text codeBlock_adB6 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_fSw7"><span class="token-line" style="color:#bfc7d5"><span class="token plain"> partition=x    partition=y</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     a           a</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   /   \        / \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  b     c      b   c</span><br></span></code></pre><div class="buttonGroup_ZiWg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Gl1a" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mJ2i"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_rLlY"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Good (c in partition y acl=&quot;&quot;):</p>
<div class="codeBlockContainer_l7z8 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_N19i"><pre tabindex="0" class="prism-code language-text codeBlock_adB6 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_fSw7"><span class="token-line" style="color:#bfc7d5"><span class="token plain"> partition=x    partition=y</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     a           a</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   /   \        /</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  b     c      b</span><br></span></code></pre><div class="buttonGroup_ZiWg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Gl1a" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mJ2i"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_rLlY"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Bad (c in different hierarchy)</p>
<div class="codeBlockContainer_l7z8 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_N19i"><pre tabindex="0" class="prism-code language-text codeBlock_adB6 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_fSw7"><span class="token-line" style="color:#bfc7d5"><span class="token plain"> partition=x    partition=y</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     a           a</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   /   \        /  \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  b     c      b    d</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              /</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             c</span><br></span></code></pre><div class="buttonGroup_ZiWg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Gl1a" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mJ2i"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_rLlY"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Bad (Duplicated c)</p>
<div class="codeBlockContainer_l7z8 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_N19i"><pre tabindex="0" class="prism-code language-text codeBlock_adB6 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_fSw7"><span class="token-line" style="color:#bfc7d5"><span class="token plain"> partition=x</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     a</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   /   \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  b     c</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> /</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">c</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_ZiWg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Gl1a" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mJ2i"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_rLlY"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Different hierarchies can be added</p>
<div class="language-scheduler-conf.yaml codeBlockContainer_l7z8 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_N19i"><pre tabindex="0" class="prism-code language-scheduler-conf.yaml codeBlock_adB6 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_fSw7"><span class="token-line" style="color:#bfc7d5"><span class="token plain">partitions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - name:  default</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    queues:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        root:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          configs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            acls:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          childrens:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            - a</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            - b</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            - c</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            - ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        a:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          configs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            acls:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            capacity: (capacity is not allowed to set for root)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            max-capacity: ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      mapping-policies:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - name: partition_a:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    queues:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        root:...</span><br></span></code></pre><div class="buttonGroup_ZiWg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Gl1a" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mJ2i"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_rLlY"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_NlAN" id="how-scheduler-do-allocation">How scheduler do allocation<a href="#how-scheduler-do-allocation" class="hash-link" aria-label="Direct link to How scheduler do allocation" title="Direct link to How scheduler do allocation">​</a></h2>
<p>Scheduler runs a separate goroutine to look at asks and available resources, and do resource allocation. Here&#x27;s allocation logic in pseudo code:</p>
<p>Entry point of scheduler allocation is <code>scheduler.go: func (s *Scheduler) schedule()</code></p>
<div class="codeBlockContainer_l7z8 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_N19i"><pre tabindex="0" class="prism-code language-text codeBlock_adB6 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_fSw7"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># First of all, YuniKorn has partition concept, a logical resource pool can consists</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># of one of multiple physical dis-joint partitions. It is similar to YARN&#x27;s node</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># partition concept.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">for partition : partitions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # YuniKorn can reserve allocations for picky asks (such as large request, etc.)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # Before doing regular allocation, YuniKorn look at reservedAllocations first.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  for reservedAllocation : partition.reservedAllocations: </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     reservedAllocation.tryAllocate(..)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # After tried all reserved allocation, YuniKorn will go to regular allocation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  partition.tryAllocate(..)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # If there&#x27;s any allocation created, scheduler will create an AllocationProposal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  # and send to Cache to &quot;commit&quot; the AllocationProposal </span><br></span></code></pre><div class="buttonGroup_ZiWg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Gl1a" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mJ2i"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_rLlY"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Allocation by hierchical of queues</strong></p>
<p>Inside <code>partition.tryAllocate</code></p>
<p>It recursively traverse from root queue and down to lower level, for each level, logic is inside <code>pkg/scheduler/scheduling_queue.go func (sq *SchedulingQueue) tryAllocate</code></p>
<p>Remember YuniKorn natively supports hierarchical of queues. For ParentQueue (which has sub queues under the parent queue), it uses queue&#x27;s own sorting policy to sort subqueues and try to allocate from most preferred queue to least-preferred queue.</p>
<p>For LeafQueue (which has applications inside the queue), it uses queue&#x27;s own sorting policy to sort applications belong to the queue and allocate based on the sorted order.</p>
<p>(All sorting policies can be configured differently at each level.)</p>
<p><strong>Allocation by application</strong></p>
<p>When it goes to Application, see (<code>scheduler_application.go: func (sa *SchedulingApplication) tryAllocate</code>), It first sort the pending resource requests belong to the application (based on requests&#x27; priority). And based on the selected request, and configured node-sorting policy, it sorts nodes belong to the partition and try to allocate resources on the sorted nodes.</p>
<p>When application trying to allocate resources on nodes, it will invokes PredicatePlugin to make sure Shim can confirm the node is good. (For example K8shim runs predicates check for allocation pre-check).</p>
<p><strong>Allocation completed by scheduler</strong></p>
<p>Once allocation is done, scheduler will create an AllocationProposal and send to Cache to do further check, we will cover details in the upcoming section.</p>
<h2 class="anchor anchorWithStickyNavbar_NlAN" id="flow-of-events">Flow of events<a href="#flow-of-events" class="hash-link" aria-label="Direct link to Flow of events" title="Direct link to Flow of events">​</a></h2>
<p>Like mentioned before, all communications between components like RMProxy/Cache/Schedulers are done by using async event handler.</p>
<p>RMProxy/Cache/Scheduler include local event queues and event handlers. RMProxy and Scheduler have only one queue (For example: <code>pkg/scheduler/scheduler.go: handleSchedulerEvent</code>), and Cache has two queues (One for events from RMProxy, and one for events from Scheduler, which is designed for better performance).</p>
<p>We will talk about how events flowed between components:</p>
<p><strong>Events for ResourceManager registration and updates:</strong></p>
<div class="codeBlockContainer_l7z8 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_N19i"><pre tabindex="0" class="prism-code language-text codeBlock_adB6 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_fSw7"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Update from ResourceManager -&gt; RMProxy -&gt; RMUpdateRequestEvent Send to Cache</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">New ResourceManager registration -&gt; RMProxy -&gt; RegisterRMEvent Send to Cache</span><br></span></code></pre><div class="buttonGroup_ZiWg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Gl1a" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mJ2i"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_rLlY"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Cache Handles RM Updates</strong></p>
<p>There&#x27;re many fields inside RM Update event (<code>RMUpdateRequestEvent</code>), among them, we have following categories:</p>
<div class="codeBlockContainer_l7z8 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_N19i"><pre tabindex="0" class="prism-code language-text codeBlock_adB6 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_fSw7"><span class="token-line" style="color:#bfc7d5"><span class="token plain">1) Update for Application-related updates</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2) Update for New allocation ask and release. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">3) Node (Such as kubelet) update (New node, remove node, node resource change, etc.)</span><br></span></code></pre><div class="buttonGroup_ZiWg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Gl1a" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mJ2i"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_rLlY"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>More details can be found at:</p>
<div class="codeBlockContainer_l7z8 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_N19i"><pre tabindex="0" class="prism-code language-text codeBlock_adB6 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_fSw7"><span class="token-line" style="color:#bfc7d5"><span class="token plain">func (m *ClusterInfo) processRMUpdateEvent(event *cacheevent.RMUpdateRequestEvent)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">inside cluster_info.go</span><br></span></code></pre><div class="buttonGroup_ZiWg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Gl1a" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mJ2i"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_rLlY"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Cache send RM updates to Scheduler</strong></p>
<p>For most cases, Cache propagate updates from RM to scheduler directly (including Application, Node, Asks, etc.). And it is possible that some updates from RM is not valid (such as adding an application to a non-existed queue), for such cases, cache can send an event back to RMProxy and notify the ResourceManager. (See <code>RMApplicationUpdateEvent.RejectedApplications</code>)</p>
<p><strong>Cache handles scheduler config</strong></p>
<p>Cache also handles scheduler&#x27;s config changes, see</p>
<div class="language-go codeBlockContainer_l7z8 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_N19i"><pre tabindex="0" class="prism-code language-go codeBlock_adB6 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_fSw7"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">m </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">ClusterInfo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">processRMConfigUpdateEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">event </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">commonevents</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ConfigUpdateRMEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_ZiWg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Gl1a" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mJ2i"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_rLlY"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Similar to other RM updates, it propages news to scheduelr.</p>
<p><strong>Scheduler do allocation</strong></p>
<p>Once an AllocationProposal created by scheduler, scheduler sends <code>AllocationProposalBundleEvent</code> to Cache to commit.</p>
<p>Cache look at AllocationProposal under lock, and commit these proposals. The reason to do proposal/commit is Scheduler can run in multi-threads which could cause conflict for resource allocation. This approach is inspired by Borg/Omega/YARN Global Scheduling.</p>
<p>Cache checks more states such as queue resources, node resources (we cannot allocate more resource than nodes&#x27; available), etc. Once check is done, Cache updates internal data strcture and send confirmation to Scheduler to update the same, and scheduler sends allocated Allocation to RMProxy so Shim can do further options. For example, K8shim will <code>bind</code> an allocation (POD) to kubelet.</p>
<div class="codeBlockContainer_l7z8 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_N19i"><pre tabindex="0" class="prism-code language-text codeBlock_adB6 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_fSw7"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Job Add:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RM -&gt; Cache -&gt; Scheduler (Implemented)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Job Remove:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-----------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RM -&gt; Scheduler -&gt; Cache (Implemented)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Released allocations: (Same as normal release) (Implemented)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Note: Make sure remove from scheduler first to avoid new allocated created. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Scheduling Request Add:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-----------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RM -&gt; Cache -&gt; Scheduler (Implemented)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Note: Will check if requested job exists, queue exists, etc.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">When any request invalid:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   Cache -&gt; RM (Implemented)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   Scheduler -&gt; RM (Implemented)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Scheduling Request remove:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">------------------------- </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RM -&gt; Scheduler -&gt; Cache (Implemented)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Note: Make sure removed from scheduler first to avoid new container allocated</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Allocation remove (Preemption) </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-----------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Scheduler -&gt; Cache -&gt; RM (TODO)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              (confirmation)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Allocation remove (RM voluntarilly ask)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">---------------------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RM -&gt; Scheduler -&gt; Cache -&gt; RM. (Implemented)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                      (confirmation)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Node Add: </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">---------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RM -&gt; Cache -&gt; Scheduler (Implemented)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Note: Inside Cache, update allocated resources.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error handling: Reject Node to RM (Implemented)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Node Remove: </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Implemented in cache side</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RM -&gt; Scheduler -&gt; Cache (TODO)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Allocation Proposal:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Scheduler -&gt; Cache -&gt; RM</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">When rejected/accepted:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Cache -&gt; Scheduler</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Initial: (TODO)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1. Admin configured partitions</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2. Cache initializes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">3. Scheduler copies configurations</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Relations between Entities </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1. RM includes one or multiple:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   - Partitions </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   - Jobs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   - Nodes </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   - Queues</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2. One queue: </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   - Under one partition</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   - Under one RM.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">3. One job: </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   - Under one queue (Job with same name can under different partitions)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   - Under one partition</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RM registration: (TODO)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">----------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1. RM send registration</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2. If RM already registered, remove old one, including everything belong to RM.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RM termination (TODO) </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Just remove the old one.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Update of queues (TODO) </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Admin Service -&gt; Cache</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">About partition (TODO) </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-----------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Internal partition need to be normalized, for example, RM specify node with partition = xyz. </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Scheduler internally need to normalize it to &lt;rm-id&gt;_xyz</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">This need to be done by RMProxy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_ZiWg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Gl1a" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_mJ2i"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_rLlY"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/1.0.0/design/architecture"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Architecture</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/1.0.0/design/cache_removal"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Scheduler cache removal design</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_odww thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#components" class="table-of-contents__link toc-highlight">Components:</a><ul><li><a href="#scheduler-api-server-rmproxy" class="table-of-contents__link toc-highlight">Scheduler API Server (RMProxy)</a></li><li><a href="#scheduler-cache" class="table-of-contents__link toc-highlight">Scheduler Cache</a></li><li><a href="#scheduler-cache-event-handler" class="table-of-contents__link toc-highlight">Scheduler Cache Event Handler</a></li><li><a href="#admin-service" class="table-of-contents__link toc-highlight">Admin Service</a></li><li><a href="#scheduler-and-preemptor" class="table-of-contents__link toc-highlight">Scheduler and Preemptor</a></li></ul></li><li><a href="#schedulers-responsibility" class="table-of-contents__link toc-highlight">Scheduler&#39;s responsibility</a></li><li><a href="#preemption" class="table-of-contents__link toc-highlight">Preemption</a></li><li><a href="#communication-between-shim-and-core" class="table-of-contents__link toc-highlight">Communication between Shim and Core</a></li><li><a href="#configurations--semantics" class="table-of-contents__link toc-highlight">Configurations &amp; Semantics</a></li><li><a href="#how-scheduler-do-allocation" class="table-of-contents__link toc-highlight">How scheduler do allocation</a></li><li><a href="#flow-of-events" class="table-of-contents__link toc-highlight">Flow of events</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Blog</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://blog.cloudera.com/yunikorn-a-universal-resources-scheduler/" target="_blank" rel="noopener noreferrer" class="footer__link-item">What&#x27;s YuniKorn?<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://blog.cloudera.com/spark-on-kubernetes-gang-scheduling-with-yunikorn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Spark on Kubernetes – Gang Scheduling with YuniKorn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Code Repositories</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/apache/yunikorn-core/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Core scheduler<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/yunikorn-k8shim" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kubernetes shim<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/yunikorn-scheduler-interface" target="_blank" rel="noopener noreferrer" class="footer__link-item">Scheduler Interface<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/yunikorn-web" target="_blank" rel="noopener noreferrer" class="footer__link-item">WEB application<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/yunikorn-site" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/community/get_involved">Get Involved</a></li><li class="footer__item"><a class="footer__link-item" href="/community/people">People</a></li><li class="footer__item"><a href="https://issues.apache.org/jira/projects/YUNIKORN/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
<div style="font-size: 70%">
Copyright © 2020-2024 <a href="https://www.apache.org/">The Apache Software Foundation</a>. Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>. <br>
<div style="padding:20px; margin: 10px; color: #4d4d4d;">
<p>The Apache Software Foundation Apache YuniKorn, YuniKorn, Apache, the Apache feather, and the Apache YuniKorn project logo are either registered trademarks or trademarks of the Apache Software Foundation.</p>
</div>
</div></div></div></div></footer></div>
</body>
</html>