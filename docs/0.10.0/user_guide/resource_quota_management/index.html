<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.63">
<link rel="search" type="application/opensearchdescription+xml" title="Apache YuniKorn (Incubating)" href="/opensearch.xml"><title data-react-helmet="true">Resource Quota Management | Apache YuniKorn (Incubating)</title><meta data-react-helmet="true" name="docsearch:version" content="0.10.0"><meta data-react-helmet="true" property="og:image" content="http://yunikorn.apache.org/img/logo/yunikorn-logo-main.png"><meta data-react-helmet="true" property="twitter:image" content="http://yunikorn.apache.org/img/logo/yunikorn-logo-main.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Apache YuniKorn (Incubating)"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Resource Quota Management | Apache YuniKorn (Incubating)"><meta data-react-helmet="true" name="description" content="&lt;!--"><meta data-react-helmet="true" property="og:description" content="&lt;!--"><meta data-react-helmet="true" property="og:url" content="http://yunikorn.apache.org/docs/0.10.0/user_guide/resource_quota_management"><link data-react-helmet="true" rel="shortcut icon" href="/img/yunikorn.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="http://yunikorn.apache.org/docs/0.10.0/user_guide/resource_quota_management"><link rel="stylesheet" href="/styles.29c7a0ff.css">
<link rel="preload" href="/styles.c77a8483.js" as="script">
<link rel="preload" href="/runtime~main.39f93615.js" as="script">
<link rel="preload" href="/main.f18adfa3.js" as="script">
<link rel="preload" href="/1.715bd80a.js" as="script">
<link rel="preload" href="/2.7703bdb6.js" as="script">
<link rel="preload" href="/3.332ba8bb.js" as="script">
<link rel="preload" href="/1be78505.e0ec963d.js" as="script">
<link rel="preload" href="/189.af8bda1c.js" as="script">
<link rel="preload" href="/9ce8caa5.a06576eb.js" as="script">
<link rel="preload" href="/17896441.ef9e44c9.js" as="script">
<link rel="preload" href="/cbc12d17.3641592d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/yunikorn.ico" alt="YuniKorn Site Logo"><strong class="navbar__title">Apache YuniKorn</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Quick Start</a><a class="navbar__item navbar__link" href="/community/roadmap">Roadmap</a><a class="navbar__item navbar__link" href="/community/download">Download</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" position="left" href="/community/get_involved">Get Involved</a></li><li><a class="dropdown__link" position="left" href="/community/how_to_contribute">How to Contribute</a></li><li><a class="dropdown__link" position="left" href="/community/coding_guidelines">Coding Guidelines</a></li><li><a class="dropdown__link" position="left" href="/community/reporting_issues">Reporting Issues</a></li><li><a class="dropdown__link" position="left" href="/community/sessions">Sessions and Demos</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Apache</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">Apache Software Foundation</a></li><li><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">Apache Incubator</a></li><li><a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">Apache License</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">Sponsorship</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" position="left" href="/docs/next/">Master</a></li><li><a class="dropdown__link" position="left" href="/docs/">0.11.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" position="left" href="/docs/0.10.0/">0.10.0</a></li><li><a class="dropdown__link" position="left" href="/docs/0.9.0/">0.9.0</a></li><li><a class="dropdown__link" position="left" href="/docs/0.8.0/">0.8.0</a></li></ul></div><a href="https://github.com/apache/incubator-yunikorn-core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">âŒ˜</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/yunikorn.ico" alt="YuniKorn Site Logo"><strong class="navbar__title">Apache YuniKorn</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Quick Start</a></li><li class="menu__list-item"><a class="menu__link" href="/community/roadmap">Roadmap</a></li><li class="menu__list-item"><a class="menu__link" href="/community/download">Download</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist">Community</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" position="left" href="/community/get_involved">Get Involved</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/community/how_to_contribute">How to Contribute</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/community/coding_guidelines">Coding Guidelines</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/community/reporting_issues">Reporting Issues</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/community/sessions">Sessions and Demos</a></li></ul></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist">Apache</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">Apache Software Foundation</a></li><li class="menu__list-item"><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">Apache Incubator</a></li><li class="menu__list-item"><a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">Apache License</a></li><li class="menu__list-item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">Sponsorship</a></li></ul></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--sublist navbar__link--active" href="/docs">Docs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/next/">Master</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/">0.11.0</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" position="left" href="/docs/0.10.0/">0.10.0</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/0.9.0/">0.9.0</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/0.8.0/">0.8.0</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/apache/incubator-yunikorn-core" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Get Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/release-announce/0.10.0/">Release Notes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/">Get Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/get_started/core_features">Features</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">User Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.10.0/user_guide/queue_config">Partition and Queue Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.10.0/user_guide/placement_rules">App Placement Rules</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.10.0/user_guide/sorting_policies">Sorting Policies</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.10.0/user_guide/acls">ACLs</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/0.10.0/user_guide/resource_quota_management">Resource Quota Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.10.0/user_guide/gang_scheduling">Gang Scheduling</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Workloads</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/user_guide/workloads/run_spark">Run Spark Jobs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/user_guide/workloads/run_flink">Run Flink Jobs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/user_guide/workloads/run_tf">Run Tensorflow Jobs</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">REST APIs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/api/cluster">Cluster</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/api/scheduler">Scheduler</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/api/system">System</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.10.0/user_guide/trouble_shooting">Trouble Shooting</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Developer Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/developer_guide/env_setup">Dev Environment Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/developer_guide/build">Build and Run</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/developer_guide/deployment">Deploy to Kubernetes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/developer_guide/openshift_development">Development in CodeReady Containers</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Designs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/design/architecture">Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/design/scheduler_core_design">Scheduler Core Design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/design/cache_removal">Scheduler cache removal design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/design/k8shim">Kubernetes Shim Design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/design/cross_queue_preemption">Cross Queue Preemption</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/design/namespace_resource_quota">Namespace Resource Quota</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/design/pluggable_app_management">Pluggable App Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/design/resilience">Resilience</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/design/predicates">Support K8s Predicates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/design/scheduler_configuration">Scheduler Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/design/state_aware_scheduling">Batch Workloads Ordering with StateAware Policy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/design/scheduler_object_states">Scheduler Object States</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Performance</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/performance/evaluate_perf_function_with_kubemark">Evaluate YuniKorn function &amp; performance with Kubemark</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/performance/metrics">Scheduler Metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.10.0/performance/profiling">Profiling</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for Apache YuniKorn (Incubating) <strong>0.10.0</strong>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/docs/user_guide/resource_quota_management">latest version</a></strong> (0.11.0).</div></div><div class="docItemContainer_3QWW"><article><div><span class="badge badge--secondary">Version: 0.10.0</span></div><header><h1 class="docTitle_1Lrw">Resource Quota Management</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="quota-configuration-and-rules"></a>Quota configuration and rules<a aria-hidden="true" tabindex="-1" class="hash-link" href="#quota-configuration-and-rules" title="Direct link to heading">#</a></h2><p>YuniKorn can offer a finer grained resource quota management setup compared to the simple namespace resource quota provided by Kubernetes.</p><p>On Kubernetes a pod must fit into the namespace quota when the pod is submitted.
If the pod does not fit in the namespace quota the pod is rejected.
The client must implement a retry-mechanism and re-submit the pod if it needs the pod to be scheduled.</p><p>Contrary to quotas in Kubernetes YuniKorn does not enforce quotas on submission but only on actively consumed resources.
To explain the difference: when using YuniKorn for quota enforcement a new pod submitted to Kubernetes is always accepted.
Yunikorn will queue the pod without counting the queued pod&#x27;s resources towards the consumed quota.
When YuniKorn tries to schedule the pod it checks at scheduling time if the pod fits in the quota configured for the queue the pod is assigned to.
If at that point the pod does not fit in the quota the pod is skipped and not counted in the resource consumption.
This means that until a scheduling attempt of a pod is successful a pod it is not consuming resources in the YuniKorn quota system.</p><p>Resource quotas in YuniKorn are linked to the queue and its place in the queue hierarchy.
The base of the queue structure, the <code>root</code> queue, does not allow setting a quota as it reflects the current size of the cluster.
Node additions and removals update the <code>root</code> queue quota automatically.</p><p>Beside the <code>root</code> queue the quotas can be set, and is enforced, at any point in the hierarchy.
Every queue can have a quota set. The quota is enforced recursively throughout the hierarchy.
This means that a child queue can never use more resources than the <strong>configured</strong> quota of the parent queue.
Setting a quota on a child queue larger than its parent queue&#x27;s quota would thus not have any effect and is handled as a configuration error.</p><p>In the hierarchy there are some further rules that need to be considered.
If a parent queue has multiple children the sum of the <strong>usage</strong> of all children combined can never exceed the quota <strong>configured</strong> on the parent.
However, from a configuration perspective this does not mean that the sum of the <strong>configured</strong> quotas for all children must be smaller than the parent quota.</p><p><img alt="Queue Quota" src="/assets/images/queue-resource-quotas-02ec11ddedad1f2057bbc4d3ef1c900a.png"></p><p>As an example the <code>root.parent</code> queue has a quota of 900.
It contains three child queues, two with a quota set.
The <code>root.parent.child1</code> has no quota set and will thus be limited to the <code>root.parent</code> quota.
The two other queues <code>root.parent.child2</code> and <code>root.parent.child3</code> each have a quota of 750 set.
During normal operation the total usage of the 3 child queues together will be 900.
The applications running in each child queue have a demand of more than 1000 each.  </p><p>Distribution in that case could be any of:</p><ul><li>all 900 used by just the <code>child1</code> queue</li><li>spread out evenly over the 3 queues (300 by each)</li><li><code>child2</code> maxed out using 750, and the left over 150 used by <code>child3</code>  </li></ul><p>The exact distribution between the queues will fluctuate and is dependent on the scheduling policies.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="converting-kubernetes-resources-and-quotas"></a>Converting Kubernetes resources and quotas<a aria-hidden="true" tabindex="-1" class="hash-link" href="#converting-kubernetes-resources-and-quotas" title="Direct link to heading">#</a></h2><p>Resource support for pods is limited to the resources specified as part of the <em>requests</em> specification:</p><ul><li><em>cpu</em> is mapped to <em>vcore</em> with the value in milli cpu.</li><li><em>memory</em> is mapped to <em>memory</em> with the value in MB (1 MB = 10^6 B = 1 000 000 B).</li><li>all other resources are mapped as provided.</li></ul><p>Extended resource as per the <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/" target="_blank" rel="noopener noreferrer">Kubernetes documentation</a> are supported.</p><p>Example pod with a single container:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Pod</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> container</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;250m&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;1Gi&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">hugepages-1Gi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;1&quot;</span></div></div></div></div></div><p>The above specification will set pod resources request for scheduling in YuniKorn to:</p><ul><li><em>vcore</em> -&gt; 250</li><li><em>memory</em> -&gt; 1074</li><li><em>hugepages-1Gi</em> -&gt; 1</li></ul><p>Two remarks:<br>
Multiple container specifications will be aggregated into one total pod resource request automatically.<br>
All memory is reported in MB with unit conversions applied where needed. </p><p>In the case that static queue definitions are used for a queue there is no limit on the type of resource that can be specified in a quota.
Quota annotations on namespaces, used as part of the automatic queue creation, are limited to the equivalent <em>cpu</em> and <em>memory</em> resources.
See the <a href="#Namespace-quota">setup</a> below for the annotations on the namespace for quotas.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="kubernetes-and-yunikorn-quota-interaction"></a>Kubernetes and YuniKorn quota interaction<a aria-hidden="true" tabindex="-1" class="hash-link" href="#kubernetes-and-yunikorn-quota-interaction" title="Direct link to heading">#</a></h2><p>The recommendation is to turn off, not configure, the Kubernetes Namespace quotas.
Using only YuniKorn queue quotas provides a more flexible setup and allows queueing of workloads.  </p><p>In a setup that has both YuniKorn and Kubernetes quotas turned on consider the following points:</p><ul><li>Two separate configurations need to be maintained.
This increases the maintenance burden, and the possibility of configuration mistakes.</li><li>Both quotas will be enforced.</li></ul><p>Having both quotas turned on can lead to unexpected behaviour.
The main issue is the fact that the Kubernetes namespace quota is enforced on submit.
There are three combinations of quota configuration that are possible.
The 3 combinations could have two effects when used in combination with the YuniKorn quota.</p><ol><li>Both quotas are <em>equal</em>: workloads will not be queued, the full configured quota can be used.  <ul><li>Maximum usage and queueing will be limited to the set quota</li></ul></li><li>Kubernetes quota is <em>lower</em> than YuniKorn: the YuniKorn quota will never be reached and workloads will not be queued.   <ul><li>Maximum usage will be limited to the Kubernetes quota.</li></ul></li><li>Kubernetes quota is <em>higher</em> than YuniKorn: YuniKorn will limit the usage to the quota set in YuniKorn.
The Kubernetes quota will be enforced on submit and thus set the limit for the workload that can be queued on top of the YuniKorn quota.  <ul><li>Maximum usage will be limited to the YuniKorn quota.</li><li>Workload queueing will be limited to the Kubernetes quota.</li></ul></li></ol><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The following configuration examples are just to demonstrate the format needed
to create a queue hierarchy with quotas set.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="static-queue-definition"></a>Static queue definition<a aria-hidden="true" tabindex="-1" class="hash-link" href="#static-queue-definition" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="goal"></a>Goal<a aria-hidden="true" tabindex="-1" class="hash-link" href="#goal" title="Direct link to heading">#</a></h3><p>A preconfigured hierarchy of queues with a maximum and guaranteed capacity.
The users can only submit applications to the leaf queues.
This approach manages the resource capacity for each of the queues, which is suitable to the scenarios that queues do not change too often.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="configuration"></a>Configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuration" title="Direct link to heading">#</a></h3><p>Apply the following configuration to YuniKorn&#x27;s configmap to:</p><ul><li>setup 3 queues under <code>root</code></li><li>each queue has a specific guaranteed and maximum capacity</li><li>anyone can submit to any queue</li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">partitions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> default</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">queues</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> root</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">submitacl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">queues</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> advertisement</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token key atrule">guaranteed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">500000</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token key atrule">vcore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">50000</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token key atrule">max</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">800000</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token key atrule">vcore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">80000</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> search</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token key atrule">guaranteed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">400000</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token key atrule">vcore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">40000</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token key atrule">max</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">600000</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token key atrule">vcore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">60000</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> sandbox</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token key atrule">guaranteed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100000</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token key atrule">vcore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10000</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token key atrule">max</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100000</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token key atrule">vcore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10000</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="run-a-workload"></a>Run a workload<a aria-hidden="true" tabindex="-1" class="hash-link" href="#run-a-workload" title="Direct link to heading">#</a></h3><p>In order to run applications in specific queues, you will need to set the following labels in all pod specs.
All pods with the same <code>applicationID</code> label are considered ti be one application.
In the below example the application <code>my-test-app</code> will run in the queue <code>root.sandbox</code>: </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">app</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">applicationId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;my-test-app-01&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">queue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> root.sandbox</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="namespace-to-queue-mapping"></a>Namespace to queue mapping<a aria-hidden="true" tabindex="-1" class="hash-link" href="#namespace-to-queue-mapping" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="goal-1"></a>Goal<a aria-hidden="true" tabindex="-1" class="hash-link" href="#goal-1" title="Direct link to heading">#</a></h3><p>Automatically map a Kubernetes <code>namespace</code> to a queue in YuniKorn.
The user creates the required namespaces in Kubernetes.
The YuniKorn k8s shim and core scheduler automatically pass the required information and map the namespace to a queue, creating the queue if it does not exist.
The resource quota will be managed by YuniKorn instead of using the Kubernetes namespace quota.
This does require the namespaces to be setup without Kubernetes quota enforcement and tags as per the <a href="#Namespace-quota">setup</a> below.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="configuration-1"></a>Configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuration-1" title="Direct link to heading">#</a></h3><p>Apply the following configuration to YuniKorn&#x27;s configmap:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">partitions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> default</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">placementrules</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> tag</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> namespace</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">queues</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> root</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">submitacl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">properties</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">application.sort.policy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> stateaware</span></div></div></div></div></div><p>This configuration places an application based on the <code>tag</code> rule.
The tag selected is the <code>namespace</code> tag which is automatically added by the k8s shim to all applications that get created.
The <code>create</code> flag is set to true which will trigger the creation of the queue with the same name as the namespace if it does not exist. </p><p>Applications within the automatically created child queues will be sorted based sorting policy set on the parent queue.
In this case the property <code>application.sort.policy</code> is in this configuration set to <code>stateaware</code>.
This is a simple app sorting policy applicable for batch jobs, you can find more document <a href="/docs/0.10.0/user_guide/sorting_policies#StateAwarePolicy">here</a>.</p><p>You can change the configuration using the helm charts during the installation by overwriting the configuration in the
<a href="https://github.com/apache/incubator-yunikorn-release/blob/master/helm-charts/yunikorn/values.yaml#L71-L81" target="_blank" rel="noopener noreferrer">helm chart template</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="namespace-quota"></a>Namespace quota<a aria-hidden="true" tabindex="-1" class="hash-link" href="#namespace-quota" title="Direct link to heading">#</a></h3><p>Namespaces in Kubernetes contain the quota information.
If a quota is set on a namespace Kubernetes will automatically enforce the quota.
In the case that YuniKorn is used for quota enforcement no quota must be set on the namespace.</p><p>To allow specifying a quota on the namespace the following annotations should be set in the namespace object:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">yunikorn.apache.org/namespace.max.cpu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;64&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">yunikorn.apache.org/namespace.max.memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;100Gi&quot;</span></div></div></div></div></div><p>YuniKorn will parse these annotations and set the maximum capacity of the queue mapped to this namespace.
The values specified follow the standard Kubernetes formatting and unit specification.
Currently, we only support mapping memory and cpu not other resource types.</p><p>The example above will limit the queue mapped to the annotated namespace to 64 CPUs and 100GB memory.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="run-a-workload-1"></a>Run a workload<a aria-hidden="true" tabindex="-1" class="hash-link" href="#run-a-workload-1" title="Direct link to heading">#</a></h3><p>Applications, and the pods that are part of the application, can be submitted without specific labels.
YuniKorn will automatically add the required tags.
The configured placement rule will create the queue, if required, and add the application to the queue.</p><p>For example, if an application is submitted to namespace <code>development</code>, then the application will run in the <code>root.development</code> queue.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="parent-queue-mapping-for-namespaces"></a>Parent queue mapping for namespaces<a aria-hidden="true" tabindex="-1" class="hash-link" href="#parent-queue-mapping-for-namespaces" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="goal-2"></a>Goal<a aria-hidden="true" tabindex="-1" class="hash-link" href="#goal-2" title="Direct link to heading">#</a></h3><p>Though the tag placement rule using the <code>namespace</code> tag is capable of placing an application in a queue this might not be enough in all setups.
In some cases, multi tenancy for example, namespaces need to be grouped together.
Administrators could annotate namespaces which allows dynamic placement of applications based on multiple annotations if placement rules were setup.
YuniKorn cannot and does not just add all annotations from a namespace to an application.</p><p>To help support this grouping case a parent queue can be tagged on a namespace.   </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="configuration-2"></a>Configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuration-2" title="Direct link to heading">#</a></h3><p>The configuration for this functionality consists of two pieces:</p><ol><li>the mapping rule</li><li>the namespace annotation</li></ol><p>First we set the following configuration to YuniKorn&#x27;s configmap:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">partitions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> default</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">placementrules</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> tag</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> namespace</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">parent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> tag</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> namespace.parentqueue</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">queues</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> root</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">queues</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> production</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> development</span></div></div></div></div></div><p>The configuration used for the namespace to queue mapping is the same as <a href="#Namespace-to-queue-mapping">above</a>.
As an extension to the placement rule a <code>parent</code> rule is added to support the grouping.
The parent rule is used to generate the parent, or the queue above, in the hierarchy.
The rule uses the tag <code>namespace.parentqueue</code> from the application to generate the parent queue name.
The <code>namespace.parentqueue</code> tag is automatically added by the Kubernetes shim but does require a namespace annotation (see below).</p><p>In the example rule configuration given the <code>create</code> flag is not set on the parent rule.
This means that the parent queue must exist in the configuration otherwise the application submit will fail.
For the example configuration this means supported values for the parent are thus limited to <code>production</code> and <code>development</code>.</p><p>Quotas cannot be set on the parent queue using any of these mappings.
The quota linked to the namespace is set on the namespace queue not the parent  as per the namespace mapping provided earlier.</p><p>Parent queue quotas must always be set directly in the configuration.
This requires the <code>create</code> flag to be set to <code>false</code> on the parent rule.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="namespace-parent-queue"></a>Namespace parent queue<a aria-hidden="true" tabindex="-1" class="hash-link" href="#namespace-parent-queue" title="Direct link to heading">#</a></h3><p>Contrary to the namespace name itself, and inline with the quota settings, the namespaces need to be annotated to use the parent queue mapping.
Namespace names must be unique in Kubernetes which is not affected by this annotation.
The same annotation value may be used for multiple namespaces:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">yunikorn.apache.org/parentqueue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> root.production</span></div></div></div></div></div><p>The example annotation above will map the parent queue to the existing <code>root.production</code> queue.
Note that the rule will fully qualify the name if needed, you can thus omit the <code>root.</code> part in the annotation.
If the annotation starts with <code>root.</code> the system assumes it is a fully qualified queue name.</p><p>To complete the picture here is an image that shows the mapping from Kubernetes namespaces to queues in YuniKorn.
It uses the annotations on the namespaces in Kubernetes as described, and the example configuration for the mapping rules.
The <code>finance</code> and <code>sales</code> namespaces become queues grouped under the parent queue <code>production</code>.
The namespaces <code>dev</code> and <code>test</code> are placed under the <code>development</code> parent queue.   </p><p><img alt="Queue Quota" src="/assets/images/namespace-mapping-703b2384a21c2e401291fbb49acdb1f4.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="run-a-workload-2"></a>Run a workload<a aria-hidden="true" tabindex="-1" class="hash-link" href="#run-a-workload-2" title="Direct link to heading">#</a></h3><p>Applications, and the pods that are part of the application, can be submitted without specific labels or changes.
YuniKorn will add the tags, the placement rules will do the rest.
The configured placement rule will create the queues, if required, and add the application to the queue.</p><p>Since the namespace <code>finance</code> is annotated with the example value, and the rules are in place.
Applications in the <code>finance</code> namespace will run in the <code>root.production.finance</code> queue that is created dynamically.</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/0.10.0/user_guide/acls"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« ACLs</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/0.10.0/user_guide/gang_scheduling"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Gang Scheduling Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#quota-configuration-and-rules" class="table-of-contents__link">Quota configuration and rules</a></li><li><a href="#converting-kubernetes-resources-and-quotas" class="table-of-contents__link">Converting Kubernetes resources and quotas</a></li><li><a href="#kubernetes-and-yunikorn-quota-interaction" class="table-of-contents__link">Kubernetes and YuniKorn quota interaction</a></li><li><a href="#static-queue-definition" class="table-of-contents__link">Static queue definition</a><ul><li><a href="#goal" class="table-of-contents__link">Goal</a></li><li><a href="#configuration" class="table-of-contents__link">Configuration</a></li><li><a href="#run-a-workload" class="table-of-contents__link">Run a workload</a></li></ul></li><li><a href="#namespace-to-queue-mapping" class="table-of-contents__link">Namespace to queue mapping</a><ul><li><a href="#goal-1" class="table-of-contents__link">Goal</a></li><li><a href="#configuration-1" class="table-of-contents__link">Configuration</a></li><li><a href="#namespace-quota" class="table-of-contents__link">Namespace quota</a></li><li><a href="#run-a-workload-1" class="table-of-contents__link">Run a workload</a></li></ul></li><li><a href="#parent-queue-mapping-for-namespaces" class="table-of-contents__link">Parent queue mapping for namespaces</a><ul><li><a href="#goal-2" class="table-of-contents__link">Goal</a></li><li><a href="#configuration-2" class="table-of-contents__link">Configuration</a></li><li><a href="#namespace-parent-queue" class="table-of-contents__link">Namespace parent queue</a></li><li><a href="#run-a-workload-2" class="table-of-contents__link">Run a workload</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Blog</h4><ul class="footer__items"><li class="footer__item"><a href="https://blog.cloudera.com/yunikorn-a-universal-resources-scheduler/" target="_blank" rel="noopener noreferrer" class="footer__link-item">What&#x27;s YuniKorn?</a></li><li class="footer__item"><a href="https://blog.cloudera.com/apache-yunikorn-incubating-0-8-release-whats-new-and-upcoming/" target="_blank" rel="noopener noreferrer" class="footer__link-item">What&#x27;s new in YuniKorn 0.8.0?</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Github</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-core/" target="_blank" rel="noopener noreferrer" class="footer__link-item">scheduler-core</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-k8shim" target="_blank" rel="noopener noreferrer" class="footer__link-item">kubernetes-shim</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-scheduler-interface" target="_blank" rel="noopener noreferrer" class="footer__link-item">scheduler-interface</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-web" target="_blank" rel="noopener noreferrer" class="footer__link-item">scheduler-web</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/community/get_involved">Get Involved</a></li><li class="footer__item"><a href="http://people.apache.org/phonebook.html?podling=yunikorn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Roster</a></li><li class="footer__item"><a href="https://issues.apache.org/jira/projects/YUNIKORN/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issues</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1zJy"><img class="footer__logo" alt="Apache Incubator Logo" src="https://incubator.apache.org/images/incubator_feather_egg_logo.png"></a></div><div>
Copyright Â© 2021 <a href="http://www.apache.org/">The Apache Software Foundation</a>. Licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>. <br>
<div style="padding:20px; margin: 10px; color: #4d4d4d;">
  Apache YuniKorn is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the name of Apache TLP sponsor.
  Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications,
  and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily
  a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
</div>
</div></div></div></footer></div>
<script src="/styles.c77a8483.js"></script>
<script src="/runtime~main.39f93615.js"></script>
<script src="/main.f18adfa3.js"></script>
<script src="/1.715bd80a.js"></script>
<script src="/2.7703bdb6.js"></script>
<script src="/3.332ba8bb.js"></script>
<script src="/1be78505.e0ec963d.js"></script>
<script src="/189.af8bda1c.js"></script>
<script src="/9ce8caa5.a06576eb.js"></script>
<script src="/17896441.ef9e44c9.js"></script>
<script src="/cbc12d17.3641592d.js"></script>
</body>
</html>