<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-performance/evaluate_perf_function_with_kubemark" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">Evaluate YuniKorn Performance with Kubemark | Apache YuniKorn</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://yunikorn.apache.org/img/logo/yunikorn-logo-main.png"><meta data-rh="true" name="twitter:image" content="https://yunikorn.apache.org/img/logo/yunikorn-logo-main.png"><meta data-rh="true" property="og:url" content="https://yunikorn.apache.org/docs/next/performance/evaluate_perf_function_with_kubemark"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Evaluate YuniKorn Performance with Kubemark | Apache YuniKorn"><meta data-rh="true" name="description" content="&lt;!--"><meta data-rh="true" property="og:description" content="&lt;!--"><meta data-rh="true" name="keywords" content="performance,throughput"><link data-rh="true" rel="icon" href="/img/yunikorn.ico"><link data-rh="true" rel="canonical" href="https://yunikorn.apache.org/docs/next/performance/evaluate_perf_function_with_kubemark"><link data-rh="true" rel="alternate" href="https://yunikorn.apache.org/docs/next/performance/evaluate_perf_function_with_kubemark" hreflang="en"><link data-rh="true" rel="alternate" href="https://yunikorn.apache.org/docs/next/performance/evaluate_perf_function_with_kubemark" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://Q1V951BG2V-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Apache YuniKorn" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.57f4caef.css">
<script src="/assets/js/runtime~main.dd672f16.js" defer="defer"></script>
<script src="/assets/js/main.1ba8fec7.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fIH8" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar__FTF" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarPlaceholder_wDNR"></div><div class="content_DgxC announcementBarContent_HmXy">1.5.1 has been released, check the <a href="/community/download">DOWNLOADS</a>.</div><button type="button" aria-label="Close" class="clean-btn close closeButton_KmNL announcementBarClose_BG67"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo/yunikorn_blue_logo.png" alt="YuniKorn Site Logo" class="themedComponent_yzub themedComponent--light_pOwb"><img src="/img/logo/yunikorn_white_logo.png" alt="YuniKorn Site Logo" class="themedComponent_yzub themedComponent--dark_xdnF"></div><b class="navbar__title text--truncate">Apache YuniKorn</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/community/roadmap">Roadmap</a><a class="navbar__item navbar__link" href="/community/download">Download</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community/get_involved">Get Involved</a></li><li><a class="dropdown__link" href="/community/how_to_contribute">How to Contribute</a></li><li><a class="dropdown__link" href="/community/coding_guidelines">Coding Guidelines</a></li><li><a class="dropdown__link" href="/community/reporting_issues">Reporting Issues</a></li><li><a class="dropdown__link" href="/community/release_procedure">Release Procedure</a></li><li><a class="dropdown__link" href="/community/events">Events</a></li><li><a class="dropdown__link" href="/community/people">People</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Apache</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Apache Software Foundation<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsors<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy Policy<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/next/">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/next/performance/evaluate_perf_function_with_kubemark">Next</a></li><li><a class="dropdown__link" href="/docs/performance/evaluate_perf_function_with_kubemark">1.5.1</a></li><li><a class="dropdown__link" href="/docs/1.5.0/performance/evaluate_perf_function_with_kubemark">1.5.0</a></li><li><a class="dropdown__link" href="/docs/1.4.0/performance/evaluate_perf_function_with_kubemark">1.4.0</a></li><li><a class="dropdown__link" href="/docs/1.3.0/performance/evaluate_perf_function_with_kubemark">1.3.0</a></li><li><a class="dropdown__link" href="/docs/1.2.0/performance/evaluate_perf_function_with_kubemark">1.2.0</a></li><li><a class="dropdown__link" href="/docs/1.1.0/performance/evaluate_perf_function_with_kubemark">1.1.0</a></li><li><a class="dropdown__link" href="/docs/1.0.0/performance/evaluate_perf_function_with_kubemark">1.0.0</a></li><li><a class="dropdown__link" href="/docs/0.12.2/performance/evaluate_perf_function_with_kubemark">0.12.2</a></li><li><a class="dropdown__link" href="/docs/0.12.1/performance/evaluate_perf_function_with_kubemark">0.12.1</a></li><li><a class="dropdown__link" href="/docs/0.11.0/performance/evaluate_perf_function_with_kubemark">0.11.0</a></li><li><a class="dropdown__link" href="/docs/0.10.0/performance/evaluate_perf_function_with_kubemark">0.10.0</a></li><li><a class="dropdown__link" href="/docs/0.9.0/performance/evaluate_perf_function_with_kubemark">0.9.0</a></li><li><a class="dropdown__link" href="/docs/0.8.0/performance/evaluate_perf_function_with_kubemark">0.8.0</a></li></ul></div><a href="https://github.com/apache/yunikorn-core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_CXxL colorModeToggle_r3Ku"><button class="clean-btn toggleButton_A2Gq toggleButtonDisabled_MBgh" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_ZNXA"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon__KEK"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_eonw"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_txSM"><div class="docsWrapper_aujV"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_fDTy" type="button"></button><div class="docRoot_ITF8"><aside class="theme-doc-sidebar-container docSidebarContainer_coE9"><div class="sidebarViewport_XDus"><div class="sidebar_duME"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_d40_ menuWithAnnouncementBar_QXd6"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/next/">Get Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/next/user_guide/deployment_modes">User Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/next/developer_guide/env_setup">Developer Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/next/performance/evaluate_perf_function_with_kubemark">Performance</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/next/performance/evaluate_perf_function_with_kubemark">Evaluate YuniKorn Performance with Kubemark</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/performance/evaluate_perf_function_with_kwok">Evaluate YuniKorn Performance with KWOK</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/performance/performance_tutorial">Benchmarking Tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/performance/metrics">Scheduler Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/performance/profiling">Profiling</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_fQ9A"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_L8rf"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Apache YuniKorn<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/performance/evaluate_perf_function_with_kubemark">latest version</a></b> (<!-- -->1.5.1<!-- -->).</div></div><div class="docItemContainer_J6oa"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer__4Nk" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_lw5W"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Performance</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Evaluate YuniKorn Performance with Kubemark</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_hejs theme-doc-toc-mobile tocMobile_K3aG"><button type="button" class="clean-btn tocCollapsibleButton_a3TS">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Evaluate YuniKorn Performance with Kubemark</h1></header><p>The YuniKorn community concerns about the scheduler’s performance and continues to optimize it over the releases. The community has developed some tools in order to test and tune the performance repeatedly.</p>
<h2 class="anchor anchorWithStickyNavbar_NlAN" id="environment-setup">Environment setup<a href="#environment-setup" class="hash-link" aria-label="Direct link to Environment setup" title="Direct link to Environment setup">​</a></h2>
<p>We leverage <a href="https://github.com/kubernetes/kubernetes/blob/release-1.3/docs/devel/kubemark-guide.md#starting-a-kubemark-cluster" target="_blank" rel="noopener noreferrer">Kubemark</a> to evaluate scheduler’s performance. Kubemark is a testing tool that simulates large scale clusters. It create hollow nodes which runs hollow kubelet to pretend original kubelet behavior. Scheduled pods on these hollow nodes won’t actually execute. It is able to create a big cluster that meets our experiment requirement that reveals the yunikorn scheduler performance. Please see the <a href="/docs/next/performance/performance_tutorial">detail steps</a> about how to setup the environment.</p>
<h2 class="anchor anchorWithStickyNavbar_NlAN" id="scheduler-throughput">Scheduler Throughput<a href="#scheduler-throughput" class="hash-link" aria-label="Direct link to Scheduler Throughput" title="Direct link to Scheduler Throughput">​</a></h2>
<p>We have designed some simple benchmarking scenarios on a simulated large scale environment in order to evaluate the scheduler performance. Our tools measure the <a href="https://en.wikipedia.org/wiki/Throughput" target="_blank" rel="noopener noreferrer">throughput</a> and use these key metrics to evaluate the performance. In a nutshull, scheduler throughput is the rate of processing pods from discovering them on the cluster to allocating them to nodes.</p>
<p>In this experiment, we setup a simulated 2000/4000 nodes cluster with <a href="https://github.com/kubernetes/kubernetes/blob/release-1.3/docs/devel/kubemark-guide.md#starting-a-kubemark-cluster" target="_blank" rel="noopener noreferrer">Kubemark</a>. Then we launch 10 <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener noreferrer">deployments</a>, with setting replicas to 5000 in each deployment respectively. This simulates large scale workloads submitting to the K8s cluster simultaneously. Our tool periodically monitors and checks pods status, counting the number of started pods based on <code>podSpec.StartTime</code> as time elapses. As a comparison, we apply the same experiment to the default scheduler in the same environment. And we see the YuniKorn performance advantage over the default scheduler as illustrated below:</p>
<p><img decoding="async" loading="lazy" alt="Scheduler Throughput" src="/assets/images/yunirkonVSdefault-933832efd32ef583c6415a07c0d9b50b.png" width="1920" height="1080" class="img_qdMO">
</p><p align="center">Fig 1. Yunikorn and default scheduler throughput </p><p></p>
<p>The charts record the time spent until all pods are running on the cluster:</p>
<table><thead><tr><th>Number of Nodes</th><th style="text-align:center">yunikorn</th><th style="text-align:center">k8s default scheduler</th><th style="text-align:center">Diff</th></tr></thead><tbody><tr><td>2000(nodes)</td><td style="text-align:center">204(pods/sec)</td><td style="text-align:center">49(pods/sec)</td><td style="text-align:center">416%</td></tr><tr><td>4000(nodes)</td><td style="text-align:center">115(pods/sec)</td><td style="text-align:center">48(pods/sec)</td><td style="text-align:center">240%</td></tr></tbody></table>
<p>In order to normalize the result, we have been running the tests for several rounds. As shown above, YuniKorn achieves a <code>2x</code> ~ <code>4x</code> performance gain comparing to the default scheduler.</p>
<div class="theme-admonition theme-admonition-note admonition_pqkm alert alert--secondary"><div class="admonitionHeading_r0oI"><span class="admonitionIcon_Oz24"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_usWX"><p>Like other performance testing, the result is highly variable depending on the underlying hardware, e.g server CPU/memory, network bandwidth, I/O speed, etc. To get an accurate result that applies to your environment, we encourage you to run these tests on a cluster that is close to your production environment.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_NlAN" id="performance-analysis">Performance Analysis<a href="#performance-analysis" class="hash-link" aria-label="Direct link to Performance Analysis" title="Direct link to Performance Analysis">​</a></h2>
<p>The results we got from the experiment are promising. We further take a deep dive to analyze the performance by observing more internal YuniKorn metrics, and we are able to locate a few key areas affecting the performance.</p>
<h3 class="anchor anchorWithStickyNavbar_NlAN" id="k8s-limitation">K8s Limitation<a href="#k8s-limitation" class="hash-link" aria-label="Direct link to K8s Limitation" title="Direct link to K8s Limitation">​</a></h3>
<p>We found the overall performance actually is capped by the K8s master services, such as api-server, controller-manager and etcd, it did not reached the limit of YuniKorn in all our experiments. If you look at the internal scheduling metrics, you can see:</p>
<p><img decoding="async" loading="lazy" alt="Allocation latency" src="/assets/images/allocation_4k-55774ca09e13367c41799e4172d34a87.png" width="1697" height="703" class="img_qdMO">
</p><p align="center">Fig 2. Yunikorn metric in 4k nodes </p><p></p>
<p>Figure 2 is a screenshot from Prometheus, which records the <a href="/docs/next/performance/metrics">internal metrics</a> <code>containerAllocation</code> in YuniKorn. They are the number of pods being allocated by the scheduler, but have not necessarily been bound to nodes. It consumes roughly 122 seconds to finish scheduling 50k pods, i.e 410 pod/sec. The actual throughput drops to 115 pods/sec, and the extra time was used to bind the pods on different nodes. If K8s side could catch up, we will see a better result. Actually, when we tune the performance on a large scale cluster, the first thing we do is to tune up some parameters in API-server, controller manager in order to increase the throughput. See more in the <a href="/docs/next/performance/performance_tutorial">performance tutorial doc</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_NlAN" id="node-sorting">Node Sorting<a href="#node-sorting" class="hash-link" aria-label="Direct link to Node Sorting" title="Direct link to Node Sorting">​</a></h3>
<p>When the cluster size grows, we see an obvious performance drop in YuniKorn. This is because in YuniKorn, we do a full sorting of the cluster nodes in order to find the <strong>&quot;best-fit&quot;</strong> node for a given pod. Such strategy makes the pods distribution more optimal based on the <a href="/docs/next/user_guide/sorting_policies#node-sorting">node sorting policy</a> being used. However, sorting nodes is expensive, doing this in the scheduling cycle creates a lot of overhead. To overcome this, we have improved our node sorting mechanism in <a href="https://issues.apache.org/jira/browse/YUNIKORN-807" target="_blank" rel="noopener noreferrer">YUNIKORN-807</a>, the idea behind of this is to use a <a href="https://en.wikipedia.org/wiki/B-tree" target="_blank" rel="noopener noreferrer">B-Tree</a> to store all nodes and applies an incremental updates when necessary. This significantly improves the latency, according to our benchmark testing, this improves 35x, 42x, 51x, 74x respectively on 500, 1000, 2000 and 5000 nodes clusters.</p>
<h3 class="anchor anchorWithStickyNavbar_NlAN" id="per-node-precondition-checks">Per Node Precondition Checks<a href="#per-node-precondition-checks" class="hash-link" aria-label="Direct link to Per Node Precondition Checks" title="Direct link to Per Node Precondition Checks">​</a></h3>
<p>In each scheduling cycle, another time consuming part is the &quot;Precondition Checks&quot; for a node. In this phase, YuniKorn evaluates all K8s standard predicates, e.g node-selector, pod affinity/anti-affinity, etc, in order to qualify a pod is fit onto a node. These evaluations are expensive.</p>
<p>We have done two experiments to compare the case where the predicates evaluation was enabled with being disabled. See the results below:</p>
<p><img decoding="async" loading="lazy" alt="Allocation latency" src="/assets/images/predicateComaparation-301262c33323e9faad72a1143ccc1617.png" width="1920" height="1080" class="img_qdMO">
</p><p align="center">Fig 3. Predicate effect comparison in yunikorn </p><p></p>
<p>When the predicates evaluation is disabled, the throughput improves a lot. We looked further into the latency distribution of the entire scheduling cycle and the predicates-eval latency. And found:</p>
<p><img decoding="async" loading="lazy" alt="YK predicate latency" src="/assets/images/predicate_4k-3ad50742ac5f0356e7707e6a01cbba0f.png" width="1854" height="817" class="img_qdMO">
</p><p align="center">Fig 4. predicate latency </p><p></p>
<p><img decoding="async" loading="lazy" alt="YK scheduling with predicate" src="/assets/images/scheduling_with_predicate_4k_-951a3d6c4f1614330bb567cb5a797d24.png" width="1855" height="808" class="img_qdMO">
</p><p align="center">Fig 5. Scheduling time with predicate active </p><p></p>
<p><img decoding="async" loading="lazy" alt="YK scheduling with no predicate" src="/assets/images/scheduling_no_predicate_4k-bfbb358a7c3c555ecdfbd218eefa1257.png" width="1841" height="797" class="img_qdMO">
</p><p align="center">Fig 6. Scheduling time with predicate inactive </p><p></p>
<p>Overall, YuniKorn scheduling cycle runs really fast, and the latency drops in <strong>0.001s - 0.01s</strong> range per cycle. And the majority of the time was used for predicates evaluation, 10x to other parts in the scheduling cycle.</p>
<table><thead><tr><th></th><th style="text-align:center">scheduling latency distribution(second)</th><th style="text-align:center">predicates-eval latency distribution(second)</th></tr></thead><tbody><tr><td>predicates enabled</td><td style="text-align:center">0.01 - 0.1</td><td style="text-align:center">0.01-0.1</td></tr><tr><td>predicates disabled</td><td style="text-align:center">0.001 - 0.01</td><td style="text-align:center">none</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_NlAN" id="why-yunikorn-is-faster">Why YuniKorn is faster?<a href="#why-yunikorn-is-faster" class="hash-link" aria-label="Direct link to Why YuniKorn is faster?" title="Direct link to Why YuniKorn is faster?">​</a></h2>
<p>The default scheduler was created as a service-oriented scheduler; it is less sensitive in terms of throughput compared to YuniKorn. YuniKorn community works really hard to keep the performance outstanding in the line and keep improving it. The reasons that YuniKorn can run faster than the default scheduler are:</p>
<ul>
<li>Short Circuit Scheduling Cycle</li>
</ul>
<p>YuniKorn keeps the scheduling cycle short and efficient. YuniKorn uses all async communication protocol to make sure all the critical paths are non-blocking calls. Most of the places are just doing in-memory calculation which can be highly efficient. The default scheduler leverages <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/scheduling-framework/" target="_blank" rel="noopener noreferrer">scheduling framework</a>, it provides lots of flexibility to extend the scheduler, however, the trade-off is the performance. The scheduling cycle becomes to be a really long chain because it needs to visit all these plugins.</p>
<ul>
<li>Async Events Handling</li>
</ul>
<p>YuniKorn leverages an async event handling framework to deal with internal states. And this allows the core scheduling cycle can run fast without being blocked by any expensive calls. An example is the default scheduler needs to write state updates, events to pod objects, that is done inside of the scheduling cycle. This involves persisting data to etcd which could be slow. YuniKorn, instead, caches all such events in a queue and writes back to the pod in asynchronous manner.</p>
<ul>
<li>Faster Node Sorting</li>
</ul>
<p>After <a href="https://issues.apache.org/jira/browse/YUNIKORN-807" target="_blank" rel="noopener noreferrer">YUNIKORN-807</a>, YuniKorn does the incremental node sorting which is highly efficient. This is built on top of the so-called &quot;resource-weight&quot; based node scoring mechanism, and it is also extensible via plugins. All these together reduce the overhead while computing node scores. In comparison, the default scheduler provides a few extension points for calculating node scores, such as <code>PreScore</code>, <code>Score</code> and <code>NormalizeScore</code>. These computations are heavy and they are called in every scheduling cycle. See details in <a href="https://github.com/kubernetes/kubernetes/blob/481459d12dc82ab88e413886e2130c2a5e4a8ec4/pkg/scheduler/framework/runtime/framework.go#L857" target="_blank" rel="noopener noreferrer">code lines</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_NlAN" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2>
<p>During the tests, we found YuniKorn is performing really well, especially compared to the default scheduler. We have identified the major factors in YuniKorn where we can continue to improve the performance, and also explained why YuniKorn is performing better than the default scheduler. We also realized the limitations while scaling Kubernetes to thousands of nodes, that can be alleviated by using other techiques such as, e.g federation. At a result, YuniKorn is a high-efficient, high-throughput scheduler that perfectly positioned for running batch/mixed workloads on Kubernetes.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/next/archived_design/pluggable_app_management"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Pluggable App Management</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/next/performance/evaluate_perf_function_with_kwok"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Evaluate YuniKorn Performance with KWOK</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_odww thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#environment-setup" class="table-of-contents__link toc-highlight">Environment setup</a></li><li><a href="#scheduler-throughput" class="table-of-contents__link toc-highlight">Scheduler Throughput</a></li><li><a href="#performance-analysis" class="table-of-contents__link toc-highlight">Performance Analysis</a><ul><li><a href="#k8s-limitation" class="table-of-contents__link toc-highlight">K8s Limitation</a></li><li><a href="#node-sorting" class="table-of-contents__link toc-highlight">Node Sorting</a></li><li><a href="#per-node-precondition-checks" class="table-of-contents__link toc-highlight">Per Node Precondition Checks</a></li></ul></li><li><a href="#why-yunikorn-is-faster" class="table-of-contents__link toc-highlight">Why YuniKorn is faster?</a></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Blog</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://blog.cloudera.com/yunikorn-a-universal-resources-scheduler/" target="_blank" rel="noopener noreferrer" class="footer__link-item">What&#x27;s YuniKorn?<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://blog.cloudera.com/spark-on-kubernetes-gang-scheduling-with-yunikorn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Spark on Kubernetes – Gang Scheduling with YuniKorn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Code Repositories</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/apache/yunikorn-core/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Core scheduler<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/yunikorn-k8shim" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kubernetes shim<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/yunikorn-scheduler-interface" target="_blank" rel="noopener noreferrer" class="footer__link-item">Scheduler Interface<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/yunikorn-web" target="_blank" rel="noopener noreferrer" class="footer__link-item">WEB application<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/yunikorn-site" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/community/get_involved">Get Involved</a></li><li class="footer__item"><a class="footer__link-item" href="/community/people">People</a></li><li class="footer__item"><a href="https://issues.apache.org/jira/projects/YUNIKORN/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_n0Rw"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">
<div style="font-size: 70%">
Copyright © 2020-2024 <a href="https://www.apache.org/">The Apache Software Foundation</a>. Licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>. <br>
<div style="padding:20px; margin: 10px; color: #4d4d4d;">
<p>The Apache Software Foundation Apache YuniKorn, YuniKorn, Apache, the Apache feather, and the Apache YuniKorn project logo are either registered trademarks or trademarks of the Apache Software Foundation.</p>
</div>
</div></div></div></div></footer></div>
</body>
</html>