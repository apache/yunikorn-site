"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[51308],{42577:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>a});var o=i(13274),r=i(1780);const t={id:"design",title:"Design"},s="Design of YuniKorn scheduler",l={id:"design/design",title:"Design",description:"\x3c!--",source:"@site/versioned_docs/version-0.8.0/design/design.md",sourceDirName:"design",slug:"/design/",permalink:"/docs/0.8.0/design/",draft:!1,unlisted:!1,tags:[],version:"0.8.0",frontMatter:{id:"design",title:"Design"},sidebar:"docs",previous:{title:"Profiling",permalink:"/docs/0.8.0/performance/profiling"},next:{title:"Cross Queue Preemption",permalink:"/docs/0.8.0/design/cross_queue_preemption"}},c={},a=[{value:"Overall",id:"overall",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Components:",id:"components",level:3},{value:"Implementation",id:"implementation",level:2},{value:"Configurations &amp; Semantics",id:"configurations--semantics",level:2},{value:"Flow of events",id:"flow-of-events",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"design-of-yunikorn-scheduler",children:"Design of YuniKorn scheduler"}),"\n",(0,o.jsx)(n.h2,{id:"overall",children:"Overall"}),"\n",(0,o.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,o.jsx)(n.h3,{id:"components",children:"Components:"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Scheduler API Server"}),":"]}),"\n",(0,o.jsx)(n.p,{children:"Responsible for communication between RM and Scheduler, which implements scheduler-interface GRPC protocol, or just APIs. (For intra-process communication w/o Serde)."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Scheduler Cache"}),":"]}),"\n",(0,o.jsx)(n.p,{children:"Caches all data related to scheduler state, such as used resources of each queues, nodes, allocations. Relationship between allocations and nodes, etc.\nShould not include temporary data helps with scheduler. For example to-be-preempted allocation candidates. Fair share resource of queues, etc."}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Scheduler Cache Event Handler"}),":"]}),"\n",(0,o.jsx)(n.p,{children:"Handles all events which needs to update scheduler internal state. So all the write operations will be carefully handled."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Admin Service"})}),"\n",(0,o.jsx)(n.p,{children:"Handles request from Admin, which can also load configurations from storage and update scheduler policies."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Scheduler and Preemptor"})}),"\n",(0,o.jsx)(n.p,{children:"Handles Scheduler's internal state. (Which is not belong to scheduelr cache), such as internal reservations, etc. Scheduler and preemptor will work together, make scheduling or preemption decisions."}),"\n",(0,o.jsx)(n.p,{children:"All allocate/preempt request will be handled by event handler."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"                      GRPC Protocol\n+---------------------------------------------------------------------------+\n                     +--------------------+\n                     |Scheduler API Server|\n +-------------+     +---------+----------+\n |AdminService |               |\n +-------------+               |Write Ops                    +----------------+\n +-------------+               V                            ++Scheduler       |\n |Configurator |      +-------------------+  Allocate       ||   And          |\n +-------------+      |Cache Event Handler+<-----------------|                |\n         +----------\x3e +-------------------+  Preempt        ++Preemptor       |\n          Update Cfg   Handled by policies                   +----------------+\n                               +  (Stateless)\n                        +------v--------+\n                        |Scheduler Cache|\n                        +---------------+\n                +---------------------------------------------+\n                |--------+ +------+ +----------+ +----------+ |\n                ||Node   | |Queue | |Allocation| |Requests  | |\n                |--------+ +------+ +----------+ +----------+ |\n                +---------------------------------------------+\n\n"})}),"\n",(0,o.jsx)(n.h2,{id:"implementation",children:"Implementation"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Scheduler needs to do following responsibilities"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"According to resource usages between queues, sort queues, applications, and figure out order of application allocation. (This will be used by preemption as well)."}),"\n",(0,o.jsx)(n.li,{children:"It is possible that we cannot satisfy some of the allocation request, we need to skip them and find next request."}),"\n",(0,o.jsx)(n.li,{children:"It is possible that some allocation request cannot be satisfied because of resource fragmentation. We need to reserve room for such requests."}),"\n",(0,o.jsx)(n.li,{children:"Different nodes may belong to different disjoint partitions, we can make independent scheduler runs"}),"\n",(0,o.jsx)(n.li,{children:"Locality is still important for many scenarios, especially for on-prem cases."}),"\n",(0,o.jsx)(n.li,{children:"Be able to config and change ordering policies for apps, queues."}),"\n",(0,o.jsx)(n.li,{children:"Application can choose their own way to manage sort of nodes."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Preemption:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:'It is important to know "who wanna the resource", so we can do preemption based on allocation orders.'}),"\n",(0,o.jsx)(n.li,{children:"When do preemption, it is also efficient to trigger allocation op. Think about how to do it."}),"\n",(0,o.jsx)(n.li,{children:"Preemption needs to take care about queue resource balancing."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"configurations--semantics",children:"Configurations & Semantics"}),"\n",(0,o.jsx)(n.p,{children:"Example of configuration:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Partition is name space."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Same queues can under different partitions, but enforced to have same hierarchy."}),"\n",(0,o.jsx)(n.p,{children:"Good:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:" partition=x    partition=y\n     a           a\n   /   \\        / \\\n  b     c      b   c\n"})}),"\n",(0,o.jsx)(n.p,{children:'Good (c in partition y acl=""):'}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:" partition=x    partition=y\n     a           a\n   /   \\        /\n  b     c      b\n"})}),"\n",(0,o.jsx)(n.p,{children:"Bad (c in different hierarchy)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:" partition=x    partition=y\n     a           a\n   /   \\        /  \\\n  b     c      b    d\n              /\n             c\n"})}),"\n",(0,o.jsx)(n.p,{children:"Bad (Duplicated c)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:" partition=x\n     a\n   /   \\\n  b     c\n /\nc\n\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Different hierarchies can be added"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-scheduler-conf.yaml",children:"partitions:\n  - name:  default\n    queues:\n        root:\n          configs:\n            acls:\n          childrens:\n            - a\n            - b\n            - c\n            - ...\n        a:\n          configs:\n            acls:\n            capacity: (capacity is not allowed to set for root)\n            max-capacity: ...\n      mapping-policies:\n        ...\n  - name: partition_a:\n    queues:\n        root:...\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"flow-of-events",children:"Flow of events"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Job Add:\n--------\nRM -> Cache -> Scheduler (Implemented)\n\nJob Remove:\n-----------\nRM -> Scheduler -> Cache (Implemented)\nReleased allocations: (Same as normal release) (Implemented)\nNote: Make sure remove from scheduler first to avoid new allocated created. \n\nScheduling Request Add:\n-----------------------\nRM -> Cache -> Scheduler (Implemented)\nNote: Will check if requested job exists, queue exists, etc.\nWhen any request invalid:\n   Cache -> RM (Implemented)\n   Scheduler -> RM (Implemented)\n\nScheduling Request remove:\n------------------------- \nRM -> Scheduler -> Cache (Implemented)\nNote: Make sure removed from scheduler first to avoid new container allocated\n\nAllocation remove (Preemption) \n-----------------\nScheduler -> Cache -> RM (TODO)\n              (confirmation)\n\nAllocation remove (RM voluntarilly ask)\n---------------------------------------\nRM -> Scheduler -> Cache -> RM. (Implemented)\n                      (confirmation)\n\nNode Add: \n---------\nRM -> Cache -> Scheduler (Implemented)\nNote: Inside Cache, update allocated resources.\nError handling: Reject Node to RM (Implemented)\n\nNode Remove: \n------------\nImplemented in cache side\nRM -> Scheduler -> Cache (TODO)\n\nAllocation Proposal:\n--------------------\nScheduler -> Cache -> RM\nWhen rejected/accepted:\n    Cache -> Scheduler\n    \nInitial: (TODO)\n--------\n1. Admin configured partitions\n2. Cache initializes\n3. Scheduler copies configurations\n\nRelations between Entities \n-------------------------\n1. RM includes one or multiple:\n   - Partitions \n   - Jobs\n   - Nodes \n   - Queues\n   \n2. One queue: \n   - Under one partition\n   - Under one RM.\n   \n3. One job: \n   - Under one queue (Job with same name can under different partitions)\n   - Under one partition\n\nRM registration: (TODO)\n----------------\n1. RM send registration\n2. If RM already registered, remove old one, including everything belong to RM.\n\nRM termination (TODO) \n--------------\nJust remove the old one.\n\nUpdate of queues (TODO) \n------------------------\nAdmin Service -> Cache\n\nAbout partition (TODO) \n-----------------------\nInternal partition need to be normalized, for example, RM specify node with partition = xyz. \nScheduler internally need to normalize it to <rm-id>_xyz\nThis need to be done by RMProxy\n\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},1780:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>l});var o=i(79474);const r={},t=o.createContext(r);function s(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);