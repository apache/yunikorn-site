"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[49257],{16628:(e,n,r)=>{r.d(n,{Ay:()=>i,RM:()=>s});var t=r(13274),a=r(37155);const s=[{value:"Configure your Ray CRD(optional)",id:"configure-your-ray-crdoptional",level:3}];function o(e){const n={a:"a",code:"code",h3:"h3",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h3,{id:"configure-your-ray-crdoptional",children:"Configure your Ray CRD(optional)"}),"\n",(0,t.jsxs)(n.p,{children:["If you disable admission controller, you need to add the schedulerName: yunikorn in ",(0,t.jsx)(n.a,{href:"https://github.com/ray-project/kuberay/blob/fd9c90cad28a1460d4472abbb2b5db43a5e4a813/helm-chart/ray-cluster/templates/raycluster-cluster.yaml#L108",children:"raycluster labels"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"#example\nmetadata:\n  labels:\n    applicaionId: ray-<service_type>-0001\n    queue: root.ray.<specific_queue_name>\nspec:\n  schedulerName: yunikorn # k8s will inform yunikorn based on this\n"})})]})}function i(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},74094:(e,n,r)=>{r.d(n,{Ay:()=>i,RM:()=>s});var t=r(13274),a=r(37155);const s=[{value:"Setup a KubeRay operator",id:"setup-a-kuberay-operator",level:2}];function o(e){const n={code:"code",h2:"h2",img:"img",li:"li",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"setup-a-kuberay-operator",children:"Setup a KubeRay operator"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"helm repo add kuberay https://ray-project.github.io/kuberay-helm/\nhelm repo update\nhelm install kuberay-operator kuberay/kuberay-operator --version 1.2.2 --set batchScheduler.name=yunikorn\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The result should be as shown below\n",(0,t.jsx)(n.img,{alt:"ray_cluster_operator",src:r(20458).A+"",width:"1182",height:"631"})]}),"\n"]})]})}function i(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},60917:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>u,default:()=>y,frontMatter:()=>l,metadata:()=>c,toc:()=>p});var t=r(13274),a=r(37155),s=r(74094),o=(r(16628),r(72270),r(52426)),i=r(68379);const l={id:"run_ray_cluster",title:"Run RayCluster",description:"How to run Ray Cluster jobs with YuniKorn",keywords:["Ray_crd"]},u=void 0,c={id:"user_guide/workloads/run_ray_cluster",title:"Run RayCluster",description:"How to run Ray Cluster jobs with YuniKorn",source:"@site/versioned_docs/version-1.6.2/user_guide/workloads/run_ray_cluster.md",sourceDirName:"user_guide/workloads",slug:"/user_guide/workloads/run_ray_cluster",permalink:"/docs/1.6.2/user_guide/workloads/run_ray_cluster",draft:!1,unlisted:!1,tags:[],version:"1.6.2",frontMatter:{id:"run_ray_cluster",title:"Run RayCluster",description:"How to run Ray Cluster jobs with YuniKorn",keywords:["Ray_crd"]},sidebar:"docs",previous:{title:"Run MPI Jobs",permalink:"/docs/1.6.2/user_guide/workloads/run_mpi"},next:{title:"Run RayJob",permalink:"/docs/1.6.2/user_guide/workloads/run_ray_job"}},d={},p=[{value:"Install YuniKorn",id:"install-yunikorn",level:2},...s.RM,{value:"Create RayCluster with YuniKorn",id:"create-raycluster-with-yunikorn",level:2},{value:"Submit a RayJob to RayCluster",id:"submit-a-rayjob-to-raycluster",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.admonition,{type:"note",children:[(0,t.jsxs)(n.p,{children:["This example demonstrates how to set up ",(0,t.jsx)(n.a,{href:"https://docs.ray.io/en/master/cluster/kubernetes/getting-started.html",children:"KubeRay"})," and run a ",(0,t.jsx)(n.a,{href:"https://docs.ray.io/en/master/cluster/kubernetes/getting-started/raycluster-quick-start.html",children:"RayCluster"})," with the YuniKorn scheduler. Here're the pre-requisites:"]}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["This tutorial assumes YuniKorn is ",(0,t.jsx)(n.a,{href:"/docs/1.6.2/",children:"installed"})," under the namespace ",(0,t.jsx)(n.code,{children:"yunikorn"})]}),"\n",(0,t.jsx)(n.li,{children:"Use kube-ray version >= 1.2.2 to enable support for YuniKorn gang scheduling"}),"\n"]})]}),"\n",(0,t.jsx)(n.h2,{id:"install-yunikorn",children:"Install YuniKorn"}),"\n",(0,t.jsxs)(n.p,{children:["A simple script to install YuniKorn under the namespace ",(0,t.jsx)(n.code,{children:"yunikorn"}),", refer to ",(0,t.jsx)(n.a,{href:"/docs/1.6.2/",children:"Get Started"})," for more details."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",metastring:"script",children:"helm repo add yunikorn https://apache.github.io/yunikorn-release\nhelm repo update\nhelm install yunikorn yunikorn/yunikorn --create-namespace --namespace yunikorn\n"})}),"\n",(0,t.jsx)(s.Ay,{}),"\n",(0,t.jsx)(n.h2,{id:"create-raycluster-with-yunikorn",children:"Create RayCluster with YuniKorn"}),"\n",(0,t.jsxs)(n.p,{children:["In the example, we set the ",(0,t.jsx)(n.code,{children:"ray.io/gang-scheduling-enabled"})," label to ",(0,t.jsx)(n.code,{children:"true"})," to enable gang scheduling."]}),"\n","\n",(0,t.jsxs)(o.A,{children:[(0,t.jsx)(i.A,{value:"amd64",label:"x86-64 (Intel/Linux)",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'cat <<EOF | kubectl apply -f -\napiVersion: ray.io/v1\nkind: RayCluster\nmetadata:\n  name: test-yunikorn-0\n  labels:\n    ray.io/gang-scheduling-enabled: "true"\n    yunikorn.apache.org/app-id: test-yunikorn-0\n    yunikorn.apache.org/queue: root.default\nspec:\n  rayVersion: "2.9.0"\n  headGroupSpec:\n    rayStartParams: {}\n    template:\n      spec:\n        containers:\n          - name: ray-head\n            image: rayproject/ray:2.9.0\n            resources:\n              limits:\n                cpu: "1"\n                memory: "2Gi"\n              requests:\n                cpu: "1"\n                memory: "2Gi"\n  workerGroupSpecs:\n    - groupName: worker\n      rayStartParams: {}\n      replicas: 2\n      minReplicas: 2\n      maxReplicas: 2\n      template:\n        spec:\n          containers:\n            - name: ray-head\n              image: rayproject/ray:2.9.0\n              resources:\n                limits:\n                  cpu: "1"\n                  memory: "1Gi"\n                requests:\n                  cpu: "1"\n                  memory: "1Gi"\nEOF\n'})})}),(0,t.jsx)(i.A,{value:"aarch64",label:"Apple Silicon(arm64)",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'cat <<EOF | kubectl apply -f -\napiVersion: ray.io/v1\nkind: RayCluster\nmetadata:\n  name: test-yunikorn-0\n  labels:\n    ray.io/gang-scheduling-enabled: "true"\n    yunikorn.apache.org/app-id: test-yunikorn-0\n    yunikorn.apache.org/queue: root.default\nspec:\n  rayVersion: "2.9.0"\n  headGroupSpec:\n    rayStartParams: {}\n    template:\n      spec:\n        containers:\n          - name: ray-head\n            image: rayproject/ray:2.9.0-aarch64\n            resources:\n              limits:\n                cpu: "1"\n                memory: "2Gi"\n              requests:\n                cpu: "1"\n                memory: "2Gi"\n  workerGroupSpecs:\n    - groupName: worker\n      rayStartParams: {}\n      replicas: 2\n      minReplicas: 2\n      maxReplicas: 2\n      template:\n        spec:\n          containers:\n            - name: ray-head\n              image: rayproject/ray:2.9.0-aarch64\n              resources:\n                limits:\n                  cpu: "1"\n                  memory: "1Gi"\n                requests:\n                  cpu: "1"\n                  memory: "1Gi"\nEOF\n'})})})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["RayCluster result\n",(0,t.jsx)(n.img,{alt:"ray_cluster_cluster",src:r(89178).A+"",width:"1184",height:"625"})]}),"\n",(0,t.jsxs)(n.li,{children:["YuniKorn UI\n",(0,t.jsx)(n.img,{alt:"ray_cluster_on_ui",src:r(84888).A+"",width:"1207",height:"681"})]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"submit-a-rayjob-to-raycluster",children:"Submit a RayJob to RayCluster"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'export HEAD_POD=$(kubectl get pods --selector=ray.io/node-type=head -o custom-columns=POD:metadata.name --no-headers)\necho $HEAD_POD\n\nkubectl exec -it $HEAD_POD -- python -c "import ray; ray.init(); print(ray.cluster_resources())"\n'})}),"\n",(0,t.jsx)(n.p,{children:"Services in Kubernetes aren't directly accessible by default. However, you can use port-forwarding to connect to them locally."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"kubectl port-forward service/test-yunikorn-0-head-svc 8265:8265\n"})}),"\n",(0,t.jsxs)(n.p,{children:["After port-forward set up, you can access the Ray dashboard by going to ",(0,t.jsx)(n.code,{children:"http://localhost:8265"})," in your web browser."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Ray Dashboard\n",(0,t.jsx)(n.img,{alt:"ray_cluster_ray_dashborad",src:r(30591).A+"",width:"1207",height:"724"})]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Have doubts? Check out the ",(0,t.jsx)(n.a,{href:"https://docs.ray.io/en/master/cluster/kubernetes/k8s-ecosystem/yunikorn.html",children:"KubeRay integration with Apache YuniKorn"})," official documents."]})]})}function y(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},72270:(e,n,r)=>{r.d(n,{Ay:()=>i,RM:()=>s});var t=r(13274),a=r(37155);const s=[{value:"Modify YuniKorn settings",id:"modify-yunikorn-settings",level:2}];function o(e){const n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"modify-yunikorn-settings",children:"Modify YuniKorn settings"}),"\n",(0,t.jsxs)(n.p,{children:["Follow ",(0,t.jsx)(n.a,{href:"https://yunikorn.apache.org/docs/",children:"YuniKorn install guide"}),' and modify YuniKorn configmap "yunikorn-defaults" to allow ray operator based on k8s service account.']}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'kubectl patch configmap yunikorn-defaults -n yunikorn --patch \'{"data":{"admissionController.accessControl.systemUsers": "^system:serviceaccount:kube-system:,^system:serviceaccount:default:"}}\' \n'})})]})}function i(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},68379:(e,n,r)=>{r.d(n,{A:()=>o});r(79474);var t=r(13526);const a={tabItem:"tabItem_YAFS"};var s=r(13274);function o(e){let{children:n,hidden:r,className:o}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,t.A)(a.tabItem,o),hidden:r,children:n})}},52426:(e,n,r)=>{r.d(n,{A:()=>v});var t=r(79474),a=r(13526),s=r(78948),o=r(20241),i=r(5840),l=r(34529),u=r(86558),c=r(65657);function d(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:r}=e;return(0,t.useMemo)((()=>{const e=n??function(e){return d(e).map((e=>{let{props:{value:n,label:r,attributes:t,default:a}}=e;return{value:n,label:r,attributes:t,default:a}}))}(r);return function(e){const n=(0,u.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,r])}function h(e){let{value:n,tabValues:r}=e;return r.some((e=>e.value===n))}function y(e){let{queryString:n=!1,groupId:r}=e;const a=(0,o.W6)(),s=function(e){let{queryString:n=!1,groupId:r}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:n,groupId:r});return[(0,l.aZ)(s),(0,t.useCallback)((e=>{if(!s)return;const n=new URLSearchParams(a.location.search);n.set(s,e),a.replace({...a.location,search:n.toString()})}),[s,a])]}function m(e){const{defaultValue:n,queryString:r=!1,groupId:a}=e,s=p(e),[o,l]=(0,t.useState)((()=>function(e){let{defaultValue:n,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!h({value:n,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const t=r.find((e=>e.default))??r[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:s}))),[u,d]=y({queryString:r,groupId:a}),[m,b]=function(e){let{groupId:n}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(n),[a,s]=(0,c.Dv)(r);return[a,(0,t.useCallback)((e=>{r&&s.set(e)}),[r,s])]}({groupId:a}),f=(()=>{const e=u??m;return h({value:e,tabValues:s})?e:null})();(0,i.A)((()=>{f&&l(f)}),[f]);return{selectedValue:o,selectValue:(0,t.useCallback)((e=>{if(!h({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),b(e)}),[d,b,s]),tabValues:s}}var b=r(37132);const f={tabList:"tabList_kwY2",tabItem:"tabItem_UbG1"};var g=r(13274);function x(e){let{className:n,block:r,selectedValue:t,selectValue:o,tabValues:i}=e;const l=[],{blockElementScrollPositionUntilNextRender:u}=(0,s.a_)(),c=e=>{const n=e.currentTarget,r=l.indexOf(n),a=i[r].value;a!==t&&(u(n),o(a))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const r=l.indexOf(e.currentTarget)+1;n=l[r]??l[0];break}case"ArrowLeft":{const r=l.indexOf(e.currentTarget)-1;n=l[r]??l[l.length-1];break}}n?.focus()};return(0,g.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":r},n),children:i.map((e=>{let{value:n,label:r,attributes:s}=e;return(0,g.jsx)("li",{role:"tab",tabIndex:t===n?0:-1,"aria-selected":t===n,ref:e=>l.push(e),onKeyDown:d,onClick:c,...s,className:(0,a.A)("tabs__item",f.tabItem,s?.className,{"tabs__item--active":t===n}),children:r??n},n)}))})}function j(e){let{lazy:n,children:r,selectedValue:s}=e;const o=(Array.isArray(r)?r:[r]).filter(Boolean);if(n){const e=o.find((e=>e.props.value===s));return e?(0,t.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,g.jsx)("div",{className:"margin-top--md",children:o.map(((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==s})))})}function k(e){const n=m(e);return(0,g.jsxs)("div",{className:(0,a.A)("tabs-container",f.tabList),children:[(0,g.jsx)(x,{...n,...e}),(0,g.jsx)(j,{...n,...e})]})}function v(e){const n=(0,b.A)();return(0,g.jsx)(k,{...e,children:d(e.children)},String(n))}},89178:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/ray_cluster_cluster-c5cb7e8067e98fe24bb652662810980f.png"},84888:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/ray_cluster_on_ui-61bdd5adff322e714cb09d5d1c59dd13.png"},20458:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/ray_cluster_operator-24963b289165db8894f7e611a0bc1d9a.png"},30591:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/ray_cluster_ray_dashborad-542d31f005576a99cb416495c3341f55.png"},37155:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>i});var t=r(79474);const a={},s=t.createContext(a);function o(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);