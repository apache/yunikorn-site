"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[69977],{7446:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>d,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>h});var s=n(13274),i=n(1780);const r={id:"evaluate_perf_function_with_kwok",title:"Evaluate YuniKorn Performance with KWOK"},d=void 0,l={id:"performance/evaluate_perf_function_with_kwok",title:"Evaluate YuniKorn Performance with KWOK",description:"\x3c!--",source:"@site/versioned_docs/version-1.5.1/performance/evaluate_perf_function_with_kwok.md",sourceDirName:"performance",slug:"/performance/evaluate_perf_function_with_kwok",permalink:"/docs/performance/evaluate_perf_function_with_kwok",draft:!1,unlisted:!1,tags:[],version:"1.5.1",frontMatter:{id:"evaluate_perf_function_with_kwok",title:"Evaluate YuniKorn Performance with KWOK"},sidebar:"docs",previous:{title:"Evaluate YuniKorn Performance with Kubemark",permalink:"/docs/performance/evaluate_perf_function_with_kubemark"},next:{title:"Benchmarking Tutorial",permalink:"/docs/performance/performance_tutorial"}},o={},h=[{value:"Environment",id:"environment",level:2},{value:"Test Cases",id:"test-cases",level:2},{value:"Throughtput",id:"throughtput",level:3},{value:"Test Case:",id:"test-case",level:4},{value:"Result:",id:"result",level:4},{value:"Taint &amp; Tolerations",id:"taint--tolerations",level:3},{value:"Result:",id:"result-1",level:4},{value:"Affinity &amp; Non-Affinity",id:"affinity--non-affinity",level:3},{value:"Result",id:"result-2",level:4},{value:"PriorityClass",id:"priorityclass",level:3},{value:"Result",id:"result-3",level:4},{value:"Summary",id:"summary",level:2}];function a(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://kwok.sigs.k8s.io/",children:"KWOK"})," is a powerful toolkit designed to swiftly establish a cluster of thousands of Nodes within seconds. This page is dedicated to leveraging KWOK for performance testing. The objective is to conduct a comparative analysis between YuniKorn (Standard mode/Plugin mode) and Kube-scheduler, evaluating their capabilities in workload handling."]}),"\n",(0,s.jsx)(t.p,{children:"KWOK conserves memory by emulating only node and pod behavior, unlike Kubemark, which emulates a kubelet and consumes a significant amount of memory."}),"\n",(0,s.jsx)(t.p,{children:"Using Kwok, we replicated previous performance tests, deploying 10 deployments on 5000 nodes with 5000 replicas each, resulting in a remarkably low total memory usage of 30-40GB. As a result, Kwok enables us to scale up experiments and assess the performance of YuniKorn without the need to consider bandwidth and Kubelet processing speed."}),"\n",(0,s.jsx)(t.h2,{id:"environment",children:"Environment"}),"\n",(0,s.jsxs)(t.p,{children:["The test is conducted using KWOK in a Cluster. The cluster environment is optimized according to the performance tuning settings in the YuniKorn documentation. For more details, refer to the ",(0,s.jsx)(t.a,{href:"/docs/performance/performance_tutorial#performance-tuning",children:"Benchmarking Tutorial"}),". You can conveniently set up Kwok in your Kubernetes Cluster by downloading the scripts we provide ",(0,s.jsx)(t.a,{href:"https://github.com/apache/yunikorn-k8shim/blob/master/deployments/kwok-perf-test/kwok-setup.sh",children:"here"}),"."]}),"\n",(0,s.jsx)(t.p,{children:'For data monitoring, Prometheus will be employed to gather metrics. We\'ll use count(kube_pod_status_scheduled_time{namespace="default"}) as an indicator of throughput.'}),"\n",(0,s.jsx)(t.h2,{id:"test-cases",children:"Test Cases"}),"\n",(0,s.jsx)(t.p,{children:"We will start a comparative analysis with kube-scheduler to evaluate the throughput of these two different schedulers. In addition, we will compare the performance differences when managing large numbers of Taints and Tolerations, configuring Affinity and Anti-Affinity settings, and handling PriorityClass jobs."}),"\n",(0,s.jsxs)(t.admonition,{type:"important",children:[(0,s.jsx)(t.p,{children:"YuniKorn schedules pods according to the application. Bearing this in mind, our testing focuses on assessing the impact of various features like Taint & Tolerations, Affinity, and PriorityClass on performance. This requires assigning unique configurations to each pod to understand their effects accurately. We use shell scripts to configure a large number of pods efficiently, storing their configurations in a YAML file. These pods are then deployed as needed to evaluate the impact on system performance."}),(0,s.jsx)(t.p,{children:"During this process, we've identified that the primary constraint is the processing capability of the api-server. Our data indicates that it is capable of deploying 5,000 pods in just 38 seconds, achieving a throughput of 131.6 pods per second."})]}),"\n",(0,s.jsx)(t.h3,{id:"throughtput",children:"Throughtput"}),"\n",(0,s.jsx)(t.p,{children:"In this experiment, we will use the following three test cases to measure the throughput and scheduling duration of different schedulers. Each application will be deployed at one-second intervals."}),"\n",(0,s.jsx)(t.h4,{id:"test-case",children:"Test Case:"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Test Case"}),(0,s.jsx)(t.th,{children:"Applications"}),(0,s.jsx)(t.th,{children:"Tasks"}),(0,s.jsx)(t.th,{children:"Total Pods"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"#1"}),(0,s.jsx)(t.td,{children:"1"}),(0,s.jsx)(t.td,{children:"5000"}),(0,s.jsx)(t.td,{children:"5000"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"#2"}),(0,s.jsx)(t.td,{children:"5"}),(0,s.jsx)(t.td,{children:"1000"}),(0,s.jsx)(t.td,{children:"5000"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"#3"}),(0,s.jsx)(t.td,{children:"25"}),(0,s.jsx)(t.td,{children:"200"}),(0,s.jsx)(t.td,{children:"5000"})]})]})]}),"\n",(0,s.jsx)(t.h4,{id:"result",children:"Result:"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"#1"}),(0,s.jsx)(t.th,{children:"kube-scheduler"}),(0,s.jsx)(t.th,{children:"yunikorn"}),(0,s.jsx)(t.th,{children:"yunikorn plugin mode"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"makespan"}),(0,s.jsx)(t.td,{children:"99"}),(0,s.jsx)(t.td,{children:"6"}),(0,s.jsx)(t.td,{children:"99"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"throughput(pods/sec)"}),(0,s.jsx)(t.td,{children:"50.5"}),(0,s.jsx)(t.td,{children:"833.3"}),(0,s.jsx)(t.td,{children:"50.5"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.img,{alt:"throughput-result-01",src:n(78809).A+"",width:"752",height:"600"})}),(0,s.jsx)(t.td,{}),(0,s.jsx)(t.td,{}),(0,s.jsx)(t.td,{})]})]})]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"#2"}),(0,s.jsx)(t.th,{children:"kube-scheduler"}),(0,s.jsx)(t.th,{children:"yunikorn"}),(0,s.jsx)(t.th,{children:"yunikorn plugin mode"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"makespan"}),(0,s.jsx)(t.td,{children:"99"}),(0,s.jsx)(t.td,{children:"9"}),(0,s.jsx)(t.td,{children:"100"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"throughput(pods/sec)"}),(0,s.jsx)(t.td,{children:"50.5"}),(0,s.jsx)(t.td,{children:"555.6"}),(0,s.jsx)(t.td,{children:"50"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.img,{alt:"throughput-result-02",src:n(64802).A+"",width:"752",height:"600"})}),(0,s.jsx)(t.td,{}),(0,s.jsx)(t.td,{}),(0,s.jsx)(t.td,{})]})]})]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"#3"}),(0,s.jsx)(t.th,{children:"kube-scheduler"}),(0,s.jsx)(t.th,{children:"yunikorn"}),(0,s.jsx)(t.th,{children:"yunikorn plugin mode"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"makespan"}),(0,s.jsx)(t.td,{children:"99"}),(0,s.jsx)(t.td,{children:"32"}),(0,s.jsx)(t.td,{children:"100"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"throughput(pods/sec)"}),(0,s.jsx)(t.td,{children:"50.5"}),(0,s.jsx)(t.td,{children:"156.3"}),(0,s.jsx)(t.td,{children:"50"})]})]})]}),"\n",(0,s.jsx)(t.admonition,{type:"note",children:(0,s.jsx)(t.p,{children:"Regarding the throughput of the YuniKorn Scheduler, the third test took the longest time. This can be attributed to the fact that the application is deployed only every second, thereby lengthening the makespan."})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"throughput-result-03",src:n(28459).A+"",width:"752",height:"599"})}),"\n",(0,s.jsx)(t.h3,{id:"taint--tolerations",children:"Taint & Tolerations"}),"\n",(0,s.jsx)(t.p,{children:"In the Taint & Tolerations test case, each node is initially assigned a taint that corresponds to its numerical identifier. Following this, pods are randomly assigned tolerations based on the indexes of different nodes. To assess the impact on system performance, we will deploy a YAML file containing 5000 pods and monitor the outcome."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:"kubectl taint nodes kwok-node-1 key-1=value-1:NoSchedule\n"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:'tolerations:\n- key: key-$rand\n  operator: "Exists"\n'})}),"\n",(0,s.jsx)(t.h4,{id:"result-1",children:"Result:"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Taint & Tolerations"}),(0,s.jsx)(t.th,{children:"kube-scheduler"}),(0,s.jsx)(t.th,{children:"yunikorn"}),(0,s.jsx)(t.th,{children:"yunikorn plugin mode"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"makespan"}),(0,s.jsx)(t.td,{children:"99"}),(0,s.jsx)(t.td,{children:"36"}),(0,s.jsx)(t.td,{children:"99"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"throughput(pods/sec)"}),(0,s.jsx)(t.td,{children:"50.5"}),(0,s.jsx)(t.td,{children:"138.9"}),(0,s.jsx)(t.td,{children:"50.5"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.img,{alt:"taint-tolerations-result",src:n(60115).A+"",width:"888",height:"508"})}),(0,s.jsx)(t.td,{}),(0,s.jsx)(t.td,{}),(0,s.jsx)(t.td,{})]})]})]}),"\n",(0,s.jsx)(t.h3,{id:"affinity--non-affinity",children:"Affinity & Non-Affinity"}),"\n",(0,s.jsx)(t.p,{children:"In the test cases for Affinity & Non-Affinity, 5,000 pods will be divided into four different combinations as follows:"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Types of Node affinity and anti-affinity"}),(0,s.jsx)(t.th,{children:"Operator"}),(0,s.jsx)(t.th,{children:"Numbers of Pods"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Preferred"}),(0,s.jsx)(t.td,{children:"In"}),(0,s.jsx)(t.td,{children:"625"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Preferred"}),(0,s.jsx)(t.td,{children:"NotIn"}),(0,s.jsx)(t.td,{children:"625"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Required"}),(0,s.jsx)(t.td,{children:"In"}),(0,s.jsx)(t.td,{children:"625"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Required"}),(0,s.jsx)(t.td,{children:"NotIn"}),(0,s.jsx)(t.td,{children:"625"})]})]})]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Types of Pod affinity and anti-affinity"}),(0,s.jsx)(t.th,{children:"Operator"}),(0,s.jsx)(t.th,{children:"Numbers of Pods"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Preferred"}),(0,s.jsx)(t.td,{children:"In"}),(0,s.jsx)(t.td,{children:"1250"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Preferred"}),(0,s.jsx)(t.td,{children:"NotIn"}),(0,s.jsx)(t.td,{children:"1250"})]})]})]}),"\n",(0,s.jsx)(t.p,{children:"In the Node affinity section, the matchExpressions value is set to the hostname of a randomly selected node."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:"affinity:\n    nodeAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        nodeSelectorTerms:\n        - matchExpressions:\n          - key: kubernetes.io/hostname\n            operator: $operator\n            values:\n            - kwok-node-$randHost\n"})}),"\n",(0,s.jsx)(t.p,{children:"In the Pod affinity section, the value of matchExpressions is a randomly assigned applicationId."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",children:"affinity:\n  podAffinity:\n    preferredDuringSchedulingIgnoredDuringExecution:\n    - weight: 100\n      podAffinityTerm:\n        labelSelector:\n          matchExpressions:\n          - key: applicationId\n            operator: $operator\n            values:\n            - nginx-$randAppID1\n        topologyKey: kubernetes.io/role\n"})}),"\n",(0,s.jsx)(t.h4,{id:"result-2",children:"Result"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Affinity & Non-Affinity"}),(0,s.jsx)(t.th,{children:"kube-scheduler"}),(0,s.jsx)(t.th,{children:"yunikorn"}),(0,s.jsx)(t.th,{children:"yunikorn plugin mode"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"makespan"}),(0,s.jsx)(t.td,{children:"99"}),(0,s.jsx)(t.td,{children:"42"}),(0,s.jsx)(t.td,{children:"100"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"throughput(pods/sec)"}),(0,s.jsx)(t.td,{children:"50.5"}),(0,s.jsx)(t.td,{children:"119"}),(0,s.jsx)(t.td,{children:"50"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.img,{alt:"taint-affinity-result",src:n(52091).A+"",width:"888",height:"508"})}),(0,s.jsx)(t.td,{}),(0,s.jsx)(t.td,{}),(0,s.jsx)(t.td,{})]})]})]}),"\n",(0,s.jsx)(t.h3,{id:"priorityclass",children:"PriorityClass"}),"\n",(0,s.jsx)(t.p,{children:"Firstly, deploy 100 distinct PriorityClasses. Subsequently, deploy Jobs with 5,000 Pods at the same time. As YuniKorn sorts priorities solely based on the application and queue, we will assign unique applicationIDs to each Pod and randomly assign different PriorityClasses to the Pods. This approach allows us to observe and analyze the throughput differences between different schedulers."}),"\n",(0,s.jsx)(t.h4,{id:"result-3",children:"Result"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"PriorityClass"}),(0,s.jsx)(t.th,{children:"kube-scheduler"}),(0,s.jsx)(t.th,{children:"yunikorn"}),(0,s.jsx)(t.th,{children:"yunikorn plugin mode"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"makespan"}),(0,s.jsx)(t.td,{children:"99"}),(0,s.jsx)(t.td,{children:"38"}),(0,s.jsx)(t.td,{children:"99"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"throughput(pods/sec)"}),(0,s.jsx)(t.td,{children:"50.5"}),(0,s.jsx)(t.td,{children:"131.6"}),(0,s.jsx)(t.td,{children:"50.5"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.img,{alt:"taint-tolerations-result",src:n(6567).A+"",width:"888",height:"512"})}),(0,s.jsx)(t.td,{}),(0,s.jsx)(t.td,{}),(0,s.jsx)(t.td,{})]})]})]}),"\n",(0,s.jsx)(t.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(t.p,{children:"The test results reveal that YuniKorn demonstrates the highest throughput across all three tests. Both Kube-scheduler and YuniKorn plugin mode perform comparably."}),"\n",(0,s.jsx)(t.p,{children:"In tests involving Taint & Tolerations, Affinity & Anti-affinity, and PriorityClass, it's observed that despite numerous parameters and constraints in the deployment process, there's minimal impact on the final throughput and makespan. With the YuniKorn scheduler, a relatively lower throughput was noted, primarily due to the api-server becoming a bottleneck when deploying 5,000 pods simultaneously."})]})}function c(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},52091:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/kwok-affinity-1c42746be1a6b89087ec10944aec0bca.png"},6567:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/kwok-priorityclass-e28a81951e8d025aae96677cd92a5fde.png"},78809:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/kwok-throughput-01-a9f147fd1945027fb4b15b5ae0018e05.png"},64802:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/kwok-throughput-02-d8a8a1ff3b1c0577939204be090ae63b.png"},28459:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/kwok-throughput-03-9e48269773e99ba4b8da25f3a83e0d0b.png"},60115:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/kwok-toleration-taint-493e1cb861ccccbe5c24e2956471af61.png"},1780:(e,t,n)=>{n.d(t,{R:()=>d,x:()=>l});var s=n(79474);const i={},r=s.createContext(i);function d(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);