"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[35173],{58860:(e,n,i)=>{i.d(n,{xA:()=>u,yg:()=>h});var t=i(37953);function o(e,n,i){return n in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}function a(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),i.push.apply(i,t)}return i}function r(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?a(Object(i),!0).forEach((function(n){o(e,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))}))}return e}function l(e,n){if(null==e)return{};var i,t,o=function(e,n){if(null==e)return{};var i,t,o={},a=Object.keys(e);for(t=0;t<a.length;t++)i=a[t],n.indexOf(i)>=0||(o[i]=e[i]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)i=a[t],n.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(o[i]=e[i])}return o}var s=t.createContext({}),p=function(e){var n=t.useContext(s),i=n;return e&&(i="function"==typeof e?e(n):r(r({},n),e)),i},u=function(e){var n=p(e.components);return t.createElement(s.Provider,{value:n},e.children)},c="mdxType",g={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},d=t.forwardRef((function(e,n){var i=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(i),d=o,h=c["".concat(s,".").concat(d)]||c[d]||g[d]||a;return i?t.createElement(h,r(r({ref:n},u),{},{components:i})):t.createElement(h,r({ref:n},u))}));function h(e,n){var i=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=i.length,r=new Array(a);r[0]=d;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[c]="string"==typeof e?e:o,r[1]=l;for(var p=2;p<a;p++)r[p]=i[p];return t.createElement.apply(null,r)}return t.createElement.apply(null,i)}d.displayName="MDXCreateElement"},74547:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>s,contentTitle:()=>r,default:()=>g,frontMatter:()=>a,metadata:()=>l,toc:()=>p});var t=i(72994),o=(i(37953),i(58860));const a={id:"sorting_policies",title:"Sorting Policies"},r=void 0,l={unversionedId:"user_guide/sorting_policies",id:"user_guide/sorting_policies",title:"Sorting Policies",description:"\x3c!--",source:"@site/docs/user_guide/sorting_policies.md",sourceDirName:"user_guide",slug:"/user_guide/sorting_policies",permalink:"/docs/next/user_guide/sorting_policies",draft:!1,tags:[],version:"current",frontMatter:{id:"sorting_policies",title:"Sorting Policies"},sidebar:"docs",previous:{title:"User & Group Resolution",permalink:"/docs/next/user_guide/usergroup_resolution"},next:{title:"App & Queue Priorities",permalink:"/docs/next/user_guide/priorities"}},s={},p=[{value:"Application sorting",id:"application-sorting",level:2},{value:"FifoSortPolicy",id:"fifosortpolicy",level:3},{value:"FairSortPolicy",id:"fairsortpolicy",level:3},{value:"Node sorting",id:"node-sorting",level:2},{value:"FairnessPolicy",id:"fairnesspolicy",level:3},{value:"BinPackingPolicy",id:"binpackingpolicy",level:3},{value:"Resource weighting",id:"resource-weighting",level:2},{value:"Request sorting",id:"request-sorting",level:2}],u={toc:p},c="wrapper";function g(e){let{components:n,...i}=e;return(0,o.yg)(c,(0,t.A)({},u,i,{components:n,mdxType:"MDXLayout"}),(0,o.yg)("p",null,"The scheduler uses policies allow changing the scheduling behaviour without code changes.\nPolicies can be set for:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"#application-sorting"},"Applications")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"#node-sorting"},"Nodes")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"#request-sorting"},"Requests"))),(0,o.yg)("h2",{id:"application-sorting"},"Application sorting"),(0,o.yg)("p",null,"The application sorting policy is set for each queue via the config.\nA sorting policy setting is only effective on a ",(0,o.yg)("em",{parentName:"p"},"leaf")," queue.\nEach ",(0,o.yg)("em",{parentName:"p"},"leaf")," queue can use a different policy."),(0,o.yg)("p",null,"A sorting policy only specifies the order in which the applications are sorted within a queue.\nThat order is crucial in specifying which application is considered first when assigning resources.\nSorting policies do ",(0,o.yg)("em",{parentName:"p"},"not")," affect the number of applications that are scheduled or active in the queue at the same time.\nAll applications that have pending resource requests can and will be scheduled in a queue unless specifically filtered out.\nEven when applications are sorted using a first in first out policy multiple applications will run in a queue in parallel. "),(0,o.yg)("p",null,"A ",(0,o.yg)("em",{parentName:"p"},"parent")," queue will always use the fair policy to sort the child queues."),(0,o.yg)("p",null,"The relative priority of child queues (in the case of ",(0,o.yg)("em",{parentName:"p"},"parent")," queue sorting)\nand applications (in the case of ",(0,o.yg)("em",{parentName:"p"},"leaf")," queue sorting) will be considered first.\nTo ignore application and queue priorities when scheduling, set the queue\nproperty ",(0,o.yg)("inlineCode",{parentName:"p"},"application.sort.priority")," to ",(0,o.yg)("inlineCode",{parentName:"p"},"disabled"),"."),(0,o.yg)("p",null,"The following configuration entry sets the application sorting policy to ",(0,o.yg)("inlineCode",{parentName:"p"},"fifo")," for the queue ",(0,o.yg)("inlineCode",{parentName:"p"},"root.sandbox"),": "),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"partitions:\n  - name: default\n    queues:\n    - name: root\n      queues:\n      - name: sandbox\n        properties:\n          application.sort.policy: fifo\n")),(0,o.yg)("p",null,"The only applications that are considered during scheduling must have outstanding requests.\nA filter is applied ",(0,o.yg)("em",{parentName:"p"},"while")," sorting the applications to remove all that do not have outstanding requests."),(0,o.yg)("h3",{id:"fifosortpolicy"},"FifoSortPolicy"),(0,o.yg)("p",null,"Short description: first in first out, based on application create time  "),(0,o.yg)("p",null,"Config value: ",(0,o.yg)("inlineCode",{parentName:"p"},"fifo")," (default)"),(0,o.yg)("p",null,"Before sorting, the applications are filtered and must have pending resource requests."),(0,o.yg)("p",null,"After filtering the applications left are sorted based on the application create time stamp only, no other filtering is applied.\nSince applications can only be added while the system is locked there can never be two applications with the exact same time stamp. "),(0,o.yg)("p",null,"The result is that the oldest application that requests resources gets resources.\nYounger applications will be given resources when all the current requests of older applications have been fulfilled. "),(0,o.yg)("h3",{id:"fairsortpolicy"},"FairSortPolicy"),(0,o.yg)("p",null,"Short description: fair based on usage  "),(0,o.yg)("p",null,"Config value: ",(0,o.yg)("inlineCode",{parentName:"p"},"fair")),(0,o.yg)("p",null,"Before sorting the applications are filtered and must have pending resource requests."),(0,o.yg)("p",null,"After filtering the applications left are sorted based on the application usage.\nThe usage of the application is defined as all confirmed and unconfirmed allocations for the applications.\nAll resources defined on the application will be taken into account when calculating the usage."),(0,o.yg)("p",null,"The result is that the resources available are spread equally over all applications that request resources."),(0,o.yg)("h2",{id:"node-sorting"},"Node sorting"),(0,o.yg)("p",null,"The node sorting policy is set for a partition via the config.\nEach partition can use a different policy."),(0,o.yg)("p",null,"The following configuration entry sets the node sorting policy to ",(0,o.yg)("inlineCode",{parentName:"p"},"fair")," for the partition ",(0,o.yg)("inlineCode",{parentName:"p"},"default"),": "),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"partitions:\n  - name: default\n    nodesortpolicy:\n        type: fair\n")),(0,o.yg)("h3",{id:"fairnesspolicy"},"FairnessPolicy"),(0,o.yg)("p",null,"Short description: available resource, descending order",(0,o.yg)("br",{parentName:"p"}),"\n","Config value: fair (default)",(0,o.yg)("br",{parentName:"p"}),"\n","Behaviour:",(0,o.yg)("br",{parentName:"p"}),"\n","Sort the list of nodes by the amount of available resources so that the node with the ",(0,o.yg)("em",{parentName:"p"},"highest")," amount of available resource is the first in the list.\nAll resources defined on a node will be taken into account when calculating the usage.\nResources of the same type are compared for the nodes. "),(0,o.yg)("p",null,"This results in a node with the lowest utilisation to be considered first for assigning new allocation.\nResulting in a spread of allocations over all available nodes.\nLeading to an overall lower utilisation of the individual available nodes, unless the whole environment is highly utilised.\nKeeping the load on all nodes at a similar level does help\nIn an environment that auto scales by adding new nodes this could trigger unexpected auto scale requests.   "),(0,o.yg)("h3",{id:"binpackingpolicy"},"BinPackingPolicy"),(0,o.yg)("p",null,"Short description: available resource, ascending order",(0,o.yg)("br",{parentName:"p"}),"\n","Config value: binpacking",(0,o.yg)("br",{parentName:"p"}),"\n","Behaviour:",(0,o.yg)("br",{parentName:"p"}),"\n","Sort the list of nodes by the amount of available resources so that the node with the ",(0,o.yg)("em",{parentName:"p"},"lowest")," amount of available resource is the first in the list.\nAll resources defined on a node will be taken into account when calculating the usage.\nResources of the same type are compared for the nodes. "),(0,o.yg)("p",null,"This results in a node with the highest utilisation to be considered first for assigning new allocation.\nResulting in a high(er) utilisation of a small(er) number of nodes, better suited for cloud deployments.   "),(0,o.yg)("h2",{id:"resource-weighting"},"Resource weighting"),(0,o.yg)("p",null,"Node sorting policies may use the utilization of a node to determine ordering. Because nodes can have several unique\nresource types, a node's utilization is determined by a weighted average of its individual resource types. Resource\nweighting can be customized by using the ",(0,o.yg)("inlineCode",{parentName:"p"},"resourceweights")," section of ",(0,o.yg)("inlineCode",{parentName:"p"},"nodesortpolicy"),". If ",(0,o.yg)("inlineCode",{parentName:"p"},"resourceweights")," is not\npresent or empty, the default configuration sets the weight of both ",(0,o.yg)("inlineCode",{parentName:"p"},"vcore")," and ",(0,o.yg)("inlineCode",{parentName:"p"},"memory")," equally to ",(0,o.yg)("inlineCode",{parentName:"p"},"1.0"),". All other\nresource types are ignored. Only resource types explicitly mentioned will have a weight."),(0,o.yg)("p",null,"YuniKorn tracks CPU resources internally as the ",(0,o.yg)("inlineCode",{parentName:"p"},"vcore")," resource type. This maps to the Kubernetes resource type ",(0,o.yg)("inlineCode",{parentName:"p"},"cpu"),".\nAll other resource types have consistent naming between YuniKorn and Kubernetes."),(0,o.yg)("p",null,"For example, in the default configuration, if a node has ",(0,o.yg)("inlineCode",{parentName:"p"},"90%")," of its CPU and ",(0,o.yg)("inlineCode",{parentName:"p"},"50%")," of its memory allocated, the node\nwill be considered to be ",(0,o.yg)("inlineCode",{parentName:"p"},"70%")," utilized."),(0,o.yg)("p",null,"The following configuration entry sets the weight of ",(0,o.yg)("inlineCode",{parentName:"p"},"vcore")," to ",(0,o.yg)("inlineCode",{parentName:"p"},"4.0")," and ",(0,o.yg)("inlineCode",{parentName:"p"},"memory")," to ",(0,o.yg)("inlineCode",{parentName:"p"},"1.0")," for the partition ",(0,o.yg)("inlineCode",{parentName:"p"},"default"),".\nThis will weight CPU usage four times higher than memory usage:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-yaml"},"partitions:\n  - name: default\n    nodesortpolicy:\n      type: fair\n      resourceweights:\n        vcore: 4.0\n        memory: 1.0\n")),(0,o.yg)("p",null,"With this configuration, In this example, if a node has ",(0,o.yg)("inlineCode",{parentName:"p"},"90%")," of its CPU and ",(0,o.yg)("inlineCode",{parentName:"p"},"50%")," of its memory allocated, the node\nwill be considered to be ",(0,o.yg)("inlineCode",{parentName:"p"},"82%")," utilized."),(0,o.yg)("p",null,"Note that weights are relative to each other, so specifying weights of ",(0,o.yg)("inlineCode",{parentName:"p"},"{ 4.0, 1.0 }")," is equivalent to\n",(0,o.yg)("inlineCode",{parentName:"p"},"{ 1.0, 0.25 }"),". Negative weights are not allowed."),(0,o.yg)("h2",{id:"request-sorting"},"Request sorting"),(0,o.yg)("p",null,"There is currently one policy for sorting requests within an application.\nThis policy is not configurable.\nSorting requests is only possible based on the priority of the request.\nIf there are multiple requests within an application that have the same priority the order of the requests is undetermined.\nThis means that the order of requests with the same priority can, and most likely will, change between runs."))}g.isMDXComponent=!0}}]);