"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[68047],{46087:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>d});var s=t(13274),i=t(1780);const l={id:"trouble_shooting",title:"Trouble Shooting"},o=void 0,r={id:"user_guide/trouble_shooting",title:"Trouble Shooting",description:"\x3c!--",source:"@site/versioned_docs/version-0.9.0/user_guide/trouble_shooting.md",sourceDirName:"user_guide",slug:"/user_guide/trouble_shooting",permalink:"/docs/0.9.0/user_guide/trouble_shooting",draft:!1,unlisted:!1,tags:[],version:"0.9.0",frontMatter:{id:"trouble_shooting",title:"Trouble Shooting"},sidebar:"docs",previous:{title:"System",permalink:"/docs/0.9.0/api/system"},next:{title:"Dev Environment Setup",permalink:"/docs/0.9.0/developer_guide/env_setup"}},c={},d=[{value:"Scheduler logs",id:"scheduler-logs",level:2},{value:"Retrieve scheduler logs",id:"retrieve-scheduler-logs",level:3},{value:"Set Logging Level",id:"set-logging-level",level:3},{value:"Pods are stuck at Pending state",id:"pods-are-stuck-at-pending-state",level:2},{value:"1. Non of the nodes satisfy pod placement requirement",id:"1-non-of-the-nodes-satisfy-pod-placement-requirement",level:3},{value:"2. The queue is running out of capacity",id:"2-the-queue-is-running-out-of-capacity",level:3},{value:"Restart the scheduler",id:"restart-the-scheduler",level:2},{value:"Still got questions?",id:"still-got-questions",level:2}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"scheduler-logs",children:"Scheduler logs"}),"\n",(0,s.jsx)(n.h3,{id:"retrieve-scheduler-logs",children:"Retrieve scheduler logs"}),"\n",(0,s.jsxs)(n.p,{children:["Currently, the scheduler writes its logs to stdout/stderr, docker container handles the redirection of these logs to a\nlocal location on the underneath node, you can read more document ",(0,s.jsx)(n.a,{href:"https://docs.docker.com/config/containers/logging/configure/",children:"here"}),".\nThese logs can be retrieved by ",(0,s.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#logs",children:"kubectl logs"}),". Such as:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",metastring:"script",children:"// get the scheduler pod\nkubectl get pod -l component=yunikorn-scheduler -n yunikorn\nNAME                                  READY   STATUS    RESTARTS   AGE\nyunikorn-scheduler-766d7d6cdd-44b82   2/2     Running   0          33h\n\n// retrieve logs\nkubectl logs yunikorn-scheduler-766d7d6cdd-44b82 yunikorn-scheduler-k8s -n yunikorn\n"})}),"\n",(0,s.jsxs)(n.p,{children:["In most cases, this command cannot get all logs because the scheduler is rolling logs very fast. To retrieve more logs in\nthe past, you will need to setup the ",(0,s.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/cluster-administration/logging/#cluster-level-logging-architectures",children:"cluster level logging"}),".\nThe recommended setup is to leverage ",(0,s.jsx)(n.a,{href:"https://www.fluentd.org/",children:"fluentd"})," to collect and persistent logs on an external storage, e.g s3."]}),"\n",(0,s.jsx)(n.h3,{id:"set-logging-level",children:"Set Logging Level"}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsx)(n.p,{children:"Changing the logging level requires a restart of the scheduler pod."})}),"\n",(0,s.jsx)(n.p,{children:"Stop the scheduler:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",metastring:"script",children:"kubectl scale deployment yunikorn-scheduler -n yunikorn --replicas=0\n"})}),"\n",(0,s.jsx)(n.p,{children:"edit the deployment config in vim:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",metastring:"script",children:"kubectl edit deployment yunikorn-scheduler -n yunikorn\n"})}),"\n",(0,s.jsxs)(n.p,{children:["add ",(0,s.jsx)(n.code,{children:"LOG_LEVEL"})," to the ",(0,s.jsx)(n.code,{children:"env"})," field of the container template. For example setting ",(0,s.jsx)(n.code,{children:"LOG_LEVEL"})," to ",(0,s.jsx)(n.code,{children:"0"})," sets the logging\nlevel to ",(0,s.jsx)(n.code,{children:"INFO"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n ...\nspec:\n  template: \n   ...\n    spec:\n      containers:\n      - env:\n        - name: LOG_LEVEL\n          value: '0'\n"})}),"\n",(0,s.jsx)(n.p,{children:"Start the scheduler:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",metastring:"script",children:"kubectl scale deployment yunikorn-scheduler -n yunikorn --replicas=1\n"})}),"\n",(0,s.jsx)(n.p,{children:"Available logging levels:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{style:{textAlign:"center"},children:"Value"}),(0,s.jsx)(n.th,{style:{textAlign:"center"},children:"Logging Level"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"-1"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"DEBUG"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"0"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"INFO"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"1"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"WARN"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"2"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"ERROR"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"3"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"DPanic"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"4"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"Panic"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"5"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"Fatal"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"pods-are-stuck-at-pending-state",children:"Pods are stuck at Pending state"}),"\n",(0,s.jsx)(n.p,{children:"If some pods are stuck at Pending state, that means the scheduler could not find a node to allocate the pod. There are\nseveral possibilities to cause this:"}),"\n",(0,s.jsx)(n.h3,{id:"1-non-of-the-nodes-satisfy-pod-placement-requirement",children:"1. Non of the nodes satisfy pod placement requirement"}),"\n",(0,s.jsxs)(n.p,{children:["A pod can be configured with some placement constraints, such as ",(0,s.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#nodeselector",children:"node-selector"}),",\n",(0,s.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#affinity-and-anti-affinity",children:"affinity/anti-affinity"}),",\ndo not have certain toleration for node ",(0,s.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/",children:"taints"}),", etc.\nTo debug such issues, you can describe the pod by:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",metastring:"script",children:"kubectl describe pod <pod-name> -n <namespace>\n"})}),"\n",(0,s.jsx)(n.p,{children:"the pod events will contain the predicate failures and that explains why nodes are not qualified for allocation."}),"\n",(0,s.jsx)(n.h3,{id:"2-the-queue-is-running-out-of-capacity",children:"2. The queue is running out of capacity"}),"\n",(0,s.jsx)(n.p,{children:"If the queue is running out of capacity, pods will be pending for available queue resources. To check if a queue is still\nhaving enough capacity for the pending pods, there are several approaches:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"check the queue usage from yunikorn UI"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["If you do not know how to access the UI, you can refer the document ",(0,s.jsx)(n.a,{href:"/docs/0.9.0/#access-the-web-ui",children:"here"}),". Go\nto the ",(0,s.jsx)(n.code,{children:"Queues"})," page, navigate to the queue where this job is submitted to. You will be able to see the available capacity\nleft for the queue."]}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"check the pod events"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Run the ",(0,s.jsx)(n.code,{children:"kubectl describe pod"})," to get the pod events. If you see some event like:\n",(0,s.jsx)(n.code,{children:"Application <appID> does not fit into <queuePath> queue"}),". That means the pod could not get allocated because the queue\nis running out of capacity."]}),"\n",(0,s.jsx)(n.p,{children:"The pod will be allocated if some other pods in this queue is completed or removed. If the pod remains pending even\nthe queue has capacity, that may because it is waiting for the cluster to scale up."}),"\n",(0,s.jsx)(n.h2,{id:"restart-the-scheduler",children:"Restart the scheduler"}),"\n",(0,s.jsx)(n.p,{children:"YuniKorn can recover its state upon a restart. YuniKorn scheduler pod is deployed as a deployment, restart the scheduler\ncan be done by scale down and up the replica:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",metastring:"script",children:"kubectl scale deployment yunikorn-scheduler -n yunikorn --replicas=0\nkubectl scale deployment yunikorn-scheduler -n yunikorn --replicas=1\n"})}),"\n",(0,s.jsx)(n.h2,{id:"still-got-questions",children:"Still got questions?"}),"\n",(0,s.jsx)(n.p,{children:"No problem! The Apache YuniKorn community will be happy to help. You can reach out to the community with the following options:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Post your questions to ",(0,s.jsx)(n.a,{href:"mailto:dev@yunikorn.apache.org",children:"dev@yunikorn.apache.org"})]}),"\n",(0,s.jsxs)(n.li,{children:["Join the ",(0,s.jsx)(n.a,{href:"https://join.slack.com/t/yunikornworkspace/shared_invite/enQtNzAzMjY0OTI4MjYzLTBmMDdkYTAwNDMwNTE3NWVjZWE1OTczMWE4NDI2Yzg3MmEyZjUyYTZlMDE5M2U4ZjZhNmYyNGFmYjY4ZGYyMGE",children:"YuniKorn slack channel"})," and post your questions to the ",(0,s.jsx)(n.code,{children:"#yunikorn-user"})," channel."]}),"\n",(0,s.jsxs)(n.li,{children:["Join the ",(0,s.jsx)(n.a,{href:"http://yunikorn.apache.org/community/getInvolved#community-meetings",children:"community sync up meetings"})," and directly talk to the community members."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},1780:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>r});var s=t(79474);const i={},l=s.createContext(i);function o(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);