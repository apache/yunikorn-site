"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[95328],{11703:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>l});var t=r(96363);const a={},s=t.createContext(a);function o(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),t.createElement(s.Provider,{value:n},e.children)}},21781:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/ray_cluster_on_ui-61bdd5adff322e714cb09d5d1c59dd13.png"},24986:(e,n,r)=>{r.d(n,{Ay:()=>l,RM:()=>s});var t=r(47259),a=r(11703);const s=[{value:"Configure your Ray CRD(optional)",id:"configure-your-ray-crdoptional",level:3}];function o(e){const n={a:"a",code:"code",h3:"h3",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h3,{id:"configure-your-ray-crdoptional",children:"Configure your Ray CRD(optional)"}),"\n",(0,t.jsxs)(n.p,{children:["If you disable admission controller, you need to add the schedulerName: yunikorn in ",(0,t.jsx)(n.a,{href:"https://github.com/ray-project/kuberay/blob/fd9c90cad28a1460d4472abbb2b5db43a5e4a813/helm-chart/ray-cluster/templates/raycluster-cluster.yaml#L108",children:"raycluster labels"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"#example\nmetadata:\n  labels:\n    applicaionId: ray-<service_type>-0001\n    queue: root.ray.<specific_queue_name>\nspec:\n  schedulerName: yunikorn # k8s will inform yunikorn based on this\n"})})]})}function l(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},37661:(e,n,r)=>{r.d(n,{A:()=>o});r(96363);var t=r(13526);const a={tabItem:"tabItem_q4dO"};var s=r(47259);function o(e){let{children:n,hidden:r,className:o}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,t.A)(a.tabItem,o),hidden:r,children:n})}},58033:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/ray_cluster_operator-24963b289165db8894f7e611a0bc1d9a.png"},61308:(e,n,r)=>{r.d(n,{Ay:()=>l,RM:()=>s});var t=r(47259),a=r(11703);const s=[{value:"Modify YuniKorn settings",id:"modify-yunikorn-settings",level:2}];function o(e){const n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"modify-yunikorn-settings",children:"Modify YuniKorn settings"}),"\n",(0,t.jsxs)(n.p,{children:["Follow ",(0,t.jsx)(n.a,{href:"https://yunikorn.apache.org/docs/",children:"YuniKorn install guide"}),' and modify YuniKorn configmap "yunikorn-defaults" to allow ray operator based on k8s service account.']}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'kubectl patch configmap yunikorn-defaults -n yunikorn --patch \'{"data":{"admissionController.accessControl.systemUsers": "^system:serviceaccount:kube-system:,^system:serviceaccount:default:"}}\' \n'})})]})}function l(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},62680:(e,n,r)=>{r.d(n,{A:()=>w});var t=r(96363),a=r(13526),s=r(39821),o=r(11718),l=r(57596),i=r(79345),u=r(15323),c=r(91960),d=r(3082);function p(e){var n,r;return null!=(n=null==(r=t.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')}))?void 0:r.filter(Boolean))?n:[]}function h(e){const{values:n,children:r}=e;return(0,t.useMemo)(()=>{const e=null!=n?n:function(e){return p(e).map(e=>{let{props:{value:n,label:r,attributes:t,default:a}}=e;return{value:n,label:r,attributes:t,default:a}})}(r);return function(e){const n=(0,c.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error('Docusaurus error: Duplicate values "'+n.map(e=>e.value).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e},[n,r])}function y(e){let{value:n,tabValues:r}=e;return r.some(e=>e.value===n)}function m(e){let{queryString:n=!1,groupId:r}=e;const a=(0,l.W6)(),s=function(e){let{queryString:n=!1,groupId:r}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=r?r:null}({queryString:n,groupId:r});return[(0,u.aZ)(s),(0,t.useCallback)(e=>{if(!s)return;const n=new URLSearchParams(a.location.search);n.set(s,e),a.replace(Object.assign({},a.location,{search:n.toString()}))},[s,a])]}function b(e){const{defaultValue:n,queryString:r=!1,groupId:a}=e,s=h(e),[o,l]=(0,t.useState)(()=>function(e){var n;let{defaultValue:r,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(r){if(!y({value:r,tabValues:t}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+r+'" but none of its children has the corresponding value. Available values are: '+t.map(e=>e.value).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return r}const a=null!=(n=t.find(e=>e.default))?n:t[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:n,tabValues:s})),[u,c]=m({queryString:r,groupId:a}),[p,b]=function(e){let{groupId:n}=e;const r=function(e){return e?"docusaurus.tab."+e:null}(n),[a,s]=(0,d.Dv)(r);return[a,(0,t.useCallback)(e=>{r&&s.set(e)},[r,s])]}({groupId:a}),f=(()=>{const e=null!=u?u:p;return y({value:e,tabValues:s})?e:null})();(0,i.A)(()=>{f&&l(f)},[f]);return{selectedValue:o,selectValue:(0,t.useCallback)(e=>{if(!y({value:e,tabValues:s}))throw new Error("Can't select invalid tab value="+e);l(e),c(e),b(e)},[c,b,s]),tabValues:s}}var f=r(36979);const g={tabList:"tabList_dAhF",tabItem:"tabItem_im9M"};var x=r(47259);function j(e){let{className:n,block:r,selectedValue:t,selectValue:s,tabValues:l}=e;const i=[],{blockElementScrollPositionUntilNextRender:u}=(0,o.a_)(),c=e=>{const n=e.currentTarget,r=i.indexOf(n),a=l[r].value;a!==t&&(u(n),s(a))},d=e=>{var n;let r=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{var t;const n=i.indexOf(e.currentTarget)+1;r=null!=(t=i[n])?t:i[0];break}case"ArrowLeft":{var a;const n=i.indexOf(e.currentTarget)-1;r=null!=(a=i[n])?a:i[i.length-1];break}}null==(n=r)||n.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":r},n),children:l.map(e=>{let{value:n,label:r,attributes:s}=e;return(0,x.jsx)("li",Object.assign({role:"tab",tabIndex:t===n?0:-1,"aria-selected":t===n,ref:e=>{i.push(e)},onKeyDown:d,onClick:c},s,{className:(0,a.A)("tabs__item",g.tabItem,null==s?void 0:s.className,{"tabs__item--active":t===n}),children:null!=r?r:n}),n)})})}function k(e){let{lazy:n,children:r,selectedValue:s}=e;const o=(Array.isArray(r)?r:[r]).filter(Boolean);if(n){const e=o.find(e=>e.props.value===s);return e?(0,t.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:o.map((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==s}))})}function v(e){const n=b(e);return(0,x.jsxs)("div",{className:(0,a.A)(s.G.tabs.container,"tabs-container",g.tabList),children:[(0,x.jsx)(j,Object.assign({},n,e)),(0,x.jsx)(k,Object.assign({},n,e))]})}function w(e){const n=(0,f.A)();return(0,x.jsx)(v,Object.assign({},e,{children:p(e.children)}),String(n))}},71047:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>y,frontMatter:()=>u,metadata:()=>t,toc:()=>p});const t=JSON.parse('{"id":"user_guide/workloads/run_ray_cluster","title":"Run RayCluster","description":"How to run Ray Cluster jobs with YuniKorn","source":"@site/docs/user_guide/workloads/run_ray_cluster.md","sourceDirName":"user_guide/workloads","slug":"/user_guide/workloads/run_ray_cluster","permalink":"/docs/next/user_guide/workloads/run_ray_cluster","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"run_ray_cluster","title":"Run RayCluster","description":"How to run Ray Cluster jobs with YuniKorn","keywords":["Ray_crd"]},"sidebar":"docs","previous":{"title":"Run MPI Jobs","permalink":"/docs/next/user_guide/workloads/run_mpi"},"next":{"title":"Run RayJob","permalink":"/docs/next/user_guide/workloads/run_ray_job"}}');var a=r(47259),s=r(11703),o=r(80768),l=(r(24986),r(61308),r(62680)),i=r(37661);const u={id:"run_ray_cluster",title:"Run RayCluster",description:"How to run Ray Cluster jobs with YuniKorn",keywords:["Ray_crd"]},c=void 0,d={},p=[{value:"Install YuniKorn",id:"install-yunikorn",level:2},...o.RM,{value:"Create RayCluster with YuniKorn",id:"create-raycluster-with-yunikorn",level:2},{value:"Submit a RayJob to RayCluster",id:"submit-a-rayjob-to-raycluster",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.admonition,{type:"note",children:[(0,a.jsxs)(n.p,{children:["This example demonstrates how to set up ",(0,a.jsx)(n.a,{href:"https://docs.ray.io/en/master/cluster/kubernetes/getting-started.html",children:"KubeRay"})," and run a ",(0,a.jsx)(n.a,{href:"https://docs.ray.io/en/master/cluster/kubernetes/getting-started/raycluster-quick-start.html",children:"RayCluster"})," with the YuniKorn scheduler. Here're the pre-requisites:"]}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["This tutorial assumes YuniKorn is ",(0,a.jsx)(n.a,{href:"/docs/next/",children:"installed"})," under the namespace ",(0,a.jsx)(n.code,{children:"yunikorn"})]}),"\n",(0,a.jsx)(n.li,{children:"Use kube-ray version >= 1.2.2 to enable support for YuniKorn gang scheduling"}),"\n"]})]}),"\n",(0,a.jsx)(n.h2,{id:"install-yunikorn",children:"Install YuniKorn"}),"\n",(0,a.jsxs)(n.p,{children:["A simple script to install YuniKorn under the namespace ",(0,a.jsx)(n.code,{children:"yunikorn"}),", refer to ",(0,a.jsx)(n.a,{href:"/docs/next/",children:"Get Started"})," for more details."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",metastring:"script",children:"helm repo add yunikorn https://apache.github.io/yunikorn-release\nhelm repo update\nhelm install yunikorn yunikorn/yunikorn --create-namespace --namespace yunikorn\n"})}),"\n",(0,a.jsx)(o.Ay,{}),"\n",(0,a.jsx)(n.h2,{id:"create-raycluster-with-yunikorn",children:"Create RayCluster with YuniKorn"}),"\n",(0,a.jsxs)(n.p,{children:["In the example, we set the ",(0,a.jsx)(n.code,{children:"ray.io/gang-scheduling-enabled"})," label to ",(0,a.jsx)(n.code,{children:"true"})," to enable gang scheduling."]}),"\n","\n",(0,a.jsxs)(l.A,{children:[(0,a.jsx)(i.A,{value:"amd64",label:"x86-64 (Intel/Linux)",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'cat <<EOF | kubectl apply -f -\napiVersion: ray.io/v1\nkind: RayCluster\nmetadata:\n  name: test-yunikorn-0\n  labels:\n    ray.io/gang-scheduling-enabled: "true"\n    yunikorn.apache.org/app-id: test-yunikorn-0\n    yunikorn.apache.org/queue: root.default\nspec:\n  rayVersion: "2.9.0"\n  headGroupSpec:\n    rayStartParams: {}\n    template:\n      spec:\n        containers:\n          - name: ray-head\n            image: rayproject/ray:2.9.0\n            resources:\n              limits:\n                cpu: "1"\n                memory: "2Gi"\n              requests:\n                cpu: "1"\n                memory: "2Gi"\n  workerGroupSpecs:\n    - groupName: worker\n      rayStartParams: {}\n      replicas: 2\n      minReplicas: 2\n      maxReplicas: 2\n      template:\n        spec:\n          containers:\n            - name: ray-head\n              image: rayproject/ray:2.9.0\n              resources:\n                limits:\n                  cpu: "1"\n                  memory: "1Gi"\n                requests:\n                  cpu: "1"\n                  memory: "1Gi"\nEOF\n'})})}),(0,a.jsx)(i.A,{value:"aarch64",label:"Apple Silicon(arm64)",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'cat <<EOF | kubectl apply -f -\napiVersion: ray.io/v1\nkind: RayCluster\nmetadata:\n  name: test-yunikorn-0\n  labels:\n    ray.io/gang-scheduling-enabled: "true"\n    yunikorn.apache.org/app-id: test-yunikorn-0\n    yunikorn.apache.org/queue: root.default\nspec:\n  rayVersion: "2.9.0"\n  headGroupSpec:\n    rayStartParams: {}\n    template:\n      spec:\n        containers:\n          - name: ray-head\n            image: rayproject/ray:2.9.0-aarch64\n            resources:\n              limits:\n                cpu: "1"\n                memory: "2Gi"\n              requests:\n                cpu: "1"\n                memory: "2Gi"\n  workerGroupSpecs:\n    - groupName: worker\n      rayStartParams: {}\n      replicas: 2\n      minReplicas: 2\n      maxReplicas: 2\n      template:\n        spec:\n          containers:\n            - name: ray-head\n              image: rayproject/ray:2.9.0-aarch64\n              resources:\n                limits:\n                  cpu: "1"\n                  memory: "1Gi"\n                requests:\n                  cpu: "1"\n                  memory: "1Gi"\nEOF\n'})})})]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["RayCluster result\n",(0,a.jsx)(n.img,{alt:"ray_cluster_cluster",src:r(86219).A+"",width:"1184",height:"625"})]}),"\n",(0,a.jsxs)(n.li,{children:["YuniKorn UI\n",(0,a.jsx)(n.img,{alt:"ray_cluster_on_ui",src:r(21781).A+"",width:"1207",height:"681"})]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"submit-a-rayjob-to-raycluster",children:"Submit a RayJob to RayCluster"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'export HEAD_POD=$(kubectl get pods --selector=ray.io/node-type=head -o custom-columns=POD:metadata.name --no-headers)\necho $HEAD_POD\n\nkubectl exec -it $HEAD_POD -- python -c "import ray; ray.init(); print(ray.cluster_resources())"\n'})}),"\n",(0,a.jsx)(n.p,{children:"Services in Kubernetes aren't directly accessible by default. However, you can use port-forwarding to connect to them locally."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"kubectl port-forward service/test-yunikorn-0-head-svc 8265:8265\n"})}),"\n",(0,a.jsxs)(n.p,{children:["After port-forward set up, you can access the Ray dashboard by going to ",(0,a.jsx)(n.code,{children:"http://localhost:8265"})," in your web browser."]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Ray Dashboard\n",(0,a.jsx)(n.img,{alt:"ray_cluster_ray_dashborad",src:r(92118).A+"",width:"1207",height:"724"})]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Have doubts? Check out the ",(0,a.jsx)(n.a,{href:"https://docs.ray.io/en/master/cluster/kubernetes/k8s-ecosystem/yunikorn.html",children:"KubeRay integration with Apache YuniKorn"})," official documents."]})]})}function y(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},80768:(e,n,r)=>{r.d(n,{Ay:()=>l,RM:()=>s});var t=r(47259),a=r(11703);const s=[{value:"Setup a KubeRay operator",id:"setup-a-kuberay-operator",level:2}];function o(e){const n={code:"code",h2:"h2",img:"img",li:"li",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"setup-a-kuberay-operator",children:"Setup a KubeRay operator"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"helm repo add kuberay https://ray-project.github.io/kuberay-helm/\nhelm repo update\nhelm install kuberay-operator kuberay/kuberay-operator --version 1.2.2 --set batchScheduler.name=yunikorn\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The result should be as shown below\n",(0,t.jsx)(n.img,{alt:"ray_cluster_operator",src:r(58033).A+"",width:"1182",height:"631"})]}),"\n"]})]})}function l(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},86219:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/ray_cluster_cluster-c5cb7e8067e98fe24bb652662810980f.png"},92118:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/ray_cluster_ray_dashborad-542d31f005576a99cb416495c3341f55.png"}}]);